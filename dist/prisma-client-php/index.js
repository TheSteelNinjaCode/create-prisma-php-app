#!/usr/bin/env node
import*as fs from"fs";import{exec}from"child_process";import path from"path";import{fileURLToPath,pathToFileURL}from"url";import CryptoJS from"crypto-js";const __filename=fileURLToPath(import.meta.url),__dirname=path.dirname(__filename),args=process.argv.slice(2),getSecretKey=()=>{const e=fs.readFileSync(`${__dirname}/key.enc`,"utf8");if(e.length<400)throw new Error("File content is less than 400 characters.");return e.substring(289,335)},decryptData=(e,t)=>CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8),executePHP=e=>{exec(e,((e,t,r)=>{}))},main=async()=>{if("generate"===args[0]&&"class"===args[1])try{const e=process.cwd(),t=pathToFileURL(path.join(e,"settings","project-settings.js")),r=(await import(t.href)).projectSettings,i=r.PHP_GENERATE_CLASS_PATH,a=`${__dirname}/index.php`,n=`${__dirname}/index.enc`,c=getSecretKey(),s=fs.readFileSync(n,{encoding:"utf8"}),o=decryptData(s,c);fs.writeFileSync(`${__dirname}/index.php`,o);const p=`${r.PHP_ROOT_PATH_EXE} ${a} ${i}`;executePHP(p)}catch(e){}};main().catch((e=>{}));