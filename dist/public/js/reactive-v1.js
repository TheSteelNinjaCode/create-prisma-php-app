var Dt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],Bt="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･",st="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Me={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},Re="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",$t={5:Re,"5module":Re+" export import",6:Re+" const class extends export import super"},jt=/^in(stanceof)?$/,Ht=new RegExp("["+st+"]"),Wt=new RegExp("["+st+Bt+"]");function Le(e,t){for(var s=65536,n=0;n<t.length;n+=2){if((s+=t[n])>e)return!1;if((s+=t[n+1])>=e)return!0}return!1}function q(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&Ht.test(String.fromCharCode(e)):!1!==t&&Le(e,tt)))}function J(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&Wt.test(String.fromCharCode(e)):!1!==t&&(Le(e,tt)||Le(e,Dt)))))}var w=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function F(e,t){return new w(e,{beforeExpr:!0,binop:t})}var D={beforeExpr:!0},O={startsExpr:!0},$e={};function A(e,t){return void 0===t&&(t={}),t.keyword=e,$e[e]=new w(e,t)}var u={num:new w("num",O),regexp:new w("regexp",O),string:new w("string",O),name:new w("name",O),privateId:new w("privateId",O),eof:new w("eof"),bracketL:new w("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new w("]"),braceL:new w("{",{beforeExpr:!0,startsExpr:!0}),braceR:new w("}"),parenL:new w("(",{beforeExpr:!0,startsExpr:!0}),parenR:new w(")"),comma:new w(",",D),semi:new w(";",D),colon:new w(":",D),dot:new w("."),question:new w("?",D),questionDot:new w("?."),arrow:new w("=>",D),template:new w("template"),invalidTemplate:new w("invalidTemplate"),ellipsis:new w("...",D),backQuote:new w("`",O),dollarBraceL:new w("${",{beforeExpr:!0,startsExpr:!0}),eq:new w("=",{beforeExpr:!0,isAssign:!0}),assign:new w("_=",{beforeExpr:!0,isAssign:!0}),incDec:new w("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new w("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:F("||",1),logicalAND:F("&&",2),bitwiseOR:F("|",3),bitwiseXOR:F("^",4),bitwiseAND:F("&",5),equality:F("==/!=/===/!==",6),relational:F("</>/<=/>=",7),bitShift:F("<</>>/>>>",8),plusMin:new w("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:F("%",10),star:F("*",10),slash:F("/",10),starstar:new w("**",{beforeExpr:!0}),coalesce:F("??",1),_break:A("break"),_case:A("case",D),_catch:A("catch"),_continue:A("continue"),_debugger:A("debugger"),_default:A("default",D),_do:A("do",{isLoop:!0,beforeExpr:!0}),_else:A("else",D),_finally:A("finally"),_for:A("for",{isLoop:!0}),_function:A("function",O),_if:A("if"),_return:A("return",D),_switch:A("switch"),_throw:A("throw",D),_try:A("try"),_var:A("var"),_const:A("const"),_while:A("while",{isLoop:!0}),_with:A("with"),_new:A("new",{beforeExpr:!0,startsExpr:!0}),_this:A("this",O),_super:A("super",O),_class:A("class",O),_extends:A("extends",D),_export:A("export"),_import:A("import",O),_null:A("null",O),_true:A("true",O),_false:A("false",O),_in:A("in",{beforeExpr:!0,binop:7}),_instanceof:A("instanceof",{beforeExpr:!0,binop:7}),_typeof:A("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:A("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:A("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},V=/\r\n?|\n|\u2028|\u2029/,Ut=new RegExp(V.source,"g");function ue(e){return 10===e||13===e||8232===e||8233===e}function it(e,t,s){void 0===s&&(s=e.length);for(var n=t;n<s;n++){var i=e.charCodeAt(n);if(ue(i))return n<s-1&&13===i&&10===e.charCodeAt(n+1)?n+2:n+1}return-1}var nt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,N=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,rt=Object.prototype,zt=rt.hasOwnProperty,qt=rt.toString,le=Object.hasOwn||function(e,t){return zt.call(e,t)},Ge=Array.isArray||function(e){return"[object Array]"===qt.call(e)},Qe=Object.create(null);function Z(e){return Qe[e]||(Qe[e]=new RegExp("^(?:"+e.replace(/ /g,"|")+")$"))}function G(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}var Xt=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,me=function(e,t){this.line=e,this.column=t};me.prototype.offset=function(e){return new me(this.line,this.column+e)};var Ae=function(e,t,s){this.start=t,this.end=s,null!==e.sourceFile&&(this.source=e.sourceFile)};function at(e,t){for(var s=1,n=0;;){var i=it(e,n,t);if(i<0)return new me(s,t-n);++s,n=i}}var Ve={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},Ye=!1;function Kt(e){var t={};for(var s in Ve)t[s]=e&&le(e,s)?e[s]:Ve[s];if("latest"===t.ecmaVersion?t.ecmaVersion=1e8:null==t.ecmaVersion?(!Ye&&"object"==typeof console&&console.warn&&(Ye=!0,console.warn("Since Acorn 8.0.0, options.ecmaVersion is required.\nDefaulting to 2020, but this will stop working in the future.")),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),(!e||null==e.allowHashBang)&&(t.allowHashBang=t.ecmaVersion>=14),Ge(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return Ge(t.onComment)&&(t.onComment=Gt(t,t.onComment)),t}function Gt(e,t){return function(s,n,i,r,a,o){var c={type:s?"Block":"Line",value:n,start:i,end:r};e.locations&&(c.loc=new Ae(this,a,o)),e.ranges&&(c.range=[i,r]),t.push(c)}}var ge=1,he=2,je=4,ot=8,He=16,ct=32,we=64,ut=128,ne=256,xe=512,Pe=ge|he|ne;function We(e,t){return he|(e?je:0)|(t?ot:0)}var Ce=0,Ue=1,Y=2,lt=3,ht=4,pt=5,I=function(e,t,s){this.options=e=Kt(e),this.sourceFile=e.sourceFile,this.keywords=Z($t[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var n="";!0!==e.allowReserved&&(n=Me[e.ecmaVersion>=6?6:5===e.ecmaVersion?5:3],"module"===e.sourceType&&(n+=" await")),this.reservedWords=Z(n);var i=(n?n+" ":"")+Me.strict;this.reservedWordsStrict=Z(i),this.reservedWordsStrictBind=Z(i+" "+Me.strictBind),this.input=String(t),this.containsEsc=!1,s?(this.pos=s,this.lineStart=this.input.lastIndexOf("\n",s-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(V).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=u.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ge),this.regexpState=null,this.privateNameStack=[]},X={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};I.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},X.inFunction.get=function(){return(this.currentVarScope().flags&he)>0},X.inGenerator.get=function(){return(this.currentVarScope().flags&ot)>0},X.inAsync.get=function(){return(this.currentVarScope().flags&je)>0},X.canAwait.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e].flags;if(t&(ne|xe))return!1;if(t&he)return(t&je)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},X.allowSuper.get=function(){return(this.currentThisScope().flags&we)>0||this.options.allowSuperOutsideMethod},X.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ut)>0},X.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},X.allowNewDotTarget.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e].flags;if(t&(ne|xe)||t&he&&!(t&He))return!0}return!1},X.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&ne)>0},I.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var s=this,n=0;n<e.length;n++)s=e[n](s);return s},I.parse=function(e,t){return new this(t,e).parse()},I.parseExpressionAt=function(e,t,s){var n=new this(s,e,t);return n.nextToken(),n.parseExpression()},I.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(I.prototype,X);var R=I.prototype,Qt=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;R.strictDirective=function(e){if(this.options.ecmaVersion<5)return!1;for(;;){N.lastIndex=e,e+=N.exec(this.input)[0].length;var t=Qt.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){N.lastIndex=e+t[0].length;var s=N.exec(this.input),n=s.index+s[0].length,i=this.input.charAt(n);return";"===i||"}"===i||V.test(s[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(n+1))}e+=t[0].length,N.lastIndex=e,e+=N.exec(this.input)[0].length,";"===this.input[e]&&e++}},R.eat=function(e){return this.type===e&&(this.next(),!0)},R.isContextual=function(e){return this.type===u.name&&this.value===e&&!this.containsEsc},R.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},R.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},R.canInsertSemicolon=function(){return this.type===u.eof||this.type===u.braceR||V.test(this.input.slice(this.lastTokEnd,this.start))},R.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},R.semicolon=function(){!this.eat(u.semi)&&!this.insertSemicolon()&&this.unexpected()},R.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},R.expect=function(e){this.eat(e)||this.unexpected()},R.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};var _e=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};R.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var s=t?e.parenthesizedAssign:e.parenthesizedBind;s>-1&&this.raiseRecoverable(s,t?"Assigning to rvalue":"Parenthesized pattern")}},R.checkExpressionErrors=function(e,t){if(!e)return!1;var s=e.shorthandAssign,n=e.doubleProto;if(!t)return s>=0||n>=0;s>=0&&this.raise(s,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},R.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},R.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var x=I.prototype;x.parseTopLevel=function(e){var t=Object.create(null);for(e.body||(e.body=[]);this.type!==u.eof;){var s=this.parseStatement(null,!0,t);e.body.push(s)}if(this.inModule)for(var n=0,i=Object.keys(this.undefinedExports);n<i.length;n+=1){var r=i[n];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var ze={kind:"loop"},Yt={kind:"switch"};x.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;N.lastIndex=this.pos;var t=N.exec(this.input),s=this.pos+t[0].length,n=this.input.charCodeAt(s);if(91===n||92===n)return!0;if(e)return!1;if(123===n||n>55295&&n<56320)return!0;if(q(n,!0)){for(var i=s+1;J(n=this.input.charCodeAt(i),!0);)++i;if(92===n||n>55295&&n<56320)return!0;var r=this.input.slice(s,i);if(!jt.test(r))return!0}return!1},x.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;N.lastIndex=this.pos;var e,t=N.exec(this.input),s=this.pos+t[0].length;return!(V.test(this.input.slice(this.pos,s))||"function"!==this.input.slice(s,s+8)||s+8!==this.input.length&&(J(e=this.input.charCodeAt(s+8))||e>55295&&e<56320))},x.isUsingKeyword=function(e,t){if(this.options.ecmaVersion<17||!this.isContextual(e?"await":"using"))return!1;N.lastIndex=this.pos;var s=N.exec(this.input),n=this.pos+s[0].length;if(V.test(this.input.slice(this.pos,n)))return!1;if(e){var i,r=n+5;if("using"!==this.input.slice(n,r)||r===this.input.length||J(i=this.input.charCodeAt(r))||i>55295&&i<56320)return!1;N.lastIndex=r;var a=N.exec(this.input);if(a&&V.test(this.input.slice(r,r+a[0].length)))return!1}if(t){var o,c=n+2;if(!("of"!==this.input.slice(n,c)||c!==this.input.length&&(J(o=this.input.charCodeAt(c))||o>55295&&o<56320)))return!1}var p=this.input.charCodeAt(n);return q(p,!0)||92===p},x.isAwaitUsing=function(e){return this.isUsingKeyword(!0,e)},x.isUsing=function(e){return this.isUsingKeyword(!1,e)},x.parseStatement=function(e,t,s){var n,i=this.type,r=this.startNode();switch(this.isLet(e)&&(i=u._var,n="let"),i){case u._break:case u._continue:return this.parseBreakContinueStatement(r,i.keyword);case u._debugger:return this.parseDebuggerStatement(r);case u._do:return this.parseDoStatement(r);case u._for:return this.parseForStatement(r);case u._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(r,!1,!e);case u._class:return e&&this.unexpected(),this.parseClass(r,!0);case u._if:return this.parseIfStatement(r);case u._return:return this.parseReturnStatement(r);case u._switch:return this.parseSwitchStatement(r);case u._throw:return this.parseThrowStatement(r);case u._try:return this.parseTryStatement(r);case u._const:case u._var:return n=n||this.value,e&&"var"!==n&&this.unexpected(),this.parseVarStatement(r,n);case u._while:return this.parseWhileStatement(r);case u._with:return this.parseWithStatement(r);case u.braceL:return this.parseBlock(!0,r);case u.semi:return this.parseEmptyStatement(r);case u._export:case u._import:if(this.options.ecmaVersion>10&&i===u._import){N.lastIndex=this.pos;var a=N.exec(this.input),o=this.pos+a[0].length,c=this.input.charCodeAt(o);if(40===c||46===c)return this.parseExpressionStatement(r,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===u._import?this.parseImport(r):this.parseExport(r,s);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(r,!0,!e);var p=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(p)return t&&"script"===this.options.sourceType&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),"await using"===p&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(r,!1,p),this.semicolon(),this.finishNode(r,"VariableDeclaration");var h=this.value,l=this.parseExpression();return i===u.name&&"Identifier"===l.type&&this.eat(u.colon)?this.parseLabeledStatement(r,h,l,e):this.parseExpressionStatement(r,l)}},x.parseBreakContinueStatement=function(e,t){var s="break"===t;this.next(),this.eat(u.semi)||this.insertSemicolon()?e.label=null:this.type!==u.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var i=this.labels[n];if((null==e.label||i.name===e.label.name)&&(null!=i.kind&&(s||"loop"===i.kind)||e.label&&s))break}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,s?"BreakStatement":"ContinueStatement")},x.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},x.parseDoStatement=function(e){return this.next(),this.labels.push(ze),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(u._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(u.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},x.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(ze),this.enterScope(0),this.expect(u.parenL),this.type===u.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var s=this.isLet();if(this.type===u._var||this.type===u._const||s){var n=this.startNode(),i=s?"let":this.value;return this.next(),this.parseVar(n,!0,i),this.finishNode(n,"VariableDeclaration"),this.parseForAfterInit(e,n,t)}var r=this.isContextual("let"),a=!1,o=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(o){var c=this.startNode();return this.next(),"await using"===o&&this.next(),this.parseVar(c,!0,o),this.finishNode(c,"VariableDeclaration"),this.parseForAfterInit(e,c,t)}var p=this.containsEsc,h=new _e,l=this.start,d=t>-1?this.parseExprSubscripts(h,"await"):this.parseExpression(!0,h);return this.type===u._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(t>-1?(this.type===u._in&&this.unexpected(t),e.await=!0):a&&this.options.ecmaVersion>=8&&(d.start!==l||p||"Identifier"!==d.type||"async"!==d.name?this.options.ecmaVersion>=9&&(e.await=!1):this.unexpected()),r&&a&&this.raise(d.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(d,!1,h),this.checkLValPattern(d),this.parseForIn(e,d)):(this.checkExpressionErrors(h,!0),t>-1&&this.unexpected(t),this.parseFor(e,d))},x.parseForAfterInit=function(e,t,s){return(this.type===u._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===t.declarations.length?(this.options.ecmaVersion>=9&&(this.type===u._in?s>-1&&this.unexpected(s):e.await=s>-1),this.parseForIn(e,t)):(s>-1&&this.unexpected(s),this.parseFor(e,t))},x.parseFunctionStatement=function(e,t,s){return this.next(),this.parseFunction(e,de|(s?0:Fe),!1,t)},x.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(u._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},x.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(u.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},x.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(u.braceL),this.labels.push(Yt),this.enterScope(0);for(var t,s=!1;this.type!==u.braceR;)if(this.type===u._case||this.type===u._default){var n=this.type===u._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(s&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),s=!0,t.test=null),this.expect(u.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},x.parseThrowStatement=function(e){return this.next(),V.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var Zt=[];x.parseCatchClauseParam=function(){var e=this.parseBindingAtom(),t="Identifier"===e.type;return this.enterScope(t?ct:0),this.checkLValPattern(e,t?ht:Y),this.expect(u.parenR),e},x.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===u._catch){var t=this.startNode();this.next(),this.eat(u.parenL)?t.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0)),t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(u._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},x.parseVarStatement=function(e,t,s){return this.next(),this.parseVar(e,!1,t,s),this.semicolon(),this.finishNode(e,"VariableDeclaration")},x.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(ze),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},x.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},x.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},x.parseLabeledStatement=function(e,t,s,n){for(var i=0,r=this.labels;i<r.length;i+=1){r[i].name===t&&this.raise(s.start,"Label '"+t+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===u._switch?"switch":null,o=this.labels.length-1;o>=0;o--){var c=this.labels[o];if(c.statementStart!==e.start)break;c.statementStart=this.start,c.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(n?-1===n.indexOf("label")?n+"label":n:"label"),this.labels.pop(),e.label=s,this.finishNode(e,"LabeledStatement")},x.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},x.parseBlock=function(e,t,s){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(u.braceL),e&&this.enterScope(0);this.type!==u.braceR;){var n=this.parseStatement(null);t.body.push(n)}return s&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},x.parseFor=function(e,t){return e.init=t,this.expect(u.semi),e.test=this.type===u.semi?null:this.parseExpression(),this.expect(u.semi),e.update=this.type===u.parenR?null:this.parseExpression(),this.expect(u.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},x.parseForIn=function(e,t){var s=this.type===u._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!s||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)&&this.raise(t.start,(s?"for-in":"for-of")+" loop variable declaration may not have an initializer"),e.left=t,e.right=s?this.parseExpression():this.parseMaybeAssign(),this.expect(u.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,s?"ForInStatement":"ForOfStatement")},x.parseVar=function(e,t,s,n){for(e.declarations=[],e.kind=s;;){var i=this.startNode();if(this.parseVarId(i,s),this.eat(u.eq)?i.init=this.parseMaybeAssign(t):n||"const"!==s||this.type===u._in||this.options.ecmaVersion>=6&&this.isContextual("of")?n||"using"!==s&&"await using"!==s||!(this.options.ecmaVersion>=17)||this.type===u._in||this.isContextual("of")?n||"Identifier"===i.id.type||t&&(this.type===u._in||this.isContextual("of"))?i.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.raise(this.lastTokEnd,"Missing initializer in "+s+" declaration"):this.unexpected(),e.declarations.push(this.finishNode(i,"VariableDeclarator")),!this.eat(u.comma))break}return e},x.parseVarId=function(e,t){e.id="using"===t||"await using"===t?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(e.id,"var"===t?Ue:Y,!1)};var de=1,Fe=2,ft=4;function Jt(e,t){var s=t.key.name,n=e[s],i="true";return"MethodDefinition"===t.type&&("get"===t.kind||"set"===t.kind)&&(i=(t.static?"s":"i")+t.kind),"iget"===n&&"iset"===i||"iset"===n&&"iget"===i||"sget"===n&&"sset"===i||"sset"===n&&"sget"===i?(e[s]="true",!1):!!n||(e[s]=i,!1)}function ye(e,t){var s=e.computed,n=e.key;return!s&&("Identifier"===n.type&&n.name===t||"Literal"===n.type&&n.value===t)}x.parseFunction=function(e,t,s,n,i){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===u.star&&t&Fe&&this.unexpected(),e.generator=this.eat(u.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&de&&(e.id=t&ft&&this.type!==u.name?null:this.parseIdent(),e.id&&!(t&Fe)&&this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?Ue:Y:lt));var r=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(We(e.async,e.generator)),t&de||(e.id=this.type===u.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,s,!1,i),this.yieldPos=r,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(e,t&de?"FunctionDeclaration":"FunctionExpression")},x.parseFunctionParams=function(e){this.expect(u.parenL),e.params=this.parseBindingList(u.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},x.parseClass=function(e,t){this.next();var s=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var n=this.enterClassBody(),i=this.startNode(),r=!1;for(i.body=[],this.expect(u.braceL);this.type!==u.braceR;){var a=this.parseClassElement(null!==e.superClass);a&&(i.body.push(a),"MethodDefinition"===a.type&&"constructor"===a.kind?(r&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),r=!0):a.key&&"PrivateIdentifier"===a.key.type&&Jt(n,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=s,this.next(),e.body=this.finishNode(i,"ClassBody"),this.exitClassBody(),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},x.parseClassElement=function(e){if(this.eat(u.semi))return null;var t=this.options.ecmaVersion,s=this.startNode(),n="",i=!1,r=!1,a="method",o=!1;if(this.eatContextual("static")){if(t>=13&&this.eat(u.braceL))return this.parseClassStaticBlock(s),s;this.isClassElementNameStart()||this.type===u.star?o=!0:n="static"}if(s.static=o,!n&&t>=8&&this.eatContextual("async")&&(!this.isClassElementNameStart()&&this.type!==u.star||this.canInsertSemicolon()?n="async":r=!0),!n&&(t>=9||!r)&&this.eat(u.star)&&(i=!0),!n&&!r&&!i){var c=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=c:n=c)}if(n?(s.computed=!1,s.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),s.key.name=n,this.finishNode(s.key,"Identifier")):this.parseClassElementName(s),t<13||this.type===u.parenL||"method"!==a||i||r){var p=!s.static&&ye(s,"constructor"),h=p&&e;p&&"method"!==a&&this.raise(s.key.start,"Constructor can't have get/set modifier"),s.kind=p?"constructor":a,this.parseClassMethod(s,i,r,h)}else this.parseClassField(s);return s},x.isClassElementNameStart=function(){return this.type===u.name||this.type===u.privateId||this.type===u.num||this.type===u.string||this.type===u.bracketL||this.type.keyword},x.parseClassElementName=function(e){this.type===u.privateId?("constructor"===this.value&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)},x.parseClassMethod=function(e,t,s,n){var i=e.key;"constructor"===e.kind?(t&&this.raise(i.start,"Constructor can't be a generator"),s&&this.raise(i.start,"Constructor can't be an async method")):e.static&&ye(e,"prototype")&&this.raise(i.start,"Classes may not have a static property named prototype");var r=e.value=this.parseMethod(t,s,n);return"get"===e.kind&&0!==r.params.length&&this.raiseRecoverable(r.start,"getter should have no params"),"set"===e.kind&&1!==r.params.length&&this.raiseRecoverable(r.start,"setter should have exactly one param"),"set"===e.kind&&"RestElement"===r.params[0].type&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(e,"MethodDefinition")},x.parseClassField=function(e){return ye(e,"constructor")?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&ye(e,"prototype")&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(u.eq)?(this.enterScope(xe|we),e.value=this.parseMaybeAssign(),this.exitScope()):e.value=null,this.semicolon(),this.finishNode(e,"PropertyDefinition")},x.parseClassStaticBlock=function(e){e.body=[];var t=this.labels;for(this.labels=[],this.enterScope(ne|we);this.type!==u.braceR;){var s=this.parseStatement(null);e.body.push(s)}return this.next(),this.exitScope(),this.labels=t,this.finishNode(e,"StaticBlock")},x.parseClassId=function(e,t){this.type===u.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,Y,!1)):(!0===t&&this.unexpected(),e.id=null)},x.parseClassSuper=function(e){e.superClass=this.eat(u._extends)?this.parseExprSubscripts(null,!1):null},x.enterClassBody=function(){var e={declared:Object.create(null),used:[]};return this.privateNameStack.push(e),e.declared},x.exitClassBody=function(){var e=this.privateNameStack.pop(),t=e.declared,s=e.used;if(this.options.checkPrivateFields)for(var n=this.privateNameStack.length,i=0===n?null:this.privateNameStack[n-1],r=0;r<s.length;++r){var a=s[r];le(t,a.name)||(i?i.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}},x.parseExportAllDeclaration=function(e,t){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseModuleExportName(),this.checkExport(t,e.exported,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==u.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ExportAllDeclaration")},x.parseExport=function(e,t){if(this.next(),this.eat(u.star))return this.parseExportAllDeclaration(e,t);if(this.eat(u._default))return this.checkExport(t,"default",this.lastTokStart),e.declaration=this.parseExportDefaultDeclaration(),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseExportDeclaration(e),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id,e.declaration.id.start),e.specifiers=[],e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[]);else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==u.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause());else{for(var s=0,n=e.specifiers;s<n.length;s+=1){var i=n[s];this.checkUnreserved(i.local),this.checkLocalExport(i.local),"Literal"===i.local.type&&this.raise(i.local.start,"A string literal cannot be used as an exported binding without `from`.")}e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[])}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},x.parseExportDeclaration=function(e){return this.parseStatement(null)},x.parseExportDefaultDeclaration=function(){var e;if(this.type===u._function||(e=this.isAsyncFunction())){var t=this.startNode();return this.next(),e&&this.next(),this.parseFunction(t,de|ft,!1,e)}if(this.type===u._class){var s=this.startNode();return this.parseClass(s,"nullableID")}var n=this.parseMaybeAssign();return this.semicolon(),n},x.checkExport=function(e,t,s){e&&("string"!=typeof t&&(t="Identifier"===t.type?t.name:t.value),le(e,t)&&this.raiseRecoverable(s,"Duplicate export '"+t+"'"),e[t]=!0)},x.checkPatternExport=function(e,t){var s=t.type;if("Identifier"===s)this.checkExport(e,t,t.start);else if("ObjectPattern"===s)for(var n=0,i=t.properties;n<i.length;n+=1){var r=i[n];this.checkPatternExport(e,r)}else if("ArrayPattern"===s)for(var a=0,o=t.elements;a<o.length;a+=1){var c=o[a];c&&this.checkPatternExport(e,c)}else"Property"===s?this.checkPatternExport(e,t.value):"AssignmentPattern"===s?this.checkPatternExport(e,t.left):"RestElement"===s&&this.checkPatternExport(e,t.argument)},x.checkVariableExport=function(e,t){if(e)for(var s=0,n=t;s<n.length;s+=1){var i=n[s];this.checkPatternExport(e,i.id)}},x.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},x.parseExportSpecifier=function(e){var t=this.startNode();return t.local=this.parseModuleExportName(),t.exported=this.eatContextual("as")?this.parseModuleExportName():t.local,this.checkExport(e,t.exported,t.exported.start),this.finishNode(t,"ExportSpecifier")},x.parseExportSpecifiers=function(e){var t=[],s=!0;for(this.expect(u.braceL);!this.eat(u.braceR);){if(s)s=!1;else if(this.expect(u.comma),this.afterTrailingComma(u.braceR))break;t.push(this.parseExportSpecifier(e))}return t},x.parseImport=function(e){return this.next(),this.type===u.string?(e.specifiers=Zt,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===u.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},x.parseImportSpecifier=function(){var e=this.startNode();return e.imported=this.parseModuleExportName(),this.eatContextual("as")?e.local=this.parseIdent():(this.checkUnreserved(e.imported),e.local=e.imported),this.checkLValSimple(e.local,Y),this.finishNode(e,"ImportSpecifier")},x.parseImportDefaultSpecifier=function(){var e=this.startNode();return e.local=this.parseIdent(),this.checkLValSimple(e.local,Y),this.finishNode(e,"ImportDefaultSpecifier")},x.parseImportNamespaceSpecifier=function(){var e=this.startNode();return this.next(),this.expectContextual("as"),e.local=this.parseIdent(),this.checkLValSimple(e.local,Y),this.finishNode(e,"ImportNamespaceSpecifier")},x.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===u.name&&(e.push(this.parseImportDefaultSpecifier()),!this.eat(u.comma)))return e;if(this.type===u.star)return e.push(this.parseImportNamespaceSpecifier()),e;for(this.expect(u.braceL);!this.eat(u.braceR);){if(t)t=!1;else if(this.expect(u.comma),this.afterTrailingComma(u.braceR))break;e.push(this.parseImportSpecifier())}return e},x.parseWithClause=function(){var e=[];if(!this.eat(u._with))return e;this.expect(u.braceL);for(var t={},s=!0;!this.eat(u.braceR);){if(s)s=!1;else if(this.expect(u.comma),this.afterTrailingComma(u.braceR))break;var n=this.parseImportAttribute(),i="Identifier"===n.key.type?n.key.name:n.key.value;le(t,i)&&this.raiseRecoverable(n.key.start,"Duplicate attribute key '"+i+"'"),t[i]=!0,e.push(n)}return e},x.parseImportAttribute=function(){var e=this.startNode();return e.key=this.type===u.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved),this.expect(u.colon),this.type!==u.string&&this.unexpected(),e.value=this.parseExprAtom(),this.finishNode(e,"ImportAttribute")},x.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===u.string){var e=this.parseLiteral(this.value);return Xt.test(e.value)&&this.raise(e.start,"An export name cannot include a lone surrogate."),e}return this.parseIdent(!0)},x.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},x.isDirectiveCandidate=function(e){return this.options.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var j=I.prototype;j.toAssignable=function(e,t,s){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",s&&this.checkPatternErrors(s,!0);for(var n=0,i=e.properties;n<i.length;n+=1){var r=i[n];this.toAssignable(r,t),"RestElement"===r.type&&("ArrayPattern"===r.argument.type||"ObjectPattern"===r.argument.type)&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",s&&this.checkPatternErrors(s,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,s);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else s&&this.checkPatternErrors(s,!0);return e},j.toAssignableList=function(e,t){for(var s=e.length,n=0;n<s;n++){var i=e[n];i&&this.toAssignable(i,t)}if(s){var r=e[s-1];6===this.options.ecmaVersion&&t&&r&&"RestElement"===r.type&&"Identifier"!==r.argument.type&&this.unexpected(r.argument.start)}return e},j.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},j.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==u.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},j.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case u.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(u.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case u.braceL:return this.parseObj(!0)}return this.parseIdent()},j.parseBindingList=function(e,t,s,n){for(var i=[],r=!0;!this.eat(e);)if(r?r=!1:this.expect(u.comma),t&&this.type===u.comma)i.push(null);else{if(s&&this.afterTrailingComma(e))break;if(this.type===u.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),i.push(a),this.type===u.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}i.push(this.parseAssignableListItem(n))}return i},j.parseAssignableListItem=function(e){var t=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(t),t},j.parseBindingListItem=function(e){return e},j.parseMaybeDefault=function(e,t,s){if(s=s||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(u.eq))return s;var n=this.startNodeAt(e,t);return n.left=s,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},j.checkLValSimple=function(e,t,s){void 0===t&&(t=Ce);var n=t!==Ce;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(n?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(t===Y&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),s&&(le(s,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),s[e.name]=!0),t!==pt&&this.declareName(e.name,t,e.start));break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(e.start,"Binding parenthesized expression"),this.checkLValSimple(e.expression,t,s);default:this.raise(e.start,(n?"Binding":"Assigning to")+" rvalue")}},j.checkLValPattern=function(e,t,s){switch(void 0===t&&(t=Ce),e.type){case"ObjectPattern":for(var n=0,i=e.properties;n<i.length;n+=1){var r=i[n];this.checkLValInnerPattern(r,t,s)}break;case"ArrayPattern":for(var a=0,o=e.elements;a<o.length;a+=1){var c=o[a];c&&this.checkLValInnerPattern(c,t,s)}break;default:this.checkLValSimple(e,t,s)}},j.checkLValInnerPattern=function(e,t,s){switch(void 0===t&&(t=Ce),e.type){case"Property":this.checkLValInnerPattern(e.value,t,s);break;case"AssignmentPattern":this.checkLValPattern(e.left,t,s);break;case"RestElement":this.checkLValPattern(e.argument,t,s);break;default:this.checkLValPattern(e,t,s)}};var H=function(e,t,s,n,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!s,this.override=n,this.generator=!!i},k={b_stat:new H("{",!1),b_expr:new H("{",!0),b_tmpl:new H("${",!1),p_stat:new H("(",!1),p_expr:new H("(",!0),q_tmpl:new H("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new H("function",!1),f_expr:new H("function",!0),f_expr_gen:new H("function",!0,!1,null,!0),f_gen:new H("function",!1,!1,null,!0)},pe=I.prototype;pe.initialContext=function(){return[k.b_stat]},pe.curContext=function(){return this.context[this.context.length-1]},pe.braceIsBlock=function(e){var t=this.curContext();return t===k.f_expr||t===k.f_stat||(e!==u.colon||t!==k.b_stat&&t!==k.b_expr?e===u._return||e===u.name&&this.exprAllowed?V.test(this.input.slice(this.lastTokEnd,this.start)):e===u._else||e===u.semi||e===u.eof||e===u.parenR||e===u.arrow||(e===u.braceL?t===k.b_stat:e!==u._var&&e!==u._const&&e!==u.name&&!this.exprAllowed):!t.isExpr)},pe.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},pe.updateContext=function(e){var t,s=this.type;s.keyword&&e===u.dot?this.exprAllowed=!1:(t=s.updateContext)?t.call(this,e):this.exprAllowed=s.beforeExpr},pe.overrideContext=function(e){this.curContext()!==e&&(this.context[this.context.length-1]=e)},u.parenR.updateContext=u.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===k.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},u.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?k.b_stat:k.b_expr),this.exprAllowed=!0},u.dollarBraceL.updateContext=function(){this.context.push(k.b_tmpl),this.exprAllowed=!0},u.parenL.updateContext=function(e){var t=e===u._if||e===u._for||e===u._with||e===u._while;this.context.push(t?k.p_stat:k.p_expr),this.exprAllowed=!0},u.incDec.updateContext=function(){},u._function.updateContext=u._class.updateContext=function(e){!e.beforeExpr||e===u._else||e===u.semi&&this.curContext()!==k.p_stat||e===u._return&&V.test(this.input.slice(this.lastTokEnd,this.start))||(e===u.colon||e===u.braceL)&&this.curContext()===k.b_stat?this.context.push(k.f_stat):this.context.push(k.f_expr),this.exprAllowed=!1},u.colon.updateContext=function(){"function"===this.curContext().token&&this.context.pop(),this.exprAllowed=!0},u.backQuote.updateContext=function(){this.curContext()===k.q_tmpl?this.context.pop():this.context.push(k.q_tmpl),this.exprAllowed=!1},u.star.updateContext=function(e){if(e===u._function){var t=this.context.length-1;this.context[t]===k.f_expr?this.context[t]=k.f_expr_gen:this.context[t]=k.f_gen}this.exprAllowed=!0},u.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==u.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var y=I.prototype;function dt(e){return"Identifier"===e.type||"ParenthesizedExpression"===e.type&&dt(e.expression)}function De(e){return"MemberExpression"===e.type&&"PrivateIdentifier"===e.property.type||"ChainExpression"===e.type&&De(e.expression)||"ParenthesizedExpression"===e.type&&De(e.expression)}y.checkPropClash=function(e,t,s){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n,i=e.key;switch(i.type){case"Identifier":n=i.name;break;case"Literal":n=String(i.value);break;default:return}var r=e.kind;if(this.options.ecmaVersion>=6)return void("__proto__"===n&&"init"===r&&(t.proto&&(s?s.doubleProto<0&&(s.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0));var a=t[n="$"+n];if(a)("init"===r?this.strict&&a.init||a.get||a.set:a.init||a[r])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=t[n]={init:!1,get:!1,set:!1};a[r]=!0}},y.parseExpression=function(e,t){var s=this.start,n=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===u.comma){var r=this.startNodeAt(s,n);for(r.expressions=[i];this.eat(u.comma);)r.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(r,"SequenceExpression")}return i},y.parseMaybeAssign=function(e,t,s){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,i=-1,r=-1,a=-1;t?(i=t.parenthesizedAssign,r=t.trailingComma,a=t.doubleProto,t.parenthesizedAssign=t.trailingComma=-1):(t=new _e,n=!0);var o=this.start,c=this.startLoc;(this.type===u.parenL||this.type===u.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait="await"===e);var p=this.parseMaybeConditional(e,t);if(s&&(p=s.call(this,p,o,c)),this.type.isAssign){var h=this.startNodeAt(o,c);return h.operator=this.value,this.type===u.eq&&(p=this.toAssignable(p,!1,t)),n||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=p.start&&(t.shorthandAssign=-1),this.type===u.eq?this.checkLValPattern(p):this.checkLValSimple(p),h.left=p,this.next(),h.right=this.parseMaybeAssign(e),a>-1&&(t.doubleProto=a),this.finishNode(h,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),r>-1&&(t.trailingComma=r),p},y.parseMaybeConditional=function(e,t){var s=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(u.question)){var r=this.startNodeAt(s,n);return r.test=i,r.consequent=this.parseMaybeAssign(),this.expect(u.colon),r.alternate=this.parseMaybeAssign(e),this.finishNode(r,"ConditionalExpression")}return i},y.parseExprOps=function(e,t){var s=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1,!1,e);return this.checkExpressionErrors(t)||i.start===s&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,s,n,-1,e)},y.parseExprOp=function(e,t,s,n,i){var r=this.type.binop;if(null!=r&&(!i||this.type!==u._in)&&r>n){var a=this.type===u.logicalOR||this.type===u.logicalAND,o=this.type===u.coalesce;o&&(r=u.logicalAND.binop);var c=this.value;this.next();var p=this.start,h=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,i),p,h,r,i),d=this.buildBinary(t,s,e,l,c,a||o);return(a&&this.type===u.coalesce||o&&(this.type===u.logicalOR||this.type===u.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(d,t,s,n,i)}return e},y.buildBinary=function(e,t,s,n,i,r){"PrivateIdentifier"===n.type&&this.raise(n.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(e,t);return a.left=s,a.operator=i,a.right=n,this.finishNode(a,r?"LogicalExpression":"BinaryExpression")},y.parseMaybeUnary=function(e,t,s,n){var i,r=this.start,a=this.startLoc;if(this.isContextual("await")&&this.canAwait)i=this.parseAwait(n),t=!0;else if(this.type.prefix){var o=this.startNode(),c=this.type===u.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,c,n),this.checkExpressionErrors(e,!0),c?this.checkLValSimple(o.argument):this.strict&&"delete"===o.operator&&dt(o.argument)?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):"delete"===o.operator&&De(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):t=!0,i=this.finishNode(o,c?"UpdateExpression":"UnaryExpression")}else if(t||this.type!==u.privateId){if(i=this.parseExprSubscripts(e,n),this.checkExpressionErrors(e))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var p=this.startNodeAt(r,a);p.operator=this.value,p.prefix=!1,p.argument=i,this.checkLValSimple(i),this.next(),i=this.finishNode(p,"UpdateExpression")}}else(n||0===this.privateNameStack.length)&&this.options.checkPrivateFields&&this.unexpected(),i=this.parsePrivateIdent(),this.type!==u._in&&this.unexpected();return s||!this.eat(u.starstar)?i:t?void this.unexpected(this.lastTokStart):this.buildBinary(r,a,i,this.parseMaybeUnary(null,!1,!1,n),"**",!1)},y.parseExprSubscripts=function(e,t){var s=this.start,n=this.startLoc,i=this.parseExprAtom(e,t);if("ArrowFunctionExpression"===i.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return i;var r=this.parseSubscripts(i,s,n,!1,t);return e&&"MemberExpression"===r.type&&(e.parenthesizedAssign>=r.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=r.start&&(e.parenthesizedBind=-1),e.trailingComma>=r.start&&(e.trailingComma=-1)),r},y.parseSubscripts=function(e,t,s,n,i){for(var r=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,a=!1;;){var o=this.parseSubscript(e,t,s,n,r,a,i);if(o.optional&&(a=!0),o===e||"ArrowFunctionExpression"===o.type){if(a){var c=this.startNodeAt(t,s);c.expression=o,o=this.finishNode(c,"ChainExpression")}return o}e=o}},y.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(u.arrow)},y.parseSubscriptAsyncArrow=function(e,t,s,n){return this.parseArrowExpression(this.startNodeAt(e,t),s,!0,n)},y.parseSubscript=function(e,t,s,n,i,r,a){var o=this.options.ecmaVersion>=11,c=o&&this.eat(u.questionDot);n&&c&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var p=this.eat(u.bracketL);if(p||c&&this.type!==u.parenL&&this.type!==u.backQuote||this.eat(u.dot)){var h=this.startNodeAt(t,s);h.object=e,p?(h.property=this.parseExpression(),this.expect(u.bracketR)):this.type===u.privateId&&"Super"!==e.type?h.property=this.parsePrivateIdent():h.property=this.parseIdent("never"!==this.options.allowReserved),h.computed=!!p,o&&(h.optional=c),e=this.finishNode(h,"MemberExpression")}else if(!n&&this.eat(u.parenL)){var l=new _e,d=this.yieldPos,m=this.awaitPos,f=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(u.parenR,this.options.ecmaVersion>=8,!1,l);if(i&&!c&&this.shouldParseAsyncArrow())return this.checkPatternErrors(l,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=d,this.awaitPos=m,this.awaitIdentPos=f,this.parseSubscriptAsyncArrow(t,s,g,a);this.checkExpressionErrors(l,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=m||this.awaitPos,this.awaitIdentPos=f||this.awaitIdentPos;var x=this.startNodeAt(t,s);x.callee=e,x.arguments=g,o&&(x.optional=c),e=this.finishNode(x,"CallExpression")}else if(this.type===u.backQuote){(c||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var E=this.startNodeAt(t,s);E.tag=e,E.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(E,"TaggedTemplateExpression")}return e},y.parseExprAtom=function(e,t,s){this.type===u.slash&&this.readRegexp();var n,i=this.potentialArrowAt===this.start;switch(this.type){case u._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),n=this.startNode(),this.next(),this.type===u.parenL&&!this.allowDirectSuper&&this.raise(n.start,"super() call outside constructor of a subclass"),this.type!==u.dot&&this.type!==u.bracketL&&this.type!==u.parenL&&this.unexpected(),this.finishNode(n,"Super");case u._this:return n=this.startNode(),this.next(),this.finishNode(n,"ThisExpression");case u.name:var r=this.start,a=this.startLoc,o=this.containsEsc,c=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===c.name&&!this.canInsertSemicolon()&&this.eat(u._function))return this.overrideContext(k.f_expr),this.parseFunction(this.startNodeAt(r,a),0,!1,!0,t);if(i&&!this.canInsertSemicolon()){if(this.eat(u.arrow))return this.parseArrowExpression(this.startNodeAt(r,a),[c],!1,t);if(this.options.ecmaVersion>=8&&"async"===c.name&&this.type===u.name&&!o&&(!this.potentialArrowInForAwait||"of"!==this.value||this.containsEsc))return c=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(u.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,a),[c],!0,t)}return c;case u.regexp:var p=this.value;return(n=this.parseLiteral(p.value)).regex={pattern:p.pattern,flags:p.flags},n;case u.num:case u.string:return this.parseLiteral(this.value);case u._null:case u._true:case u._false:return(n=this.startNode()).value=this.type===u._null?null:this.type===u._true,n.raw=this.type.keyword,this.next(),this.finishNode(n,"Literal");case u.parenL:var h=this.start,l=this.parseParenAndDistinguishExpression(i,t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(e.parenthesizedAssign=h),e.parenthesizedBind<0&&(e.parenthesizedBind=h)),l;case u.bracketL:return n=this.startNode(),this.next(),n.elements=this.parseExprList(u.bracketR,!0,!0,e),this.finishNode(n,"ArrayExpression");case u.braceL:return this.overrideContext(k.b_expr),this.parseObj(!1,e);case u._function:return n=this.startNode(),this.next(),this.parseFunction(n,0);case u._class:return this.parseClass(this.startNode(),!1);case u._new:return this.parseNew();case u.backQuote:return this.parseTemplate();case u._import:return this.options.ecmaVersion>=11?this.parseExprImport(s):this.unexpected();default:return this.parseExprAtomDefault()}},y.parseExprAtomDefault=function(){this.unexpected()},y.parseExprImport=function(e){var t=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===u.parenL&&!e)return this.parseDynamicImport(t);if(this.type===u.dot){var s=this.startNodeAt(t.start,t.loc&&t.loc.start);return s.name="import",t.meta=this.finishNode(s,"Identifier"),this.parseImportMeta(t)}this.unexpected()},y.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(u.parenR)?e.options=null:(this.expect(u.comma),this.afterTrailingComma(u.parenR)?e.options=null:(e.options=this.parseMaybeAssign(),this.eat(u.parenR)||(this.expect(u.comma),this.afterTrailingComma(u.parenR)||this.unexpected())));else if(!this.eat(u.parenR)){var t=this.start;this.eat(u.comma)&&this.eat(u.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},y.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},y.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=null!=t.value?t.value.toString():t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},y.parseParenExpression=function(){this.expect(u.parenL);var e=this.parseExpression();return this.expect(u.parenR),e},y.shouldParseArrow=function(e){return!this.canInsertSemicolon()},y.parseParenAndDistinguishExpression=function(e,t){var s,n=this.start,i=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,c=this.startLoc,p=[],h=!0,l=!1,d=new _e,m=this.yieldPos,f=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==u.parenR;){if(h?h=!1:this.expect(u.comma),r&&this.afterTrailingComma(u.parenR,!0)){l=!0;break}if(this.type===u.ellipsis){a=this.start,p.push(this.parseParenItem(this.parseRestBinding())),this.type===u.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}p.push(this.parseMaybeAssign(!1,d,this.parseParenItem))}var g=this.lastTokEnd,x=this.lastTokEndLoc;if(this.expect(u.parenR),e&&this.shouldParseArrow(p)&&this.eat(u.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=m,this.awaitPos=f,this.parseParenArrowList(n,i,p,t);(!p.length||l)&&this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(d,!0),this.yieldPos=m||this.yieldPos,this.awaitPos=f||this.awaitPos,p.length>1?((s=this.startNodeAt(o,c)).expressions=p,this.finishNodeAt(s,"SequenceExpression",g,x)):s=p[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var E=this.startNodeAt(n,i);return E.expression=s,this.finishNode(E,"ParenthesizedExpression")}return s},y.parseParenItem=function(e){return e},y.parseParenArrowList=function(e,t,s,n){return this.parseArrowExpression(this.startNodeAt(e,t),s,!1,n)};var es=[];y.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===u.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);t.name="new",e.meta=this.finishNode(t,"Identifier"),this.next();var s=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),s&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(e.start,"'new.target' can only be used in functions and class static block"),this.finishNode(e,"MetaProperty")}var n=this.start,i=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),n,i,!0,!1),this.eat(u.parenL)?e.arguments=this.parseExprList(u.parenR,this.options.ecmaVersion>=8,!1):e.arguments=es,this.finishNode(e,"NewExpression")},y.parseTemplateElement=function(e){var t=e.isTagged,s=this.startNode();return this.type===u.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),s.value={raw:this.value.replace(/\r\n?/g,"\n"),cooked:null}):s.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),s.tail=this.type===u.backQuote,this.finishNode(s,"TemplateElement")},y.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var s=this.startNode();this.next(),s.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(s.quasis=[n];!n.tail;)this.type===u.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(u.dollarBraceL),s.expressions.push(this.parseExpression()),this.expect(u.braceR),s.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(s,"TemplateLiteral")},y.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===u.name||this.type===u.num||this.type===u.string||this.type===u.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===u.star)&&!V.test(this.input.slice(this.lastTokEnd,this.start))},y.parseObj=function(e,t){var s=this.startNode(),n=!0,i={};for(s.properties=[],this.next();!this.eat(u.braceR);){if(n)n=!1;else if(this.expect(u.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(u.braceR))break;var r=this.parseProperty(e,t);e||this.checkPropClash(r,i,t),s.properties.push(r)}return this.finishNode(s,e?"ObjectPattern":"ObjectExpression")},y.parseProperty=function(e,t){var s,n,i,r,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(u.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===u.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(a.argument=this.parseMaybeAssign(!1,t),this.type===u.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,r=this.startLoc),e||(s=this.eat(u.star)));var o=this.containsEsc;return this.parsePropertyName(a),!e&&!o&&this.options.ecmaVersion>=8&&!s&&this.isAsyncProp(a)?(n=!0,s=this.options.ecmaVersion>=9&&this.eat(u.star),this.parsePropertyName(a)):n=!1,this.parsePropertyValue(a,e,s,n,i,r,t,o),this.finishNode(a,"Property")},y.parseGetterSetter=function(e){var t=e.key.name;this.parsePropertyName(e),e.value=this.parseMethod(!1),e.kind=t;var s="get"===e.kind?0:1;if(e.value.params.length!==s){var n=e.value.start;"get"===e.kind?this.raiseRecoverable(n,"getter should have no params"):this.raiseRecoverable(n,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")},y.parsePropertyValue=function(e,t,s,n,i,r,a,o){(s||n)&&this.type===u.colon&&this.unexpected(),this.eat(u.colon)?(e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init"):this.options.ecmaVersion>=6&&this.type===u.parenL?(t&&this.unexpected(),e.method=!0,e.value=this.parseMethod(s,n),e.kind="init"):t||o||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===u.comma||this.type===u.braceR||this.type===u.eq?this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((s||n)&&this.unexpected(),this.checkUnreserved(e.key),"await"===e.key.name&&!this.awaitIdentPos&&(this.awaitIdentPos=i),t?e.value=this.parseMaybeDefault(i,r,this.copyNode(e.key)):this.type===u.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,r,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.kind="init",e.shorthand=!0):this.unexpected():((s||n)&&this.unexpected(),this.parseGetterSetter(e))},y.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(u.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(u.bracketR),e.key;e.computed=!1}return e.key=this.type===u.num||this.type===u.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},y.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},y.parseMethod=function(e,t,s){var n=this.startNode(),i=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(We(t,n.generator)|we|(s?ut:0)),this.expect(u.parenL),n.params=this.parseBindingList(u.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0,!1),this.yieldPos=i,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(n,"FunctionExpression")},y.parseArrowExpression=function(e,t,s,n){var i=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(We(s,!1)|He),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!s),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1,n),this.yieldPos=i,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(e,"ArrowFunctionExpression")},y.parseFunctionBody=function(e,t,s,n){var i=t&&this.type!==u.braceL,r=this.strict,a=!1;if(i)e.body=this.parseMaybeAssign(n),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!r||o)&&((a=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var c=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!r&&!a&&!t&&!s&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,pt),e.body=this.parseBlock(!1,void 0,a&&!r),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=c}this.exitScope()},y.isSimpleParamList=function(e){for(var t=0,s=e;t<s.length;t+=1){if("Identifier"!==s[t].type)return!1}return!0},y.checkParams=function(e,t){for(var s=Object.create(null),n=0,i=e.params;n<i.length;n+=1){var r=i[n];this.checkLValInnerPattern(r,Ue,t?null:s)}},y.parseExprList=function(e,t,s,n){for(var i=[],r=!0;!this.eat(e);){if(r)r=!1;else if(this.expect(u.comma),t&&this.afterTrailingComma(e))break;var a=void 0;s&&this.type===u.comma?a=null:this.type===u.ellipsis?(a=this.parseSpread(n),n&&this.type===u.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):a=this.parseMaybeAssign(!1,n),i.push(a)}return i},y.checkUnreserved=function(e){var t=e.start,s=e.end,n=e.name;(this.inGenerator&&"yield"===n&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&Pe)&&"arguments"===n&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&("arguments"===n||"await"===n)&&this.raise(t,"Cannot use "+n+" in class static initialization block"),this.keywords.test(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,s).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&(!this.inAsync&&"await"===n&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))},y.parseIdent=function(e){var t=this.parseIdentNode();return this.next(!!e),this.finishNode(t,"Identifier"),e||(this.checkUnreserved(t),"await"===t.name&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t},y.parseIdentNode=function(){var e=this.startNode();return this.type===u.name?e.name=this.value:this.type.keyword?(e.name=this.type.keyword,("class"===e.name||"function"===e.name)&&(this.lastTokEnd!==this.lastTokStart+1||46!==this.input.charCodeAt(this.lastTokStart))&&this.context.pop(),this.type=u.name):this.unexpected(),e},y.parsePrivateIdent=function(){var e=this.startNode();return this.type===u.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,"PrivateIdentifier"),this.options.checkPrivateFields&&(0===this.privateNameStack.length?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e)),e},y.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===u.semi||this.canInsertSemicolon()||this.type!==u.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(u.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},y.parseAwait=function(e){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0,!1,e),this.finishNode(t,"AwaitExpression")};var ve=I.prototype;ve.raise=function(e,t){var s=at(this.input,e);t+=" ("+s.line+":"+s.column+")",this.sourceFile&&(t+=" in "+this.sourceFile);var n=new SyntaxError(t);throw n.pos=e,n.loc=s,n.raisedAt=this.pos,n},ve.raiseRecoverable=ve.raise,ve.curPosition=function(){if(this.options.locations)return new me(this.curLine,this.pos-this.lineStart)};var ee=I.prototype,ts=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};ee.enterScope=function(e){this.scopeStack.push(new ts(e))},ee.exitScope=function(){this.scopeStack.pop()},ee.treatFunctionsAsVarInScope=function(e){return e.flags&he||!this.inModule&&e.flags&ge},ee.declareName=function(e,t,s){var n=!1;if(t===Y){var i=this.currentScope();n=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&i.flags&ge&&delete this.undefinedExports[e]}else if(t===ht){this.currentScope().lexical.push(e)}else if(t===lt){var r=this.currentScope();n=this.treatFunctionsAsVar?r.lexical.indexOf(e)>-1:r.lexical.indexOf(e)>-1||r.var.indexOf(e)>-1,r.functions.push(e)}else for(var a=this.scopeStack.length-1;a>=0;--a){var o=this.scopeStack[a];if(o.lexical.indexOf(e)>-1&&!(o.flags&ct&&o.lexical[0]===e)||!this.treatFunctionsAsVarInScope(o)&&o.functions.indexOf(e)>-1){n=!0;break}if(o.var.push(e),this.inModule&&o.flags&ge&&delete this.undefinedExports[e],o.flags&Pe)break}n&&this.raiseRecoverable(s,"Identifier '"+e+"' has already been declared")},ee.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},ee.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},ee.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&(Pe|xe|ne))return t}},ee.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&(Pe|xe|ne)&&!(t.flags&He))return t}};var ke=function(e,t,s){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new Ae(e,s)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},Ee=I.prototype;function mt(e,t,s,n){return e.type=t,e.end=s,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=s),e}Ee.startNode=function(){return new ke(this,this.start,this.startLoc)},Ee.startNodeAt=function(e,t){return new ke(this,e,t)},Ee.finishNode=function(e,t){return mt.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Ee.finishNodeAt=function(e,t,s,n){return mt.call(this,e,t,s,n)},Ee.copyNode=function(e){var t=new ke(this,e.start,this.startLoc);for(var s in e)t[s]=e[s];return t};var ss="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",gt="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",xt=gt+" Extended_Pictographic",Et=xt,bt=xt+" EBase EComp EMod EPres ExtPict",Ct=bt,is=bt,ns={9:gt,10:xt,11:xt,12:bt,13:bt,14:is},rs="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",as={9:"",10:"",11:"",12:"",13:"",14:rs},Ze="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",yt="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",vt=yt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",St=vt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Tt=St+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",At=Tt+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",os=At+" "+ss,cs={9:yt,10:vt,11:St,12:Tt,13:At,14:os},wt={};function us(e){var t=wt[e]={binary:Z(ns[e]+" "+Ze),binaryOfStrings:Z(as[e]),nonBinary:{General_Category:Z(Ze),Script:Z(cs[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}for(var Oe=0,Je=[9,10,11,12,13,14];Oe<Je.length;Oe+=1){var ls=Je[Oe];us(ls)}var g=I.prototype,Se=function(e,t){this.parent=e,this.base=t||this};Se.prototype.separatedFrom=function(e){for(var t=this;t;t=t.parent)for(var s=e;s;s=s.parent)if(t.base===s.base&&t!==s)return!0;return!1},Se.prototype.sibling=function(){return new Se(this.parent,this.base)};var K=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":"")+(e.options.ecmaVersion>=15?"v":""),this.unicodeProperties=wt[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};function hs(e){for(var t in e)return!0;return!1}function ps(e){return 105===e||109===e||115===e}function Pt(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function fs(e){return q(e,!0)||36===e||95===e}function ds(e){return J(e,!0)||36===e||95===e||8204===e||8205===e}function _t(e){return e>=65&&e<=90||e>=97&&e<=122}function ms(e){return e>=0&&e<=1114111}K.prototype.reset=function(e,t,s){var n=-1!==s.indexOf("v"),i=-1!==s.indexOf("u");this.start=0|e,this.source=t+"",this.flags=s,n&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=i&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=i&&this.parser.options.ecmaVersion>=9)},K.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},K.prototype.at=function(e,t){void 0===t&&(t=!1);var s=this.source,n=s.length;if(e>=n)return-1;var i=s.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=n)return i;var r=s.charCodeAt(e+1);return r>=56320&&r<=57343?(i<<10)+r-56613888:i},K.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var s=this.source,n=s.length;if(e>=n)return n;var i,r=s.charCodeAt(e);return!t&&!this.switchU||r<=55295||r>=57344||e+1>=n||(i=s.charCodeAt(e+1))<56320||i>57343?e+1:e+2},K.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},K.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},K.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},K.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},K.prototype.eatChars=function(e,t){void 0===t&&(t=!1);for(var s=this.pos,n=0,i=e;n<i.length;n+=1){var r=i[n],a=this.at(s,t);if(-1===a||a!==r)return!1;s=this.nextIndex(s,t)}return this.pos=s,!0},g.validateRegExpFlags=function(e){for(var t=e.validFlags,s=e.flags,n=!1,i=!1,r=0;r<s.length;r++){var a=s.charAt(r);-1===t.indexOf(a)&&this.raise(e.start,"Invalid regular expression flag"),s.indexOf(a,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag"),"u"===a&&(n=!0),"v"===a&&(i=!0)}this.options.ecmaVersion>=15&&n&&i&&this.raise(e.start,"Invalid regular expression flag")},g.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&hs(e.groupNames)&&(e.switchN=!0,this.regexp_pattern(e))},g.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames=Object.create(null),e.backReferenceNames.length=0,e.branchID=null,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,s=e.backReferenceNames;t<s.length;t+=1){var n=s[t];e.groupNames[n]||e.raise("Invalid named capture referenced")}},g.regexp_disjunction=function(e){var t=this.options.ecmaVersion>=16;for(t&&(e.branchID=new Se(e.branchID,null)),this.regexp_alternative(e);e.eat(124);)t&&(e.branchID=e.branchID.sibling()),this.regexp_alternative(e);t&&(e.branchID=e.branchID.parent),this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},g.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},g.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},g.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var s=!1;if(this.options.ecmaVersion>=9&&(s=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!s,!0}return e.pos=t,!1},g.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},g.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},g.regexp_eatBracedQuantifier=function(e,t){var s=e.pos;if(e.eat(123)){var n=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=s}return!1},g.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},g.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},g.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)){if(this.options.ecmaVersion>=16){var s=this.regexp_eatModifiers(e),n=e.eat(45);if(s||n){for(var i=0;i<s.length;i++){var r=s.charAt(i);s.indexOf(r,i+1)>-1&&e.raise("Duplicate regular expression modifiers")}if(n){var a=this.regexp_eatModifiers(e);!s&&!a&&58===e.current()&&e.raise("Invalid regular expression modifiers");for(var o=0;o<a.length;o++){var c=a.charAt(o);(a.indexOf(c,o+1)>-1||s.indexOf(c)>-1)&&e.raise("Duplicate regular expression modifiers")}}}}if(e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}}e.pos=t}return!1},g.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},g.regexp_eatModifiers=function(e){for(var t="",s=0;-1!==(s=e.current())&&ps(s);)t+=G(s),e.advance();return t},g.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},g.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},g.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!Pt(t)&&(e.lastIntValue=t,e.advance(),!0)},g.regexp_eatPatternCharacters=function(e){for(var t=e.pos,s=0;-1!==(s=e.current())&&!Pt(s);)e.advance();return e.pos!==t},g.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},g.regexp_groupSpecifier=function(e){if(e.eat(63)){this.regexp_eatGroupName(e)||e.raise("Invalid group");var t=this.options.ecmaVersion>=16,s=e.groupNames[e.lastStringValue];if(s)if(t)for(var n=0,i=s;n<i.length;n+=1){i[n].separatedFrom(e.branchID)||e.raise("Duplicate capture group name")}else e.raise("Duplicate capture group name");t?(s||(e.groupNames[e.lastStringValue]=[])).push(e.branchID):e.groupNames[e.lastStringValue]=!0}},g.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},g.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=G(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=G(e.lastIntValue);return!0}return!1},g.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,s=this.options.ecmaVersion>=11,n=e.current(s);return e.advance(s),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e,s)&&(n=e.lastIntValue),fs(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},g.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,s=this.options.ecmaVersion>=11,n=e.current(s);return e.advance(s),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e,s)&&(n=e.lastIntValue),ds(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},g.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},g.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var s=e.lastIntValue;if(e.switchU)return s>e.maxBackReference&&(e.maxBackReference=s),!0;if(s<=e.numCapturingParens)return!0;e.pos=t}return!1},g.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},g.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},g.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},g.regexp_eatZero=function(e){return 48===e.current()&&!Ie(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},g.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},g.regexp_eatControlLetter=function(e){var t=e.current();return!!_t(t)&&(e.lastIntValue=t%32,e.advance(),!0)},g.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var s=e.pos,n=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var i=e.lastIntValue;if(n&&i>=55296&&i<=56319){var r=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(a>=56320&&a<=57343)return e.lastIntValue=1024*(i-55296)+(a-56320)+65536,!0}e.pos=r,e.lastIntValue=i}return!0}if(n&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&ms(e.lastIntValue))return!0;n&&e.raise("Invalid unicode escape"),e.pos=s}return!1},g.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},g.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1};var kt=0,Q=1,B=2;function gs(e){return 100===e||68===e||115===e||83===e||119===e||87===e}function It(e){return _t(e)||95===e}function xs(e){return It(e)||Ie(e)}function Es(e){return 33===e||e>=35&&e<=38||e>=42&&e<=44||46===e||e>=58&&e<=64||94===e||96===e||126===e}function bs(e){return 40===e||41===e||45===e||47===e||e>=91&&e<=93||e>=123&&e<=125}function Cs(e){return 33===e||35===e||37===e||38===e||44===e||45===e||e>=58&&e<=62||64===e||96===e||126===e}function Ie(e){return e>=48&&e<=57}function Nt(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Mt(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function Rt(e){return e>=48&&e<=55}g.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(gs(t))return e.lastIntValue=-1,e.advance(),Q;var s=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((s=80===t)||112===t)){var n;if(e.lastIntValue=-1,e.advance(),e.eat(123)&&(n=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return s&&n===B&&e.raise("Invalid property name"),n;e.raise("Invalid property name")}return kt},g.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var s=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,s,n),Q}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i)}return kt},g.regexp_validateUnicodePropertyNameAndValue=function(e,t,s){le(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(s)||e.raise("Invalid property value")},g.regexp_validateUnicodePropertyNameOrValue=function(e,t){return e.unicodeProperties.binary.test(t)?Q:e.switchV&&e.unicodeProperties.binaryOfStrings.test(t)?B:void e.raise("Invalid property name")},g.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";It(t=e.current());)e.lastStringValue+=G(t),e.advance();return""!==e.lastStringValue},g.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";xs(t=e.current());)e.lastStringValue+=G(t),e.advance();return""!==e.lastStringValue},g.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},g.regexp_eatCharacterClass=function(e){if(e.eat(91)){var t=e.eat(94),s=this.regexp_classContents(e);return e.eat(93)||e.raise("Unterminated character class"),t&&s===B&&e.raise("Negated character class may contain strings"),!0}return!1},g.regexp_classContents=function(e){return 93===e.current()?Q:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),Q)},g.regexp_nonEmptyClassRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var s=e.lastIntValue;e.switchU&&(-1===t||-1===s)&&e.raise("Invalid character class"),-1!==t&&-1!==s&&t>s&&e.raise("Range out of order in character class")}}},g.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var s=e.current();(99===s||Rt(s))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return 93!==n&&(e.lastIntValue=n,e.advance(),!0)},g.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},g.regexp_classSetExpression=function(e){var t,s=Q;if(!this.regexp_eatClassSetRange(e))if(t=this.regexp_eatClassSetOperand(e)){t===B&&(s=B);for(var n=e.pos;e.eatChars([38,38]);)38!==e.current()&&(t=this.regexp_eatClassSetOperand(e))?t!==B&&(s=Q):e.raise("Invalid character in character class");if(n!==e.pos)return s;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise("Invalid character in character class");if(n!==e.pos)return s}else e.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(e)){if(!(t=this.regexp_eatClassSetOperand(e)))return s;t===B&&(s=B)}},g.regexp_eatClassSetRange=function(e){var t=e.pos;if(this.regexp_eatClassSetCharacter(e)){var s=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){var n=e.lastIntValue;return-1!==s&&-1!==n&&s>n&&e.raise("Range out of order in character class"),!0}e.pos=t}return!1},g.regexp_eatClassSetOperand=function(e){return this.regexp_eatClassSetCharacter(e)?Q:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)},g.regexp_eatNestedClass=function(e){var t=e.pos;if(e.eat(91)){var s=e.eat(94),n=this.regexp_classContents(e);if(e.eat(93))return s&&n===B&&e.raise("Negated character class may contain strings"),n;e.pos=t}if(e.eat(92)){var i=this.regexp_eatCharacterClassEscape(e);if(i)return i;e.pos=t}return null},g.regexp_eatClassStringDisjunction=function(e){var t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){var s=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return s}else e.raise("Invalid escape");e.pos=t}return null},g.regexp_classStringDisjunctionContents=function(e){for(var t=this.regexp_classString(e);e.eat(124);)this.regexp_classString(e)===B&&(t=B);return t},g.regexp_classString=function(e){for(var t=0;this.regexp_eatClassSetCharacter(e);)t++;return 1===t?Q:B},g.regexp_eatClassSetCharacter=function(e){var t=e.pos;if(e.eat(92))return!(!this.regexp_eatCharacterEscape(e)&&!this.regexp_eatClassSetReservedPunctuator(e))||(e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1));var s=e.current();return!(s<0||s===e.lookahead()&&Es(s)||bs(s))&&(e.advance(),e.lastIntValue=s,!0)},g.regexp_eatClassSetReservedPunctuator=function(e){var t=e.current();return!!Cs(t)&&(e.lastIntValue=t,e.advance(),!0)},g.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!Ie(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},g.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},g.regexp_eatDecimalDigits=function(e){var t=e.pos,s=0;for(e.lastIntValue=0;Ie(s=e.current());)e.lastIntValue=10*e.lastIntValue+(s-48),e.advance();return e.pos!==t},g.regexp_eatHexDigits=function(e){var t=e.pos,s=0;for(e.lastIntValue=0;Nt(s=e.current());)e.lastIntValue=16*e.lastIntValue+Mt(s),e.advance();return e.pos!==t},g.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var s=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*s+e.lastIntValue:e.lastIntValue=8*t+s}else e.lastIntValue=t;return!0}return!1},g.regexp_eatOctalDigit=function(e){var t=e.current();return Rt(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},g.regexp_eatFixedHexDigits=function(e,t){var s=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var i=e.current();if(!Nt(i))return e.pos=s,!1;e.lastIntValue=16*e.lastIntValue+Mt(i),e.advance()}return!0};var qe=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new Ae(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},T=I.prototype;function ys(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function Ot(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}T.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new qe(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},T.getToken=function(){return this.next(),new qe(this)},typeof Symbol<"u"&&(T[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===u.eof,value:t}}}}),T.nextToken=function(){var e=this.curContext();return(!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(u.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},T.readToken=function(e){return q(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},T.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;var t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888},T.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,s=this.input.indexOf("*/",this.pos+=2);if(-1===s&&this.raise(this.pos-2,"Unterminated comment"),this.pos=s+2,this.options.locations)for(var n=void 0,i=t;(n=it(this.input,i,this.pos))>-1;)++this.curLine,i=this.lineStart=n;this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,s),t,this.pos,e,this.curPosition())},T.skipLineComment=function(e){for(var t=this.pos,s=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!ue(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,s,this.curPosition())},T.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&nt.test(String.fromCharCode(e))))break e;++this.pos}}},T.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var s=this.type;this.type=e,this.value=t,this.updateContext(s)},T.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(u.ellipsis)):(++this.pos,this.finishToken(u.dot))},T.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(u.assign,2):this.finishOp(u.slash,1)},T.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),s=1,n=42===e?u.star:u.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++s,n=u.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(u.assign,s+1):this.finishOp(n,s)},T.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(u.assign,3);return this.finishOp(124===e?u.logicalOR:u.logicalAND,2)}return 61===t?this.finishOp(u.assign,2):this.finishOp(124===e?u.bitwiseOR:u.bitwiseAND,1)},T.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(u.assign,2):this.finishOp(u.bitwiseXOR,1)},T.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!V.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(u.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(u.assign,2):this.finishOp(u.plusMin,1)},T.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),s=1;return t===e?(s=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+s)?this.finishOp(u.assign,s+1):this.finishOp(u.bitShift,s)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(s=2),this.finishOp(u.relational,s)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},T.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(u.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(u.arrow)):this.finishOp(61===e?u.eq:u.prefix,1)},T.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var s=this.input.charCodeAt(this.pos+2);if(s<48||s>57)return this.finishOp(u.questionDot,2)}if(63===t){if(e>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(u.assign,3);return this.finishOp(u.coalesce,2)}}return this.finishOp(u.question,1)},T.readToken_numberSign=function(){var e=35;if(this.options.ecmaVersion>=13&&(++this.pos,q(e=this.fullCharCodeAtPos(),!0)||92===e))return this.finishToken(u.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+G(e)+"'")},T.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(u.parenL);case 41:return++this.pos,this.finishToken(u.parenR);case 59:return++this.pos,this.finishToken(u.semi);case 44:return++this.pos,this.finishToken(u.comma);case 91:return++this.pos,this.finishToken(u.bracketL);case 93:return++this.pos,this.finishToken(u.bracketR);case 123:return++this.pos,this.finishToken(u.braceL);case 125:return++this.pos,this.finishToken(u.braceR);case 58:return++this.pos,this.finishToken(u.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(u.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(u.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+G(e)+"'")},T.finishOp=function(e,t){var s=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,s)},T.readRegexp=function(){for(var e,t,s=this.pos;;){this.pos>=this.input.length&&this.raise(s,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(V.test(n)&&this.raise(s,"Unterminated regular expression"),e)e=!1;else{if("["===n)t=!0;else if("]"===n&&t)t=!1;else if("/"===n&&!t)break;e="\\"===n}++this.pos}var i=this.input.slice(s,this.pos);++this.pos;var r=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(r);var o=this.regexpState||(this.regexpState=new K(this));o.reset(s,i,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var c=null;try{c=new RegExp(i,a)}catch{}return this.finishToken(u.regexp,{pattern:i,flags:a,value:c})},T.readInt=function(e,t,s){for(var n=this.options.ecmaVersion>=12&&void 0===t,i=s&&48===this.input.charCodeAt(this.pos),r=this.pos,a=0,o=0,c=0,p=t??1/0;c<p;++c,++this.pos){var h=this.input.charCodeAt(this.pos),l=void 0;if(n&&95===h)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===o&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===c&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),o=h;else{if((l=h>=97?h-97+10:h>=65?h-65+10:h>=48&&h<=57?h-48:1/0)>=e)break;o=h,a=a*e+l}}return n&&95===o&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||null!=t&&this.pos-r!==t?null:a},T.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var s=this.readInt(e);return null==s&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(s=Ot(this.input.slice(t,this.pos)),++this.pos):q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(u.num,s)},T.readNumber=function(e){var t=this.pos;!e&&null===this.readInt(10,void 0,!0)&&this.raise(t,"Invalid number");var s=this.pos-t>=2&&48===this.input.charCodeAt(t);s&&this.strict&&this.raise(t,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!s&&!e&&this.options.ecmaVersion>=11&&110===n){var i=Ot(this.input.slice(t,this.pos));return++this.pos,q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(u.num,i)}s&&/[89]/.test(this.input.slice(t,this.pos))&&(s=!1),46===n&&!s&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(69===n||101===n)&&!s&&((43===(n=this.input.charCodeAt(++this.pos))||45===n)&&++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=ys(this.input.slice(t,this.pos),s);return this.finishToken(u.num,r)},T.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},T.readString=function(e){for(var t="",s=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;92===n?(t+=this.input.slice(s,this.pos),t+=this.readEscapedChar(!1),s=this.pos):8232===n||8233===n?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(ue(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(s,this.pos++),this.finishToken(u.string,t)};var Lt={};T.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==Lt)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},T.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Lt;this.raise(e,t)},T.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var s=this.input.charCodeAt(this.pos);if(96===s||36===s&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==u.template&&this.type!==u.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(u.template,e)):36===s?(this.pos+=2,this.finishToken(u.dollarBraceL)):(++this.pos,this.finishToken(u.backQuote));if(92===s)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(ue(s)){switch(e+=this.input.slice(t,this.pos),++this.pos,s){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(s)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},T.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(u.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":"\n"===this.input[this.pos+1]&&++this.pos;case"\n":case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1}this.raise(this.start,"Unterminated template")},T.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return G(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),e){var s=this.pos-1;this.invalidStringToken(s,"Invalid escape sequence in template string")}default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(n,8);return i>255&&(n=n.slice(0,-1),i=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),("0"!==n||56===t||57===t)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return ue(t)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(t)}},T.readHexChar=function(e){var t=this.pos,s=this.readInt(16,e);return null===s&&this.invalidStringToken(t,"Bad character escape sequence"),s},T.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,s=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(J(i,n))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(s,this.pos);var r=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?q:J)(a,n)||this.invalidStringToken(r,"Invalid Unicode escape"),e+=G(a),s=this.pos}t=!1}return e+this.input.slice(s,this.pos)},T.readWord=function(){var e=this.readWord1(),t=u.name;return this.keywords.test(e)&&(t=$e[e]),this.finishToken(t,e)};var vs="8.15.0";function W(e,t){return I.parse(e,t)}function U(e,t,s,n,i){s||(s=m),function e(n,i,r){var a=r||n.type;s[a](n,i,e),t[a]&&t[a](n,i)}(e,n,i)}function Ss(e,t,s,n,i){var r=[];s||(s=m),function e(n,i,a){var o=a||n.type,c=n!==r[r.length-1];c&&r.push(n),s[o](n,i,e),t[o]&&t[o](n,i||r,r),c&&r.pop()}(e,n,i)}function Xe(e,t,s){s(e,t)}function re(e,t,s){}I.acorn={Parser:I,version:vs,defaultOptions:Ve,Position:me,SourceLocation:Ae,getLineInfo:at,Node:ke,TokenType:w,tokTypes:u,keywordTypes:$e,TokContext:H,tokContexts:k,isIdentifierChar:J,isIdentifierStart:q,Token:qe,isNewLine:ue,lineBreak:V,lineBreakG:Ut,nonASCIIwhitespace:nt};var m={};m.Program=m.BlockStatement=m.StaticBlock=function(e,t,s){for(var n=0,i=e.body;n<i.length;n+=1){s(i[n],t,"Statement")}},m.Statement=Xe,m.EmptyStatement=re,m.ExpressionStatement=m.ParenthesizedExpression=m.ChainExpression=function(e,t,s){return s(e.expression,t,"Expression")},m.IfStatement=function(e,t,s){s(e.test,t,"Expression"),s(e.consequent,t,"Statement"),e.alternate&&s(e.alternate,t,"Statement")},m.LabeledStatement=function(e,t,s){return s(e.body,t,"Statement")},m.BreakStatement=m.ContinueStatement=re,m.WithStatement=function(e,t,s){s(e.object,t,"Expression"),s(e.body,t,"Statement")},m.SwitchStatement=function(e,t,s){s(e.discriminant,t,"Expression");for(var n=0,i=e.cases;n<i.length;n+=1){s(i[n],t)}},m.SwitchCase=function(e,t,s){e.test&&s(e.test,t,"Expression");for(var n=0,i=e.consequent;n<i.length;n+=1){s(i[n],t,"Statement")}},m.ReturnStatement=m.YieldExpression=m.AwaitExpression=function(e,t,s){e.argument&&s(e.argument,t,"Expression")},m.ThrowStatement=m.SpreadElement=function(e,t,s){return s(e.argument,t,"Expression")},m.TryStatement=function(e,t,s){s(e.block,t,"Statement"),e.handler&&s(e.handler,t),e.finalizer&&s(e.finalizer,t,"Statement")},m.CatchClause=function(e,t,s){e.param&&s(e.param,t,"Pattern"),s(e.body,t,"Statement")},m.WhileStatement=m.DoWhileStatement=function(e,t,s){s(e.test,t,"Expression"),s(e.body,t,"Statement")},m.ForStatement=function(e,t,s){e.init&&s(e.init,t,"ForInit"),e.test&&s(e.test,t,"Expression"),e.update&&s(e.update,t,"Expression"),s(e.body,t,"Statement")},m.ForInStatement=m.ForOfStatement=function(e,t,s){s(e.left,t,"ForInit"),s(e.right,t,"Expression"),s(e.body,t,"Statement")},m.ForInit=function(e,t,s){"VariableDeclaration"===e.type?s(e,t):s(e,t,"Expression")},m.DebuggerStatement=re,m.FunctionDeclaration=function(e,t,s){return s(e,t,"Function")},m.VariableDeclaration=function(e,t,s){for(var n=0,i=e.declarations;n<i.length;n+=1){s(i[n],t)}},m.VariableDeclarator=function(e,t,s){s(e.id,t,"Pattern"),e.init&&s(e.init,t,"Expression")},m.Function=function(e,t,s){e.id&&s(e.id,t,"Pattern");for(var n=0,i=e.params;n<i.length;n+=1){s(i[n],t,"Pattern")}s(e.body,t,e.expression?"Expression":"Statement")},m.Pattern=function(e,t,s){"Identifier"===e.type?s(e,t,"VariablePattern"):"MemberExpression"===e.type?s(e,t,"MemberPattern"):s(e,t)},m.VariablePattern=re,m.MemberPattern=Xe,m.RestElement=function(e,t,s){return s(e.argument,t,"Pattern")},m.ArrayPattern=function(e,t,s){for(var n=0,i=e.elements;n<i.length;n+=1){var r=i[n];r&&s(r,t,"Pattern")}},m.ObjectPattern=function(e,t,s){for(var n=0,i=e.properties;n<i.length;n+=1){var r=i[n];"Property"===r.type?(r.computed&&s(r.key,t,"Expression"),s(r.value,t,"Pattern")):"RestElement"===r.type&&s(r.argument,t,"Pattern")}},m.Expression=Xe,m.ThisExpression=m.Super=m.MetaProperty=re,m.ArrayExpression=function(e,t,s){for(var n=0,i=e.elements;n<i.length;n+=1){var r=i[n];r&&s(r,t,"Expression")}},m.ObjectExpression=function(e,t,s){for(var n=0,i=e.properties;n<i.length;n+=1){s(i[n],t)}},m.FunctionExpression=m.ArrowFunctionExpression=m.FunctionDeclaration,m.SequenceExpression=function(e,t,s){for(var n=0,i=e.expressions;n<i.length;n+=1){s(i[n],t,"Expression")}},m.TemplateLiteral=function(e,t,s){for(var n=0,i=e.quasis;n<i.length;n+=1){s(i[n],t)}for(var r=0,a=e.expressions;r<a.length;r+=1){s(a[r],t,"Expression")}},m.TemplateElement=re,m.UnaryExpression=m.UpdateExpression=function(e,t,s){s(e.argument,t,"Expression")},m.BinaryExpression=m.LogicalExpression=function(e,t,s){s(e.left,t,"Expression"),s(e.right,t,"Expression")},m.AssignmentExpression=m.AssignmentPattern=function(e,t,s){s(e.left,t,"Pattern"),s(e.right,t,"Expression")},m.ConditionalExpression=function(e,t,s){s(e.test,t,"Expression"),s(e.consequent,t,"Expression"),s(e.alternate,t,"Expression")},m.NewExpression=m.CallExpression=function(e,t,s){if(s(e.callee,t,"Expression"),e.arguments)for(var n=0,i=e.arguments;n<i.length;n+=1){s(i[n],t,"Expression")}},m.MemberExpression=function(e,t,s){s(e.object,t,"Expression"),e.computed&&s(e.property,t,"Expression")},m.ExportNamedDeclaration=m.ExportDefaultDeclaration=function(e,t,s){e.declaration&&s(e.declaration,t,"ExportNamedDeclaration"===e.type||e.declaration.id?"Statement":"Expression"),e.source&&s(e.source,t,"Expression")},m.ExportAllDeclaration=function(e,t,s){e.exported&&s(e.exported,t),s(e.source,t,"Expression")},m.ImportDeclaration=function(e,t,s){for(var n=0,i=e.specifiers;n<i.length;n+=1){s(i[n],t)}s(e.source,t,"Expression")},m.ImportExpression=function(e,t,s){s(e.source,t,"Expression")},m.ImportSpecifier=m.ImportDefaultSpecifier=m.ImportNamespaceSpecifier=m.Identifier=m.PrivateIdentifier=m.Literal=re,m.TaggedTemplateExpression=function(e,t,s){s(e.tag,t,"Expression"),s(e.quasi,t,"Expression")},m.ClassDeclaration=m.ClassExpression=function(e,t,s){return s(e,t,"Class")},m.Class=function(e,t,s){e.id&&s(e.id,t,"Pattern"),e.superClass&&s(e.superClass,t,"Expression"),s(e.body,t)},m.ClassBody=function(e,t,s){for(var n=0,i=e.body;n<i.length;n+=1){s(i[n],t)}},m.MethodDefinition=m.PropertyDefinition=m.Property=function(e,t,s){e.computed&&s(e.key,t,"Expression"),e.value&&s(e.value,t,"Expression")};const d={ATTR_PREFIXES:{COMPONENT:"pp-component",CONTEXT:"pp-context",LOOP:"pp-for",SPREAD:"pp-spread"},SCRIPT_TYPE:"text/pp",MAX_CACHE_SIZE:2e3,DEBOUNCE_MS:16,POOL_SIZE:10,MUSTACHE_PATTERN:/\{((?:[^{}]|\{(?:[^{}]|\{[^{}]*\})*\})*)\}/,MUSTACHE_SINGLE_PATTERN:/^\{((?:[^{}]|\{(?:[^{}]|\{[^{}]*\})*\})*)\}$/},Te=new Set(["true","false","null","undefined","this","window","document","console","Math","Date","JSON","Object","Array","return","let","const","var","if","else","for","while","switch","case","break","continue","function","new","in","of","typeof","instanceof","void","delete","try","catch","finally","class","extends","super","thisElement","eventObject","arguments"]);function Ts(e,t){let s;return(...n)=>{clearTimeout(s),s=window.setTimeout((()=>e(...n)),t)}}function Vt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ie(e){if(null==e||"boolean"==typeof e||"function"==typeof e||Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length)return"";if("number"==typeof e)return String(e);if("string"==typeof e)return e;if(Array.isArray(e))return e.map((e=>ie(e))).filter((e=>""!==e)).join("");if("object"==typeof e)try{return JSON.stringify(e)}catch{return"[object Object]"}return String(e)}class ae{static instance;walkerPool=[];traversalCache=new WeakMap;lastCacheTime=new WeakMap;CACHE_TTL=250;trackedElements=new Set;static getInstance(){return ae.instance||(ae.instance=new ae),ae.instance}acquireWalker(e,t,s){return document.createTreeWalker(e,t,s)}releaseWalker(e){this.walkerPool.length<3&&this.walkerPool.push(e)}getCachedTraversal(e,t,s){const n=Date.now(),i=this.traversalCache.get(e),r=this.lastCacheTime.get(e);if(i&&r&&n-r<this.CACHE_TTL){const e=i.get(t);if(e)return e}const a=s();return this.traversalCache.has(e)||(this.traversalCache.set(e,new Map),this.trackedElements.add(e)),this.traversalCache.get(e).set(t,a),this.lastCacheTime.set(e,n),a}traverseElementsAndText(e,t,s){const n=this.acquireWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),i=[],r=[];let a;for(;a=n.nextNode();)if(a.nodeType===Node.ELEMENT_NODE){const e=a;(!t||t(e))&&i.push(e)}else if(a.nodeType===Node.TEXT_NODE){const e=a;(!s||s(e))&&r.push(e)}return this.releaseWalker(n),{elements:i,textNodes:r}}cleanupCache(){const e=[];for(const t of this.trackedElements)document.contains(t)||e.push(t);e.forEach((e=>{this.traversalCache.delete(e),this.lastCacheTime.delete(e),this.trackedElements.delete(e)}))}}class L{static instance;componentElementsCache=new $(100);scriptElementsCache=new $(50);templateElementsCache=new $(50);selectorCache=new $(200);elementComponentCache=new WeakMap;parentComponentCache=new WeakMap;contextComponentCache=new WeakMap;elementDepthCache=new WeakMap;elementChildrenCache=new WeakMap;cacheHits=0;cacheMisses=0;static CACHE_KEYS={COMPONENT_ELEMENTS:e=>`comp:${e}`,SCRIPTS:(e,t)=>`scripts:${e}:${t}`,TEMPLATES:(e,t)=>`templates:${e}:${t}`,SELECTOR:e=>`sel:${e}`};static getInstance(){return L.instance||(L.instance=new L),L.instance}queryComponentElements(e){const t=L.CACHE_KEYS.COMPONENT_ELEMENTS(e);if(this.componentElementsCache.has(t))return this.cacheHits++,this.componentElementsCache.get(t);this.cacheMisses++;const s=Array.from(document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}="${e}"]`));return s.forEach((t=>{this.elementComponentCache.set(t,e)})),this.componentElementsCache.set(t,s),s}querySelectorAll(e){const t=L.CACHE_KEYS.SELECTOR(e);if(this.selectorCache.has(t))return this.cacheHits++,this.selectorCache.get(t);this.cacheMisses++;const s=Array.from(document.querySelectorAll(e));return this.selectorCache.set(t,s),s}getElementComponent(e){if(this.elementComponentCache.has(e))return this.cacheHits++,this.elementComponentCache.get(e);this.cacheMisses++;const t=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(t)return this.elementComponentCache.set(e,t),t;let s=e.parentElement;for(;s;){const t=s.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(t)return this.elementComponentCache.set(e,t),t;s=s.parentElement}return this.elementComponentCache.set(e,"app"),"app"}getContextComponent(e){if(this.contextComponentCache.has(e))return this.cacheHits++,this.contextComponentCache.get(e);this.cacheMisses++;const t=e.getAttribute(d.ATTR_PREFIXES.CONTEXT);let s;if(t)if("parent"===t){const t=this.getElementComponent(e);s=this.getParentOfComponent(t,e)}else s="app"===t?"app":t;else s=this.getElementComponent(e);return this.contextComponentCache.set(e,s),s}getParentOfComponent(e,t){if(this.parentComponentCache.has(t))return this.cacheHits++,this.parentComponentCache.get(t);if(this.cacheMisses++,"app"===e)return this.parentComponentCache.set(t,"app"),"app";let s=t;for(;s&&s.getAttribute(d.ATTR_PREFIXES.COMPONENT)!==e;)s=s.parentElement;if(!s)return this.parentComponentCache.set(t,"app"),"app";let n=s.parentElement;for(;n;){const e=n.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e)return this.parentComponentCache.set(t,e),e;n=n.parentElement}return this.parentComponentCache.set(t,"app"),"app"}getElementDepthCached(e){if(this.elementDepthCache.has(e))return this.cacheHits++,this.elementDepthCache.get(e);this.cacheMisses++;let t=0,s=e.parentElement;for(;s&&s!==document.body;)t++,s=s.parentElement;return this.elementDepthCache.set(e,t),t}getFirstComponentElement(e){const t=this.queryComponentElements(e);return t.length>0?t[0]:null}getComponentScripts(e,t){const s=L.CACHE_KEYS.SCRIPTS(e,t?.tagName||"global");if(this.scriptElementsCache.has(s))return this.cacheHits++,this.scriptElementsCache.get(s);this.cacheMisses++;let n=[];if(t){const e=t.querySelectorAll(`script[type="${d.SCRIPT_TYPE}"]`);for(const t of e)t instanceof HTMLScriptElement&&n.push(t)}else{const t=document.querySelectorAll(`script[type="${d.SCRIPT_TYPE}"]`);for(const s of t)if(s instanceof HTMLScriptElement){const t=s.getAttribute(d.ATTR_PREFIXES.COMPONENT);(t===e||!t&&!s.closest(`[${d.ATTR_PREFIXES.COMPONENT}]`))&&n.push(s)}}return this.scriptElementsCache.set(s,n),n}getComponentTemplates(e,t){const s=L.CACHE_KEYS.TEMPLATES(e,t?.tagName||"global");if(this.templateElementsCache.has(s))return this.cacheHits++,this.templateElementsCache.get(s);this.cacheMisses++;let n=[];if(t){const s=t.querySelectorAll("template[pp-for]");for(const t of s)t instanceof HTMLTemplateElement&&this.getElementComponent(t)===e&&n.push(t)}else{const t=document.querySelectorAll("template[pp-for]");for(const s of t)s instanceof HTMLTemplateElement&&this.getElementComponent(s)===e&&n.push(s)}return this.templateElementsCache.set(s,n),n}querySelector(e){const t=this.querySelectorAll(e);return t.length>0?t[0]:null}findElementForComponent(e,t){if("app"===t)return document.body;const s=this.queryComponentElements(t);return s.length>0?s[0]:null}invalidateCache(e){switch(e){case"components":this.componentElementsCache.clear();break;case"selectors":this.selectorCache.clear();break;case"scripts":this.scriptElementsCache.clear();break;case"templates":this.templateElementsCache.clear();break;default:this.clearAllCaches()}}invalidateByComponent(e){const t=L.CACHE_KEYS.COMPONENT_ELEMENTS(e);this.componentElementsCache.delete(t);const s=L.CACHE_KEYS.SCRIPTS(e,"global");this.scriptElementsCache.delete(s);const n=L.CACHE_KEYS.TEMPLATES(e,"global");this.templateElementsCache.delete(n),this.selectorCache.clear()}invalidateByPrefix(e){this.invalidateByComponent(e)}invalidateElement(e){this.elementComponentCache.delete(e),this.contextComponentCache.delete(e),this.parentComponentCache.delete(e),this.elementDepthCache.delete(e),this.elementChildrenCache.delete(e)}clearAllCaches(){this.componentElementsCache.clear(),this.scriptElementsCache.clear(),this.templateElementsCache.clear(),this.selectorCache.clear(),this.elementComponentCache=new WeakMap,this.parentComponentCache=new WeakMap,this.contextComponentCache=new WeakMap,this.elementDepthCache=new WeakMap,this.elementChildrenCache=new WeakMap}getCacheStats(){const e=this.cacheHits+this.cacheMisses;return{componentElements:this.componentElementsCache.getStats(),scriptElements:this.scriptElementsCache.getStats(),templateElements:this.templateElementsCache.getStats(),selectors:this.selectorCache.getStats(),global:{size:0,maxSize:-1,hitRate:e>0?this.cacheHits/e*100:0,hits:this.cacheHits,misses:this.cacheMisses}}}resetStats(){this.cacheHits=0,this.cacheMisses=0}}class As{subscriptions=new Map;elementSubscriptions=new WeakMap;keyIndex=new Map;cleanupQueue=new Set;cleanupScheduled=!1;addSubscription(e){this.subscriptions.set(e.id,e),e.element&&(this.elementSubscriptions.has(e.element)||this.elementSubscriptions.set(e.element,new Set),this.elementSubscriptions.get(e.element).add(e.id));for(const t of e.dependencies)this.keyIndex.has(t)||this.keyIndex.set(t,new Set),this.keyIndex.get(t).add(e.id)}removeSubscription(e){const t=this.subscriptions.get(e);if(t){if(this.subscriptions.delete(e),t.element){const s=this.elementSubscriptions.get(t.element);s&&(s.delete(e),0===s.size&&this.elementSubscriptions.delete(t.element))}for(const s of t.dependencies){const t=this.keyIndex.get(s);t&&(t.delete(e),0===t.size&&this.keyIndex.delete(s))}}}cleanupElement(e){const t=this.elementSubscriptions.get(e);t&&(t.forEach((e=>this.cleanupQueue.add(e))),this.scheduleCleanup())}scheduleCleanup(){this.cleanupScheduled||(this.cleanupScheduled=!0,queueMicrotask((()=>{this.processCleanupQueue(),this.cleanupScheduled=!1})))}processCleanupQueue(){for(const e of this.cleanupQueue)this.removeSubscription(e);this.cleanupQueue.clear()}getSubscription(e){return this.subscriptions.get(e)}getSubscriptionsForKey(e){return this.keyIndex.get(e)}getAllSubscriptions(){return new Map(this.subscriptions)}cleanupStaleSubscriptions(){const e=[];for(const[t,s]of this.subscriptions)s.element&&!document.contains(s.element)&&e.push(t);e.forEach((e=>this.removeSubscription(e)))}getStats(){return{totalSubscriptions:this.subscriptions.size,elementSubscriptions:this.elementSubscriptions instanceof WeakMap?-1:0,keyIndexes:this.keyIndex.size}}}class z{static instance;stateVariables=new Set;static FUNCTIONS_NEEDING_VALUE_TRANSFORM=new Set(["console.log","console.warn","console.error","console.info","console.debug","console.dir","console.table","console.trace","console.assert","JSON.stringify","JSON.parse","Object.keys","Object.values","Object.entries","Array.from","Array.isArray","Math.max","Math.min","Math.abs","Math.floor","Math.ceil","Math.round","alert","confirm","prompt","parseInt","parseFloat","Number","String","Boolean"]);static getInstance(){return z.instance||(z.instance=new z),z.instance}extractFunctionNames(e){const t=[];try{U(W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0}),{FunctionDeclaration:e=>{"Identifier"===e.id?.type&&t.push(e.id.name)},VariableDeclarator:e=>{"Identifier"===e.id?.type&&("ArrowFunctionExpression"===e.init?.type||"FunctionExpression"===e.init?.type)&&t.push(e.id.name)},AssignmentExpression:e=>{"Identifier"===e.left?.type&&("ArrowFunctionExpression"===e.right?.type||"FunctionExpression"===e.right?.type)&&t.push(e.left.name)}})}catch(e){console.error("AST function extraction error:",e)}return Array.from(new Set(t))}transformEffectDeclarations(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});let s=e;const n=[];return U(t,{CallExpression:t=>{const s=this.transformEffectCall(t,e);s&&n.push(s)}}),n.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s}catch(t){return console.error("Effect transformation error:",t),e}}transformEffectCall(e,t){if(!this.isPPEffectCall(e))return null;const s=e.arguments;if(s.length<2)return null;const n=s[1];if("ArrayExpression"!==n.type||!n.elements.some((e=>!!e&&("Identifier"===e.type||"MemberExpression"===e.type))))return null;const i=n.elements.map((e=>e?"Identifier"===e.type?`"${e.name}"`:"MemberExpression"===e.type?`"${this.extractMemberExpression(e,t)}"`:t.slice(e.start,e.end):"null")),r=t.slice(s[0].start,s[0].end),a=s.slice(2).map((e=>t.slice(e.start,e.end))).join(", "),o=`[${i.join(", ")}]`,c=a?`pp.effect(${r}, ${o}, ${a})`:`pp.effect(${r}, ${o})`;return{start:e.start,end:e.end,replacement:c}}extractMemberExpression(e,t){if("MemberExpression"!==e.type)return"Identifier"===e.type?e.name:t.slice(e.start,e.end);const s=this.extractMemberExpression(e.object,t);if(e.computed){return`${s}[${t.slice(e.property.start,e.property.end)}]`}return`${s}.${e.property.name||t.slice(e.property.start,e.property.end)}`}isPPEffectCall(e){return"MemberExpression"===e.callee?.type&&"Identifier"===e.callee.object?.type&&"pp"===e.callee.object.name&&"Identifier"===e.callee.property?.type&&"effect"===e.callee.property.name}transformStateDeclarations(e){this.stateVariables.clear();let t=this.transformStateDeclarationsOnly(e);return t=this.transformEffectDeclarations(t),t=this.transformUnsupportedStateUsages(t),t}transformStateDeclarationsOnlyOriginal(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});let s=e;const n=[];return U(t,{VariableDeclarator:t=>{const s=this.transformStateDeclarator(t,e);s&&n.push(s)}}),n.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s}catch(t){return console.error("AST transformation error:",t),e}}transformStateDeclarationsOnly(e){let t=this.transformStateDeclarationsOnlyOriginal(e);return t=this.transformDestructuringAssignments(t),t}transformUnsupportedStateUsages(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});this.collectStateVariables(t);let s=this.transformShorthandProperties(e);const n=W(s,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0}),i=[];return U(n,{SpreadElement:e=>{const t=this.transformSpreadElement(e,s);t&&i.push(t)},UnaryExpression:e=>{const t=this.transformUnaryExpression(e,s);t&&i.push(t)},BinaryExpression:e=>{const t=this.transformBinaryExpression(e,s);t&&i.push(t)},LogicalExpression:e=>{const t=this.transformLogicalExpression(e,s);t&&i.push(t)},ConditionalExpression:e=>{const t=this.transformConditionalExpression(e,s);t&&i.push(t)},IfStatement:e=>{const t=this.transformIfStatement(e,s);t&&i.push(t)},WhileStatement:e=>{const t=this.transformWhileStatement(e,s);t&&i.push(t)},ForStatement:e=>{const t=this.transformForStatement(e,s);t&&i.push(t)},ReturnStatement:e=>{const t=this.transformReturnStatement(e,s);t&&i.push(t)},VariableDeclarator:e=>{const t=this.transformVariableDeclarator(e,s);t&&i.push(t)},AssignmentExpression:e=>{const t=this.transformAssignmentExpression(e,s);t&&i.push(t)},CallExpression:e=>{const t=this.transformGeneralCallExpression(e,s);t&&i.push(t)}}),Ss(n,{Identifier:(e,t)=>{i.some((t=>e.start>=t.start&&e.end<=t.end))||this.stateVariables.has(e.name)&&(this.alreadyHasValue(e,s)||this.isPartOfStateDeclaration(e,t)||this.isPropertyName(e,t)||this.isMethodCallObject(e,t)||this.isPartOfPPCall(e,t)||this.isPartOfDestructuring(e,t)||i.push({start:e.start,end:e.end,replacement:`${e.name}.value`}))}}),i.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s=this.transformMultipleCallArguments(s),s}catch(t){return console.error("State usage transformation error:",t),e}}transformShorthandProperties(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});let s=e;const n=[];return U(t,{Property:e=>{if(e.shorthand&&"Identifier"===e.key?.type&&this.stateVariables.has(e.key.name)){const t=e.key.name,s=`${t}: ${t}.value`;n.push({start:e.start,end:e.end,replacement:s})}}}),n.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s}catch(t){return console.error("Shorthand property transformation error:",t),e}}transformLogicalExpression(e,t){return"Identifier"===e.left?.type&&this.stateVariables.has(e.left.name)&&!this.alreadyHasValue(e.left,t)?{start:e.left.start,end:e.left.end,replacement:`${e.left.name}.value`}:"Identifier"===e.right?.type&&this.stateVariables.has(e.right.name)&&!this.alreadyHasValue(e.right,t)?{start:e.right.start,end:e.right.end,replacement:`${e.right.name}.value`}:null}transformConditionalExpression(e,t){return"Identifier"===e.test?.type&&this.stateVariables.has(e.test.name)&&!this.alreadyHasValue(e.test,t)?{start:e.test.start,end:e.test.end,replacement:`${e.test.name}.value`}:"Identifier"===e.consequent?.type&&this.stateVariables.has(e.consequent.name)&&!this.alreadyHasValue(e.consequent,t)?{start:e.consequent.start,end:e.consequent.end,replacement:`${e.consequent.name}.value`}:"Identifier"===e.alternate?.type&&this.stateVariables.has(e.alternate.name)&&!this.alreadyHasValue(e.alternate,t)?{start:e.alternate.start,end:e.alternate.end,replacement:`${e.alternate.name}.value`}:null}transformIfStatement(e,t){return this.transformExpressionNode(e.test,t)}transformWhileStatement(e,t){return this.transformExpressionNode(e.test,t)}transformForStatement(e,t){return e.test?this.transformExpressionNode(e.test,t):null}transformReturnStatement(e,t){return e.argument?this.transformExpressionNode(e.argument,t):null}transformVariableDeclarator(e,t){return this.isStateDeclaration(e)||"ArrayPattern"===e.id?.type||"ObjectPattern"===e.id?.type?null:"Identifier"===e.init?.type&&this.stateVariables.has(e.init.name)&&!this.alreadyHasValue(e.init,t)?{start:e.init.start,end:e.init.end,replacement:`${e.init.name}.value`}:null}transformAssignmentExpression(e,t){return"ArrayPattern"===e.left?.type||"ObjectPattern"===e.left?.type?null:"Identifier"===e.right?.type&&this.stateVariables.has(e.right.name)&&!this.alreadyHasValue(e.right,t)?{start:e.right.start,end:e.right.end,replacement:`${e.right.name}.value`}:null}transformGeneralCallExpression(e,t){const s=t.slice(e.callee.start,e.callee.end);if("MemberExpression"===e.callee?.type&&"Identifier"===e.callee.object?.type&&this.stateVariables.has(e.callee.object.name)||this.isPPCall(e))return null;if(!z.isFunctionNeedingValueTransform(s)&&e.arguments.length>0)for(const s of e.arguments)if("Identifier"===s.type&&this.stateVariables.has(s.name)&&!this.alreadyHasValue(s,t))return{start:s.start,end:s.end,replacement:`${s.name}.value`};return null}static isFunctionNeedingValueTransform(e){if(this.FUNCTIONS_NEEDING_VALUE_TRANSFORM.has(e))return!0;const t=e.lastIndexOf(".");if(t>-1){const s=e.slice(t+1);if(this.FUNCTIONS_NEEDING_VALUE_TRANSFORM.has(s))return!0}return!1}transformExpressionNode(e,t){return"Identifier"===e?.type&&this.stateVariables.has(e.name)&&!this.alreadyHasValue(e,t)?{start:e.start,end:e.end,replacement:`${e.name}.value`}:null}isPPCall(e){return"MemberExpression"===e.callee?.type&&"Identifier"===e.callee.object?.type&&"pp"===e.callee.object.name&&"Identifier"===e.callee.property?.type&&("state"===e.callee.property.name||"effect"===e.callee.property.name)}isPartOfStateDeclaration(e,t){if(!t||!Array.isArray(t))return!1;for(const e of t)if("VariableDeclarator"===e.type&&"ArrayPattern"===e.id?.type&&"CallExpression"===e.init?.type&&this.isPPStateCall(e.init))return!0;return!1}isPropertyName(e,t){if(!t||0===t.length)return!1;const s=t[t.length-1];return!!("Property"===s?.type&&s.key===e||"Property"===s?.type&&s.shorthand&&s.value===e||"MemberExpression"===s?.type&&s.property===e&&!s.computed)}isMethodCallObject(e,t){if(!t||0===t.length)return!1;const s=t[t.length-1];if("MemberExpression"===s?.type&&s.object===e&&t.length>=2){const e=t[t.length-2];if("CallExpression"===e?.type&&e.callee===s)return!0}return!1}isPartOfPPCall(e,t){if(!t||!Array.isArray(t))return!1;for(const e of t)if("CallExpression"===e.type&&"MemberExpression"===e.callee?.type&&"Identifier"===e.callee.object?.type&&"pp"===e.callee.object.name&&"Identifier"===e.callee.property?.type&&("state"===e.callee.property.name||"effect"===e.callee.property.name))return!0;return!1}isPartOfDestructuring(e,t){if(!t||!Array.isArray(t))return!1;for(let s=0;s<t.length;s++){const n=t[s];if("ArrayPattern"===n.type||"ObjectPattern"===n.type){if(s+1<t.length){const i=t[s+1];if("VariableDeclarator"===i?.type&&i.id===n&&i.init===e)return!1}return!0}}return!1}collectStateVariables(e){U(e,{VariableDeclarator:e=>{if(this.isStateDeclaration(e)){const t=e.id.elements[0];"Identifier"===t?.type&&this.stateVariables.add(t.name)}}})}isStateDeclaration(e){return"ArrayPattern"===e.id?.type&&"CallExpression"===e.init?.type&&this.isPPStateCall(e.init)}transformSpreadElement(e,t){return"Identifier"===e.argument?.type&&this.stateVariables.has(e.argument.name)?this.alreadyHasValue(e.argument,t)?null:{start:e.argument.start,end:e.argument.end,replacement:`${e.argument.name}.value`}:null}transformUnaryExpression(e,t){return"Identifier"===e.argument?.type&&this.stateVariables.has(e.argument.name)&&["typeof","!","+","-","~","void","delete"].includes(e.operator)&&!this.alreadyHasValue(e.argument,t)?{start:e.argument.start,end:e.argument.end,replacement:`${e.argument.name}.value`}:null}transformBinaryExpression(e,t){if(["===","!==","==","!=",">","<",">=","<=","+","-","*","/","%","**","&","|","^","<<",">>",">>>","in","instanceof"].includes(e.operator)){if("Identifier"===e.left?.type&&this.stateVariables.has(e.left.name)&&!this.alreadyHasValue(e.left,t))return{start:e.left.start,end:e.left.end,replacement:`${e.left.name}.value`};if("Identifier"===e.right?.type&&this.stateVariables.has(e.right.name)&&!this.alreadyHasValue(e.right,t))return{start:e.right.start,end:e.right.end,replacement:`${e.right.name}.value`}}return null}transformMultipleCallArguments(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});let s=e;const n=[];return U(t,{CallExpression:e=>{const t=s.slice(e.callee.start,e.callee.end);if(z.isFunctionNeedingValueTransform(t)&&e.arguments.length>0)for(const t of e.arguments)"Identifier"===t.type&&this.stateVariables.has(t.name)&&(this.alreadyHasValue(t,s)||n.push({start:t.start,end:t.end,replacement:`${t.name}.value`}))}}),n.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s}catch(t){return console.error("Multiple call arguments transformation error:",t),e}}transformDestructuringAssignments(e){try{const t=W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0});let s=e;const n=[];return U(t,{VariableDeclarator:t=>{this.isStateDeclaration(t)||("ArrayPattern"===t.id?.type||"ObjectPattern"===t.id?.type)&&"Identifier"===t.init?.type&&this.stateVariables.has(t.init.name)&&(this.alreadyHasValue(t.init,e)||n.push({start:t.init.start,end:t.init.end,replacement:`${t.init.name}.value`}))},AssignmentExpression:t=>{("ArrayPattern"===t.left?.type||"ObjectPattern"===t.left?.type)&&"Identifier"===t.right?.type&&this.stateVariables.has(t.right.name)&&(this.alreadyHasValue(t.right,e)||n.push({start:t.right.start,end:t.right.end,replacement:`${t.right.name}.value`}))}}),n.sort(((e,t)=>t.start-e.start)).forEach((e=>{s=s.slice(0,e.start)+e.replacement+s.slice(e.end)})),s}catch(t){return console.error("Destructuring transformation error:",t),e}}alreadyHasValue(e,t){const s=e.end;return t.slice(s,s+6).startsWith(".value")}transformStateDeclarator(e,t){if("ArrayPattern"!==e.id?.type||"CallExpression"!==e.init?.type)return null;const s=e.init;if(!this.isPPStateCall(s))return null;const n=e.id.elements[0];if(!n||"Identifier"!==n.type)return null;const i=n.name,r=`set${this.capitalize(i)}`,a=e.id.elements[1];return"Identifier"===a?.type&&a.name!==r&&console.warn(`Setter name mismatch: expected ${r}, got ${a.name}`),this.createTransformation(s,i,t)}isPPStateCall(e){return"MemberExpression"===e.callee?.type&&"Identifier"===e.callee.object?.type&&"pp"===e.callee.object.name&&"Identifier"===e.callee.property?.type&&"state"===e.callee.property.name}createTransformation(e,t,s){const n=e.arguments;if(0===n.length){const s=`pp.state("${t}")`;return{start:e.start,end:e.end,replacement:s}}const i=n[0];if("Literal"===i.type&&"string"==typeof i.value&&i.value===t)return null;if(1===n.length){const n=`pp.state("${t}", ${s.slice(i.start,i.end)})`;return{start:e.start,end:e.end,replacement:n}}const r=`pp.state("${t}", ${s.slice(e.arguments[0].start,e.arguments[e.arguments.length-1].end)})`;return{start:e.start,end:e.end,replacement:r}}looksLikeVariableName(e){return/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)&&e.length<=50&&!e.includes(" ")}extractStateDeclarations(e){const t=[];try{U(W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0,locations:!0}),{VariableDeclarator:s=>{const n=this.extractStateFromDeclarator(s,e);n&&t.push(n)}})}catch(e){console.error("State extraction error:",e)}return t}extractStateFromDeclarator(e,t){if("ArrayPattern"!==e.id?.type||"CallExpression"!==e.init?.type||!this.isPPStateCall(e.init))return null;const s=e.id.elements[0],n=e.id.elements[1];if("Identifier"!==s?.type||"Identifier"!==n?.type)return null;const i=e.init.arguments;let r,a=s.name;return i.length>=1&&("Literal"===i[0].type&&"string"==typeof i[0].value?this.looksLikeVariableName(i[0].value)?(a=i[0].value,i.length>=2&&(r=this.extractLiteralValue(i[1]))):(a=s.name,r=this.extractLiteralValue(i[0])):r=this.extractLiteralValue(i[0])),{variableName:s.name,setterName:n.name,stateKey:a,initialValue:r,line:e.loc?.start.line||0,column:e.loc?.start.column||0}}extractFunctionDeclarations(e){const t=[];try{U(W(e,{ecmaVersion:2022,sourceType:"script",allowReturnOutsideFunction:!0,locations:!0}),{FunctionDeclaration:e=>{"Identifier"===e.id?.type&&t.push({name:e.id.name,type:"function",params:e.params.map((e=>"Identifier"===e.type?e.name:"")),line:e.loc?.start.line||0})},VariableDeclarator:e=>{if("Identifier"===e.id?.type&&("ArrowFunctionExpression"===e.init?.type||"FunctionExpression"===e.init?.type)){const s=e.init;t.push({name:e.id.name,type:"ArrowFunctionExpression"===s.type?"arrow":"function",params:s.params.map((e=>"Identifier"===e.type?e.name:"")),line:e.loc?.start.line||0})}}})}catch(e){console.error("Function extraction error:",e)}return t}extractLiteralValue(e){if("Literal"===e.type)return e.value;"Identifier"===e.type&&e.name}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}}class Ke{constructor(e){this.evaluator=e}render(e,t,s){const n=_.isSingleExpression(e);if(n)return this.evaluator.evaluateExpression(n,t,s);let i="";for(const n of _.parse(e))if("static"===n.type)i+=n.content;else if(n.expression)try{i+=ie(this.evaluator.evaluateExpression(n.expression,t,s))}catch{}return i}dependencies(e,t,s){const n=_.extractExpressions(e),i=new Set;for(const e of n)for(const n of this.evaluator.extractDependencies(e,t,s))i.add(n);return[...i]}}class ws{static containsMustacheExpression(e){if(d.MUSTACHE_PATTERN.test(e))return!0;const t=_.decodeEntities(e);return d.MUSTACHE_PATTERN.test(t)}}class v{static FRAMEWORK_ATTRIBUTES=new Set(["pp-component","pp-context","pp-for","pp-spread","key"]);static domCache;static getDOMCache(){return this.domCache||(this.domCache=L.getInstance()),this.domCache}static isFrameworkAttribute(e){return v.FRAMEWORK_ATTRIBUTES.has(e)}static isEventAttribute(e){return e.startsWith("on")&&e.length>2&&!e.includes("-")}static shouldBeDirectBinding(e,t){const s=e.getAttribute(d.ATTR_PREFIXES.CONTEXT),n=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);return!(!s||!n||s===n)&&v.isDOMProperty(e,t)}static isDOMProperty(e,t){const s=e.tagName.toLowerCase(),n=document.createElement(s);return v.attributeToPropertyName(t)in n}static attributeToPropertyName(e){const t={class:"className",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",minlength:"minLength",tabindex:"tabIndex",contenteditable:"contentEditable",formnovalidate:"formNoValidate",novalidate:"noValidate",allowfullscreen:"allowFullscreen",itemscope:"itemScope"};return t[e]?t[e]:e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}static isBooleanAttribute(e){return["checked","disabled","hidden","readonly","required","multiple","selected","autofocus","autoplay","controls","defer","loop","muted","open","reversed","async","default","formnovalidate","novalidate","allowfullscreen","capture","itemscope"].includes(e)}static getContextComponent(e){return this.getDOMCache().getContextComponent(e)}static getParentOfComponent(e,t){return this.getDOMCache().getParentOfComponent(e,t)}static findElementForComponent(e,t){return this.getDOMCache().findElementForComponent(e,t)}static getElementDepth(e){return this.getDOMCache().getElementDepthCached(e)}static getParentComponentForElement(e){let t=e.parentElement;for(;t;){const e=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e)return e;t=t.parentElement}return"app"}static isTextNodeInsideScript(e){let t=e.parentElement;for(;t&&t!==document.body;){const e=t.tagName.toLowerCase();if("script"===e||"style"===e)return!0;t=t.parentElement}return!1}static getComponentForNode(e){let t=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;return t?this.getDOMCache().getElementComponent(t):"app"}static getElementComponent(e){return this.getDOMCache().getElementComponent(e)}}class oe{static isEventAttribute(e){return e.startsWith("on")&&e.length>2&&!e.includes("-")}}class Be{static findExistingStateKey(e,t,s){return[`${t}.${e}`,`app.${e}`,e].find((e=>e in s))||null}}class et{pendingUpdates=new Map;batchTimeout=null;componentManager;domBindingManager;setManagers(e,t){this.componentManager=e,this.domBindingManager=t}scheduleUpdate(e,t){this.pendingUpdates.has(e)||this.pendingUpdates.set(e,new Set),this.pendingUpdates.get(e).add(t),null===this.batchTimeout&&(this.batchTimeout=requestAnimationFrame((()=>{this.processBatchedUpdates(),this.batchTimeout=null})))}processBatchedUpdates(){const e=new Map(this.pendingUpdates);this.pendingUpdates.clear(),this.batchTimeout=null;const t=this.sortUpdatesByDependency(e);for(const[e,s]of t)this.processComponentUpdate(e,s)}sortUpdatesByDependency(e){const t=new WeakMap,s=e=>{let s=t.get(e);return null==s&&(s=v.getElementDepth(e),t.set(e,s)),s};return Array.from(e.entries()).sort((([,e],[,t])=>Math.min(...Array.from(e,s))-Math.min(...Array.from(t,s))))}processComponentUpdate(e,t){if(!this.componentManager||!this.domBindingManager)return;this.componentManager.invalidateComponent(e);const s=[],n=[],i=[];for(const r of t){if(!document.contains(r))continue;const t=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,null);let a;for(;a=t.nextNode();)s.push(a);const o=this.domBindingManager.loopManager;if(o){const t=o.getAllLoops();for(const[s,i]of t)i.component===e&&r.contains(s)&&n.push([s,i])}i.push(r)}this.updateTextNodesBatch(s,e),this.updateLoopsBatch(n),this.updateElementsBatch(i,e)}updateTextNodesBatch(e,t){const s=this.domBindingManager.textNodeManager;s&&e.forEach((e=>{document.contains(e)&&v.getComponentForNode(e)===t&&s.updateTextNode(e)}))}updateLoopsBatch(e){const t=this.domBindingManager.loopManager;if(!t)return;const s=new Map;e.forEach((([e,t])=>{const n=v.getElementDepth(e);s.has(n)||s.set(n,[]),s.get(n).push([e,t])}));const n=Array.from(s.keys()).sort(((e,t)=>e-t));for(const e of n)s.get(e).forEach((([e,s])=>{document.contains(e)&&t.renderLoop(s,s.iterableExpr)}))}updateElementsBatch(e,t){e.forEach((e=>{document.contains(e)&&this.domBindingManager.processElementBindings(e,!0)}))}}class Ft{loopBindings=new Map;stateManager;expressionEvaluator;componentManager;domBindingManager;cleanupObserver;loopCounter=0;pendingTemplates=[];loopItemElements=new WeakSet;loopItemContexts=new WeakMap;templateRenderer;constructor(e,t){this.stateManager=e,this.expressionEvaluator=t,this.cleanupObserver=new MutationObserver((e=>{this.cleanupDetachedTemplates(e)})),this.cleanupObserver.observe(document.body,{childList:!0,subtree:!0}),this.templateRenderer=new Ke(t)}getLoopContextForElement(e){if(!this.domBindingManager)return null;const t=this.domBindingManager.loopManager;if(!t)return null;let s=e.parentElement;for(;s;){if(t.isLoopItem&&t.isLoopItem(s))return t.getLoopItemContext(s);s=s.parentElement}const n=t.getAllLoops();for(const[t,s]of n)for(const t of s.renderedItems)if(t.element.contains(e))return t.context;return null}setDependencies(e,t){this.componentManager=e,this.domBindingManager=t}queueTemplate(e,t){this.loopBindings.has(e)||this.pendingTemplates.push({template:e,component:t})}processPendingTemplates(){const e=[...this.pendingTemplates];this.pendingTemplates=[];for(const{template:t,component:s}of e)document.contains(t)&&this.processTemplate(t,s)}processTemplate(e,t){const s=e.getAttribute("pp-for");if(!s||this.loopBindings.has(e))return;const n=this.parseLoopExpression(s);if(!n)return void console.error(`Invalid pp-for syntax: "${s}"`);const i=e.parentElement,r=document.createComment(`pp-for: ${s}`);i.insertBefore(r,e);const a={template:e,expression:s,itemVar:n.itemVar,indexVar:n.indexVar,component:t,subscriptionIds:[],renderedItems:[],keyExpression:void 0,parentElement:i,placeholder:r,iterableExpr:n.iterableExpr};this.loopBindings.set(e,a),this.setupLoopReactivity(a,n.iterableExpr),this.renderLoop(a,n.iterableExpr)}parseLoopExpression(e){const t=e.match(/^\s*([a-zA-Z_$][\w$]*)\s+in\s+(.+)$/);if(t)return{itemVar:t[1],iterableExpr:t[2].trim()};const s=e.match(/^\s*\(\s*([a-zA-Z_$][\w$]*)\s*,\s*([a-zA-Z_$][\w$]*)\s*\)\s+in\s+(.+)$/);return s?{itemVar:s[1],indexVar:s[2],iterableExpr:s[3].trim()}:null}setupLoopReactivity(e,t){const s=`loop_${Date.now()}_${++this.loopCounter}`,n=this.expressionEvaluator.extractDependencies(t,e.component,this.stateManager),i=this.findComponentElementForLoop(e);if(i&&this.componentManager){const t=this.componentManager.getComponentPropDependencies(i,e.component);n.push(...t)}const r={id:s,selector:"",dependencies:new Set(n),callback:()=>{this.renderLoop(e,e.iterableExpr)},element:e.parentElement,component:e.component};this.stateManager.addSubscription(r),e.subscriptionIds.push(s)}renderLoop(e,t){if(this.componentManager&&this.domBindingManager)try{const s=this.findComponentElementForLoop(e);let n;const i=this.findParentLoopContext(e.template);n=i?{...this.componentManager.buildComponentContextWithProps(e.component,s),...i}:this.componentManager.buildComponentContextWithProps(e.component,s);const r=this.expressionEvaluator.evaluateExpression(t,n,e.component);if(!Array.isArray(r))return console.warn(`Loop expression "${t}" did not return an array:`,r,`Available context keys: [${Object.keys(n).join(", ")}]`,"Parent loop context:",i),void this.clearRenderedItems(e);this.updateRenderedItems(e,r)}catch(s){console.error(`Error evaluating loop expression "${t}":`,s),this.clearRenderedItems(e)}}findParentLoopContext(e){const t=[];let s=e.parentElement;for(;s&&s!==document.body;){if(this.loopItemElements.has(s)){const e=this.loopItemContexts.get(s);e&&t.unshift(e)}for(const[n,i]of this.loopBindings)if(i.template!==e)for(const n of i.renderedItems)if(n.element===s||n.element.contains(e)){t.unshift(n.context);break}s=s.parentElement}return t.length>0?t.reduce(((e,t)=>({...e,...t})),{}):null}findComponentElementForLoop(e){let t=e.parentElement;for(;t;){if(t.getAttribute(d.ATTR_PREFIXES.COMPONENT)===e.component)return t;t=t.parentElement}return document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}="${e.component}"]`)[0]||void 0}updateRenderedItems(e,t){const s=e.renderedItems,n=[],i=new Set,r=new Map;s.forEach((e=>{r.set(e.key,e)})),t.forEach(((t,s)=>{const a=this.generateItemKey(e,t,s),o=r.get(a);if(o&&!i.has(o.element))i.add(o.element),this.updateItemContext(e,o,t,s),n.push(o);else{const i=this.createLoopItem(e,t,s,a);i&&(n.push(i),this.processNestedLoopsInItem(i,e.component))}})),s.forEach((e=>{i.has(e.element)||this.cleanupLoopItem(e)})),this.updateDOMOrder(e,n),e.renderedItems=n}processNestedLoopsInItem(e,t){e.element.querySelectorAll("template[pp-for]").forEach((s=>{const n=s;this.loopBindings.has(n)||this.processNestedTemplate(n,t,e.context)}))}generateItemKey(e,t,s){const n=e.template.content.firstElementChild;if(n&&n.hasAttribute("key")){const i=n.getAttribute("key");try{const n=this.createItemContextWithParentContext(e,t,s),r=_.isSingleExpression(i);if(r){const t=this.expressionEvaluator.evaluateExpression(r,n,e.component);return String(t)}{const t=_.parse(i);let s="";for(const i of t)if("static"===i.type)s+=i.content;else if(i.expression){s+=ie(this.expressionEvaluator.evaluateExpression(i.expression,n,e.component))}return s}}catch(n){console.warn(`Error evaluating key expression "${i}":`,n,"Available context keys:",Object.keys(this.createItemContextWithParentContext(e,t,s)))}}return t&&"object"==typeof t&&"id"in t?String(t.id):`${e.expression}_${s}`}createItemContextWithParentContext(e,t,s){if(!this.componentManager)return{};const n={...this.componentManager.buildComponentContext(e.component),...this.getAllParentLoopContexts(e.template),[e.itemVar]:t};return e.indexVar&&(n[e.indexVar]=s),n}getAllParentLoopContexts(e){const t=[];let s=e.parentElement;for(;s&&s!==document.body;){if(this.loopItemElements.has(s)){const e=this.loopItemContexts.get(s);e&&t.unshift(e)}for(const[n,i]of this.loopBindings)if(n!==e)for(const n of i.renderedItems)if(n.element===s||n.element.contains(e)){t.unshift(n.context);break}s=s.parentElement}return t.reduce(((e,t)=>({...e,...t})),{})}createItemContext(e,t,s){if(!this.componentManager)return{};const n={...this.componentManager.buildComponentContext(e.component),...this.findAllParentLoopContexts(e.template),[e.itemVar]:t};return e.indexVar&&(n[e.indexVar]=s),n}findAllParentLoopContexts(e){const t={};let s=e.parentElement;for(;s&&s!==document.body;){if(this.loopItemElements.has(s)){const e=this.loopItemContexts.get(s);if(e)for(const[s,n]of Object.entries(e))s in t||(t[s]=n)}for(const[n,i]of this.loopBindings)if(n!==e)for(const e of i.renderedItems)if(e.element===s){for(const[s,n]of Object.entries(e.context))s in t||(t[s]=n);break}s=s.parentElement}return t}createLoopItem(e,t,s,n){if(!this.domBindingManager)return null;try{const i=this.createItemContextWithParentContext(e,t,s),r=document.importNode(e.template.content,!0),a=document.createElement("div");a.appendChild(r);const o=a.firstElementChild;if(!o)return console.warn("Template content must contain exactly one root element"),null;a.removeChild(o),this.loopItemElements.add(o),this.loopItemContexts.set(o,i),o.getAttribute("key")&&o.removeAttribute("key");const c={key:n,element:o,context:i,subscriptionIds:[],textNodeTemplates:new Map,attributeTemplates:new Map};return this.executeComponentScriptsInLoopItem(o),this.processElementWithContext(o,i,e.component,c),this.cleanupRawMustacheAttributes(o),c}catch(e){return console.error("Error creating loop item:",e),null}}executeComponentScriptsInLoopItem(e){if(!this.componentManager)return;const t=[e],s=e.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}]`);t.push(...Array.from(s)),t.forEach((e=>{if(e.hasAttribute(d.ATTR_PREFIXES.COMPONENT)){const t=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(t){const s=this.getLoopItemContextForElement(e),n=`${t}_${this.generateInstanceId(s)}`;e.setAttribute(d.ATTR_PREFIXES.COMPONENT,n),e.__originalComponentName=t,e.__uniqueComponentName=n,this.componentManager.pushComponent(n),this.getComponentScripts(e).forEach((e=>{this.componentManager.executeScript(e)})),this.componentManager.popComponent()}}}))}getLoopItemContextForElement(e){let t=e;for(;t;){if(this.loopItemElements.has(t)){const e=this.loopItemContexts.get(t);if(e)return e}t=t.parentElement}for(const[t,s]of this.loopBindings)for(const t of s.renderedItems)if(t.element===e||t.element.contains(e))return t.context;return console.warn("⚠️ No loop item context found, using empty context"),{}}generateInstanceId(e){const t={};for(const[s,n]of Object.entries(e))"function"==typeof n||s.startsWith("set")||s.endsWith("Getter")||"getContext"===s||"withContext"===s||"__getProp"===s||(n&&"object"==typeof n&&"id"in n||"object"!=typeof n||Array.isArray(n))&&(t[s]=n);return 0===Object.keys(t).length?`${Date.now()}_${Math.random().toString(36).substring(2,7)}`:Object.keys(t).sort().map((e=>{const s=t[e];return s&&"object"==typeof s&&"id"in s?`${e}_${s.id}`:"string"==typeof s||"number"==typeof s?`${e}_${s}`:`${e}_${JSON.stringify(s)}`})).join("_").replace(/[^a-zA-Z0-9_]/g,"").substring(0,20)||`fallback_${Date.now()}`}getComponentScripts(e){const t=[];return e.querySelectorAll(`script[type="${d.SCRIPT_TYPE}"]`).forEach((s=>{const n=s;let i=n.parentElement,r=!1;for(;i&&i!==e.parentElement;){if(i===e){r=!0;break}if(i.hasAttribute(d.ATTR_PREFIXES.COMPONENT)&&i!==e)break;i=i.parentElement}r&&t.push(n)})),t}cleanupRawMustacheAttributes(e){this.cleanupElementMustacheAttributes(e);const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null);let s;for(;s=t.nextNode();)this.cleanupElementMustacheAttributes(s)}cleanupElementMustacheAttributes(e){const t=Array.from(e.attributes);for(const s of t)s.value&&d.MUSTACHE_PATTERN.test(s.value)&&(v.isBooleanAttribute(s.name),e.removeAttribute(s.name))}processElementWithContext(e,t,s,n){if(!this.domBindingManager||!this.componentManager)return;const i=(e,s)=>{const n=this.componentManager.buildComponentContext(s),i=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(i&&i!==s){const e=this.componentManager.buildComponentContext(i);return{...t,...n,...e}}return{...t,...n}},r=this.componentManager.buildComponentContextWithProps.bind(this.componentManager);this.componentManager.buildComponentContextWithProps=(t,s)=>s&&(s===e||e.contains(s))?i(s,t):r(t,s);try{this.bindLoopItemElement(e,t,s,n),this.setupEventBindingsForLoopItem(e,s);const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{if(t===e)return NodeFilter.FILTER_SKIP;if(t.nodeType===Node.TEXT_NODE){const e=t;if(v.isTextNodeInsideScript(e))return NodeFilter.FILTER_REJECT;if(e.textContent&&d.MUSTACHE_PATTERN.test(e.textContent))return NodeFilter.FILTER_ACCEPT}else if(t.nodeType===Node.ELEMENT_NODE)return"script"===t.tagName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT;return NodeFilter.FILTER_SKIP}});let a;for(;a=r.nextNode();)if(a.nodeType===Node.TEXT_NODE){const e=a;if(e.textContent&&d.MUSTACHE_PATTERN.test(e.textContent)){const t=this.getComponentForTextNode(e),s=i(e.parentElement,t);this.processTextNodeWithLoopContext(e,s,t,n)}}else if(a.nodeType===Node.ELEMENT_NODE){const e=a,t=v.getElementComponent(e),s=i(e,t);this.bindLoopItemElement(e,s,t,n),this.setupEventBindingsForLoopItem(e,t)}e.querySelectorAll("template[pp-for]").forEach((e=>{this.processNestedTemplate(e,s,t)}))}finally{this.componentManager.buildComponentContextWithProps=r}}getComponentForTextNode(e){let t=e.parentElement;for(;t;){const e=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e)return e;t=t.parentElement}return"app"}processNestedTemplate(e,t,s){const n=e.getAttribute("pp-for");if(!n||this.loopBindings.has(e))return;const i=this.parseLoopExpression(n);if(!i)return void console.error(`Invalid pp-for syntax: "${n}"`);const r=e.parentElement,a=document.createComment(`pp-for: ${n}`);r.insertBefore(a,e);const o=this.findComponentElementForTemplate(e);let c={...s};const p=this.findParentLoopContextForNestedTemplate(e);if(p&&(c={...c,...p}),o&&this.componentManager){const e=o.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e){const t=v.getParentComponentForElement(o);this.componentManager.hasStoredProps(o)||this.componentManager.setupProps(o,t);const s=this.evaluateComponentPropsWithContext(o,c);c={...this.componentManager.buildComponentContext(e),...s,...c}}}const h={template:e,expression:n,itemVar:i.itemVar,indexVar:i.indexVar,iterableExpr:i.iterableExpr,component:t,subscriptionIds:[],renderedItems:[],keyExpression:void 0,parentElement:r,placeholder:a};this.loopBindings.set(e,h),this.setupNestedLoopReactivity(h,i.iterableExpr,c),this.renderNestedLoop(h,i.iterableExpr,c)}findParentLoopContextForNestedTemplate(e){let t=e.parentElement;const s={};let n=0;for(;t&&t!==document.body&&n<10;){if(n++,this.loopItemElements.has(t)){const e=this.loopItemContexts.get(t);if(e)for(const[t,n]of Object.entries(e))t in s||(s[t]=n)}for(const[n,i]of this.loopBindings)for(const n of i.renderedItems)(n.element.contains(e)||n.element===t)&&(i.itemVar in s||(s[i.itemVar]=n.context[i.itemVar]),i.indexVar&&!(i.indexVar in s)&&(s[i.indexVar]=n.context[i.indexVar]));t=t.parentElement}return Object.keys(s).length>0?s:null}evaluateComponentPropsWithContext(e,t){const s={};if(!this.componentManager||!this.expressionEvaluator)return s;const n=this.componentManager.extractProps(e,"app");for(const[e,i]of n)try{const n=this.templateRenderer.render(i.expression,t,i.component);s[e]=n}catch(t){console.error(`Failed to evaluate prop "${e}":`,t),s[e]=void 0}return s}findComponentElementForTemplate(e){let t=e.parentElement;for(;t;){if(t.hasAttribute(d.ATTR_PREFIXES.COMPONENT))return t;t=t.parentElement}return null}setupNestedLoopReactivity(e,t,s){const n=`nested_loop_${Date.now()}_${++this.loopCounter}`;let i=this.expressionEvaluator.extractDependencies(t,e.component,this.stateManager);const r={id:n,selector:"",dependencies:new Set(i),callback:()=>{const n=e.template,i=this.findComponentElementForTemplate(n);let r=s;if(n.parentElement){const e=this.getParentLoopContextForElement(n);e&&(r={...r,...e})}if(i&&this.componentManager){const t=i.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(t){const n=this.extractParentLoopContextFromBinding(e,s),a=this.evaluateComponentPropsWithContext(i,n),o=this.componentManager.buildComponentContext(t);r={...n,...o,...a}}}this.renderNestedLoop(e,t,r)},element:e.parentElement,component:e.component};this.stateManager.addSubscription(r),e.subscriptionIds.push(n)}getParentLoopContextForElement(e){let t=e.parentElement;for(;t;){if(this.loopItemElements.has(t)){const e=this.loopItemContexts.get(t);if(e)return e}t=t.parentElement}return null}extractParentLoopContextFromBinding(e,t){const s=new Set;for(const[t,n]of this.loopBindings)if(n!==e)for(const t of n.renderedItems)if(t.element.contains(e.template)){s.add(n.itemVar),n.indexVar&&s.add(n.indexVar);break}const n={};for(const[e,i]of Object.entries(t))(s.has(e)||e.startsWith("users")||e.startsWith("set")||e.includes("Getter")||"function"==typeof i)&&(n[e]=i);return n}renderNestedLoop(e,t,s){if(this.componentManager&&this.domBindingManager)try{const n=this.expressionEvaluator.evaluateExpression(t,s,e.component);if(!Array.isArray(n))return console.warn(`Nested loop expression "${t}" did not return an array:`,n,`Available context keys: [${Object.keys(s).join(", ")}]`),void this.clearRenderedItems(e);this.updateNestedRenderedItems(e,n,s)}catch(n){console.error(`Error evaluating nested loop expression "${t}":`,n,`Available context keys: [${Object.keys(s).join(", ")}]`),this.clearRenderedItems(e)}}updateNestedRenderedItems(e,t,s){const n=e.renderedItems,i=[],r=new Set,a=new Map;n.forEach((e=>{a.set(e.key,e)})),t.forEach(((t,n)=>{const o=this.generateNestedItemKey(e,t,n,s),c=a.get(o);if(c&&!r.has(c.element))r.add(c.element),this.updateNestedItemContext(e,c,t,n,s),i.push(c);else{const r=this.createNestedLoopItem(e,t,n,o,s);r&&i.push(r)}})),n.forEach((e=>{r.has(e.element)||this.cleanupLoopItem(e)})),this.updateDOMOrder(e,i),e.renderedItems=i}generateNestedItemKey(e,t,s,n){return t&&"object"==typeof t&&"id"in t?String(t.id):`${e.expression}_${s}_${JSON.stringify(n[e.itemVar]||{})}`}createNestedLoopItem(e,t,s,n,i){if(!this.domBindingManager)return null;try{const r={...i,[e.itemVar]:t};e.indexVar&&(r[e.indexVar]=s);const a=document.importNode(e.template.content,!0),o=document.createElement("div");o.appendChild(a);const c=o.firstElementChild;if(!c)return console.warn("Template content must contain exactly one root element"),null;o.removeChild(c),this.loopItemElements.add(c),this.loopItemContexts.set(c,r),c.getAttribute("key")&&c.removeAttribute("key");const p={key:n,element:c,context:r,subscriptionIds:[],textNodeTemplates:new Map,attributeTemplates:new Map};return this.processElementWithContext(c,r,e.component,p),this.cleanupRawMustacheAttributes(c),p}catch(e){return console.error("Error creating nested loop item:",e),null}}updateNestedItemContext(e,t,s,n,i){const r={...i};r[e.itemVar]=s,e.indexVar&&(r[e.indexVar]=n);const a=this.gatherAllComponentContextsInLoopItem(t.element),o={...r,...a};if(t.context=o,this.loopItemContexts.set(t.element,o),t.textNodeTemplates)for(const[e,s]of t.textNodeTemplates)document.contains(e)&&this.updateTextNodeWithContext(e,s,o,this.getTextNodeComponent(e));if(t.attributeTemplates)for(const[e,s]of t.attributeTemplates)document.contains(e)&&s.forEach(((t,s)=>{try{const n=v.getElementComponent(e),i=this.buildElementSpecificContext(e,o),r=this.templateRenderer.render(t,i,n);this.domBindingManager?.updateElementProperty(e,s,r)}catch(e){console.error(`Nested binding update error for "${t}":`,e)}}))}bindLoopItemElement(e,t,s,n){const i=this.extractMustacheBindings(e);n&&i.size>0&&(n.attributeTemplates||(n.attributeTemplates=new Map),n.attributeTemplates.set(e,new Map(i))),i.forEach(((i,r)=>{this.createLoopItemBinding(e,r,i,t,s,n)}))}setupEventBindingsForLoopItem(e,t){const s=this.domBindingManager.eventDelegation;if(!s)return void console.warn("No event delegation manager available");const n=Array.from(e.attributes);for(const i of n)if(oe.isEventAttribute(i.name)){const n=i.name.substring(2);s.registerEventHandler(e,n,i.value,t),e.removeAttribute(i.name)}}processTextNodeWithLoopContext(e,t,s,n){if(v.isTextNodeInsideScript(e))return;const i=e.textContent||"";if(!_.parse(i).some((e=>"expression"===e.type)))return;n&&(n.textNodeTemplates||(n.textNodeTemplates=new Map),n.textNodeTemplates.set(e,i));const r=this.findActualComponentForTextNode(e);this.updateTextNodeWithContext(e,i,t,r);const a=`loop_text_${Date.now()}_${Math.random()}`,o=this.templateRenderer.dependencies(i,r,this.stateManager),c=new Set(o),p={id:a,selector:"",dependencies:c,callback:()=>{if(!document.contains(e))return void this.stateManager.removeSubscription(a);let t={};if(this.componentManager&&(t=this.componentManager.buildComponentContext(r)),n){const e={};let s=null;for(const[e,t]of this.loopBindings)if(t.renderedItems.includes(n)){s=t;break}if(s){e[s.itemVar]=n.context[s.itemVar],s.indexVar&&(e[s.indexVar]=n.context[s.indexVar]);const t=this.findParentLoopContext(s.template);t&&Object.assign(e,t)}t={...t,...e}}this.updateTextNodeWithContext(e,i,t,r)},component:r};this.stateManager.addSubscription(p),n&&n.subscriptionIds.push(a)}findActualComponentForTextNode(e){let t=e.parentElement;for(;t;){const e=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e){return t.__uniqueComponentName||e}t=t.parentElement}return"app"}updateTextNodeWithContext(e,t,s,n){const i=_.parse(t);let r="";for(const e of i)if("static"===e.type)r+=e.content;else if(e.expression)try{r+=ie(this.expressionEvaluator.evaluateExpression(e.expression,s,n))}catch(t){console.warn(`Loop text evaluation error for "${e.expression}":`,t,"Available context keys:",Object.keys(s)),r+=""}e.textContent!==r&&(e.textContent=r)}extractMustacheBindings(e){const t=new Map,s=e.attributes;for(let e=0;e<s.length;e++){const n=s[e];if(n.name!==d.ATTR_PREFIXES.COMPONENT&&"key"!==n.name&&!n.name.startsWith("on")&&n.value){const e=d.MUSTACHE_PATTERN.test(n.value),s=_.decodeEntities(n.value),i=d.MUSTACHE_PATTERN.test(s);(e||i)&&t.set(n.name,s)}}return t}createLoopItemBinding(e,t,s,n,i,r){const a=`loop_item_${Date.now()}_${Math.random()}`,o=this.templateRenderer.dependencies(s,i,this.stateManager),c=new Set(o);let p=!1,h=0;const l=()=>{if(!p)if(document.contains(e)){h=0;try{const a=this.componentManager.buildComponentContext(i);let o;if(r){o={...a};let e=null;for(const[t,s]of this.loopBindings)if(s.renderedItems.includes(r)){e=s;break}e&&(o[e.itemVar]=r.context[e.itemVar],e.indexVar&&(o[e.indexVar]=r.context[e.indexVar]));for(const[e,t]of Object.entries(r.context))e in o||(o[e]=t)}else o=n;const c=this.templateRenderer.render(s,o,i);this.domBindingManager?.updateElementProperty(e,t,c)}catch(e){console.error(`Loop item binding evaluation error for "${s}":`,e),console.error("Available context keys:",Object.keys(n))}}else if(h++,h<5){const e=10*Math.pow(2,h-1);setTimeout((()=>{p||l()}),e)}else p=!0,this.stateManager.removeSubscription(a)},u={id:a,selector:"",dependencies:c,callback:()=>{p||l()},element:e,component:i};if(this.stateManager.addSubscription(u),r){r.subscriptionIds.push(a);const e=this.cleanupLoopItem.bind(this);this.cleanupLoopItem=t=>{t===r&&(p=!0),e(t)}}(()=>{document.contains(e)?l():Promise.resolve().then((()=>{if(!p&&document.contains(e))l();else if(!p&&h<5){h++;const e=10*Math.pow(2,h-1);setTimeout((()=>{p||l()}),e)}else!p&&h>=5&&(p=!0,this.stateManager.removeSubscription(a))}))})()}updateItemContext(e,t,s,n){const i={...this.createItemContext(e,s,n),...this.gatherAllComponentContextsInLoopItem(t.element)};if(t.context=i,this.loopItemContexts.set(t.element,i),t.textNodeTemplates)for(const[e,s]of t.textNodeTemplates)document.contains(e)&&this.updateTextNodeWithContext(e,s,i,this.getTextNodeComponent(e));if(t.attributeTemplates)for(const[e,s]of t.attributeTemplates)document.contains(e)&&s.forEach(((t,s)=>{try{const n=v.getElementComponent(e),r=this.buildElementSpecificContext(e,i),a=this.templateRenderer.render(t,r,n);this.domBindingManager?.updateElementProperty(e,s,a)}catch(e){console.error(`Attribute binding update error for "${t}":`,e)}}))}gatherAllComponentContextsInLoopItem(e){if(!this.componentManager)return{};const t={};if(e.hasAttribute(d.ATTR_PREFIXES.COMPONENT)){const s=e.getAttribute(d.ATTR_PREFIXES.COMPONENT),n=this.componentManager.buildComponentContext(s);Object.assign(t,n)}return e.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}]`).forEach((e=>{const s=e.getAttribute(d.ATTR_PREFIXES.COMPONENT),n=this.componentManager?.buildComponentContext(s);Object.assign(t,n)})),t}buildElementSpecificContext(e,t){if(!this.componentManager)return t;const s=v.getElementComponent(e),n=this.componentManager.buildComponentContext(s);return{...t,...n}}getTextNodeComponent(e){let t=e.parentElement;for(;t;){const e=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e)return e;t=t.parentElement}return"app"}updateDOMOrder(e,t){let s=e.placeholder;t.forEach((t=>{(t.element.parentElement!==e.parentElement||t.element!==s.nextSibling)&&e.parentElement.insertBefore(t.element,s.nextSibling),s=t.element}))}clearRenderedItems(e){e.renderedItems.forEach((e=>{this.cleanupLoopItem(e)})),e.renderedItems=[]}cleanupLoopItem(e){this.loopItemElements.delete(e.element),this.loopItemContexts.delete(e.element),e.element.parentElement&&e.element.parentElement.removeChild(e.element),e.subscriptionIds.forEach((e=>{this.stateManager.removeSubscription(e)}))}isLoopItem(e){return this.loopItemElements.has(e)}getLoopItemContext(e){return this.loopItemContexts.get(e)}cleanupDetachedTemplates(e){for(const t of e)"childList"===t.type&&t.removedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;"TEMPLATE"===t.tagName&&t.hasAttribute("pp-for")&&this.cleanupTemplate(t),t.querySelectorAll("template[pp-for]").forEach((e=>{this.cleanupTemplate(e)}))}}))}cleanupTemplate(e){const t=this.loopBindings.get(e);t&&(this.clearRenderedItems(t),t.subscriptionIds.forEach((e=>{this.stateManager.removeSubscription(e)})),t.placeholder.parentElement&&t.placeholder.parentElement.removeChild(t.placeholder),this.loopBindings.delete(e))}getAllLoops(){return new Map(this.loopBindings)}destroy(){this.cleanupObserver.disconnect(),Array.from(this.loopBindings.keys()).forEach((e=>{this.cleanupTemplate(e)})),this.loopItemContexts=new WeakMap}}class ${cache=new Map;maxSize;hits=0;misses=0;constructor(e){this.maxSize=e}keys(){return Array.from(this.cache.keys())}deleteByPrefix(e){let t=0;const s=[];return this.cache.forEach(((t,n)=>{"string"==typeof n&&n.startsWith(e)&&s.push(n)})),s.forEach((e=>{this.cache.delete(e)&&t++})),t}getKeysByPrefix(e){const t=[];return this.cache.forEach(((s,n)=>{"string"==typeof n&&n.startsWith(e)&&t.push(n)})),t}get(e){const t=this.cache.get(e);if(void 0!==t)return this.hits++,this.cache.delete(e),this.cache.set(e,t),t;this.misses++}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}this.cache.set(e,t)}size(){return this.cache.size}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){const e=this.hits+this.misses;return{size:this.cache.size,maxSize:this.maxSize,hitRate:e>0?this.hits/e*100:0,hits:this.hits,misses:this.misses}}resetStats(){this.hits=0,this.misses=0}}class _{static EXPRESSION_CACHE=new $(1e3);static parseSpreadDirective(e){const t=e.replace(/^\s*\{\s*|\s*\}\s*$/g,""),s=this.parseSpreadParts(t),n=[],i=[];for(const e of s){const t=e.trim();if(t.startsWith("..."))n.push(t.substring(3).trim());else if(t.startsWith("{")&&t.endsWith("}")){const e=t.slice(1,-1).trim();if(e){const t=this.parseObjectProperties(e);i.push(t)}}else console.warn(`Invalid spread directive part: "${t}". Expected ...spread or {object}`)}return{spreads:n,objects:i}}static parseSpreadParts(e){const t=[];let s="",n=0,i=!1,r="",a=0;for(;a<e.length;){const o=e[a],c=a>0?e[a-1]:"";if(i||'"'!==o&&"'"!==o?i&&o===r&&"\\"!==c&&(i=!1,r=""):(i=!0,r=o),!i)if("{"===o)n++;else if("}"===o)n--;else if(","===o&&0===n){t.push(s.trim()),s="",a++;continue}s+=o,a++}return s.trim()&&t.push(s.trim()),t}static parseObjectProperties(e){const t=[],s=this.parseObjectParts(e);for(const e of s){const s=e.trim(),n=this.findPropertySeparator(s);if(-1!==n){const e=s.substring(0,n).trim().replace(/['"]/g,""),i=s.substring(n+1).trim();t.push({key:e,value:i})}else console.warn(`Invalid object property: "${s}". Expected key: value format.`)}return t}static parseObjectParts(e){const t=[];let s="",n=0,i=!1,r="";for(let a=0;a<e.length;a++){const o=e[a],c=a>0?e[a-1]:"";if(i||'"'!==o&&"'"!==o?i&&o===r&&"\\"!==c&&(i=!1,r=""):(i=!0,r=o),!i)if("{"===o||"["===o||"("===o)n++;else if("}"===o||"]"===o||")"===o)n--;else if(","===o&&0===n){t.push(s.trim()),s="";continue}s+=o}return s.trim()&&t.push(s.trim()),t}static findPropertySeparator(e){let t=0,s=!1,n="";for(let i=0;i<e.length;i++){const r=e[i],a=i>0?e[i-1]:"";if(s||'"'!==r&&"'"!==r?s&&r===n&&"\\"!==a&&(s=!1,n=""):(s=!0,n=r),!s)if("{"===r||"["===r||"("===r)t++;else if("}"===r||"]"===r||")"===r)t--;else if(":"===r&&0===t)return i}return-1}static decodeEntities=e=>{const t=document.createElement("textarea");t.innerHTML=e;let s=t.value;for(;s.includes("&");){t.innerHTML=s;const e=t.value;if(e===s)break;s=e}return s};static parse(e){const t=_.decodeEntities(e);if(_.EXPRESSION_CACHE.has(t))return _.EXPRESSION_CACHE.get(t);const s=_.parseContentWithNesting(t);return _.EXPRESSION_CACHE.set(t,s),s}static parseContentWithNesting(e){const t=[],s=e.length;let n=0,i=0;for(;n<s;)if("{"===e[n]){n>i&&t.push({type:"static",content:e.substring(i,n),expression:null});const s=this.extractNestedExpression(e,n);-1!==s.endIndex?(t.push({type:"expression",content:e.substring(n,s.endIndex+1),expression:s.expression.trim()}),n=s.endIndex+1,i=n):n++}else n++;return i<s&&t.push({type:"static",content:e.substring(i),expression:null}),t}static extractNestedExpression(e,t){let s=1,n=t+1,i=!1,r="",a=!1;for(;n<e.length&&s>0;){const t=e[n],o=n>0?e[n-1]:"";i||'"'!==t&&"'"!==t?i&&t===r&&"\\"!==o&&(i=!1,r=""):(i=!0,r=t),!i&&"`"===t&&"\\"!==o&&(a=!a),!i&&!a&&("{"===t?s++:"}"===t&&s--),n++}if(0===s){return{endIndex:n-1,expression:e.slice(t+1,n-1)}}return{endIndex:-1,expression:""}}static isSingleExpression(e){const t=_.decodeEntities(e),s=_.parseContentWithNesting(t);return 1===s.length&&"expression"===s[0].type?s[0].expression:null}static extractExpressions(e){const t=_.decodeEntities(e);return _.parseContentWithNesting(t).filter((e=>"expression"===e.type)).map((e=>e.expression)).filter((e=>e))}}class Ps{textNodeBindings=new Map;expressionEvaluator;stateManager;componentManager;cleanupObserver;bindingCount=0;constructor(e,t){this.expressionEvaluator=e,this.stateManager=t,this.cleanupObserver=new MutationObserver((e=>{this.cleanupDetachedNodes(e)})),this.cleanupObserver.observe(document.body,{childList:!0,subtree:!0})}cleanupDetachedNodes(e){for(const t of e)"childList"===t.type&&t.removedNodes.forEach((e=>{if(e.nodeType===Node.TEXT_NODE)this.cleanupTextNode(e);else if(e.nodeType===Node.ELEMENT_NODE){const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let s;for(;s=t.nextNode();)this.cleanupTextNode(s)}}));const t=[];for(const[e]of this.textNodeBindings)document.contains(e)||t.push(e);t.forEach((e=>this.cleanupTextNode(e)))}processTextNode(e,t){if(this.textNodeBindings.has(e)||v.isTextNodeInsideScript(e)||this.isInsideLoopItem(e))return;const s=e.parentElement,n=s?v.getContextComponent(s):t,i=e.textContent||"",r=_.parse(i);if(!r.some((e=>"expression"===e.type)))return;const a={originalContent:i,expressions:r,subscriptionIds:[]};r.filter((e=>"expression"===e.type)).forEach((t=>{if(!t.expression)return;const s=`text_${Date.now()}_${Math.random()}`,i=this.expressionEvaluator.extractDependencies(t.expression,n,this.stateManager),r={id:s,selector:"",dependencies:new Set(i),callback:()=>{this.updateTextNode(e)},element:e.parentElement??void 0,component:n};this.stateManager.addSubscription(r),a.subscriptionIds.push(s)})),this.textNodeBindings.set(e,a),this.bindingCount++,this.updateTextNode(e)}isInsideLoopItem(e){let t=e.parentElement;for(;t&&t!==document.body;){const e=t.previousSibling;if(e&&e.nodeType===Node.COMMENT_NODE&&e.textContent?.startsWith("pp-for:"))return!0;let s=t.parentElement?.firstChild||null;for(;s;){if(s.nodeType===Node.COMMENT_NODE&&s.textContent?.startsWith("pp-for:")&&s!==t)return!0;s=s.nextSibling}t=t.parentElement}return!1}updateTextNode(e){const t=this.textNodeBindings.get(e);if(!t||!e.parentElement)return;const s=e.parentElement,n=v.getContextComponent(s),i=this.resolveComponentRootForElement(e,n),r=this.getContextForComponent(n,i);let a="";for(const e of t.expressions)if("static"===e.type)a+=e.content;else if(e.expression)try{a+=ie(this.expressionEvaluator.evaluateExpression(e.expression,r,n))}catch(t){const s="object"==typeof t&&null!==t&&"message"in t?t.message:String(t);console.warn(`Text binding evaluation warning for "${e.expression}": ${s}`),a+=""}e.textContent!==a&&(e.textContent=a)}resolveComponentRootForElement(e,t){let s=e.parentElement;for(;s&&s.nodeType===Node.ELEMENT_NODE;){const e=s;if(e.getAttribute(d.ATTR_PREFIXES.COMPONENT)===t)return e;s=s.parentElement}}getContextForComponent(e,t){return this.componentManager?this.componentManager.buildComponentContextWithProps(e,t):{}}cleanupTextNode(e){const t=this.textNodeBindings.get(e);t&&(t.subscriptionIds.forEach((e=>{this.stateManager.removeSubscription(e)})),this.textNodeBindings.delete(e),this.bindingCount=Math.max(0,this.bindingCount-1))}getBindingCount(){return this.textNodeBindings.size}getAllBindings(){return new Map(this.textNodeBindings)}clearAllBindings(){for(const[e]of this.textNodeBindings)this.cleanupTextNode(e)}destroy(){this.cleanupObserver.disconnect(),this.clearAllBindings()}}class _s{listeners=new Map;on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){this.listeners.get(e)?.delete(t)}emit(e,...t){const s=this.listeners.get(e);s&&s.forEach((s=>{try{s(...t)}catch(t){console.error(`Event listener error for ${e}:`,t)}}))}}class ks{stateStore={};subscriptions=new Map;updateQueue=new Set;isUpdating=!1;eventBus=new _s;contextCache=new Map;previousValues=new Map;_subscriptionManager=new As;originalStateStore={};constructor(){this.setupGlobalStateProxy(),setInterval((()=>{this.subscriptionManager.cleanupStaleSubscriptions()}),3e4)}setInitialState(e,t){if(this.previousValues.set(e,void 0),this.originalStateStore[e]=t,this.previousValues.size>100){const e=this.previousValues.keys().next().value;"string"==typeof e&&this.previousValues.delete(e)}}get subscriptionManager(){return this._subscriptionManager}batchStateUpdates(e){const t=this.isUpdating;this.isUpdating=!0;try{return e()}finally{this.isUpdating=t,!this.isUpdating&&this.updateQueue.size>0&&this.scheduleFlush()}}invalidateContextCache(){this.contextCache.clear()}setupGlobalStateProxy(){this.originalStateStore=this.stateStore,this.stateStore=new Proxy(this.stateStore,{set:(e,t,s,n)=>{const i=e[t],r=Reflect.set(e,t,s,n);return i!==s&&this.notifySubscribers(t),r},get:(e,t)=>Reflect.get(e,t)})}notifySubscribers(e){if(this.eventBus.emit("stateChanged",e),this.updateQueue.add(e),e.includes(".")){const t=e.split(".")[0];this.updateQueue.add(t)}this.notifyPathBasedSubscribers(e),this.isUpdating||this.scheduleFlush()}notifyPathBasedSubscribers(e){const t=this.stateStore[e],s=this.previousValues?.get(e);for(const[n,i]of this.subscriptions)for(const n of i.dependencies)if(this.isPathDependency(n)&&n.startsWith(e+".")){const i=n.substring(e.length+1),r=this.getPathValue(s,i),a=this.getPathValue(t,i);this.deepEqual(r,a)||this.updateQueue.add(n)}}isPathDependency(e){return e.includes(".")&&e.split(".").length>1}getPathValue(e,t){if(!e||"object"!=typeof e)return;const s=t.split(".");let n=e;for(const e of s){if(null==n)return;if(Array.isArray(n))return"length"===e?n.length:n.map((t=>t?.[e])).filter((e=>void 0!==e));n=n[e]}return n}deepEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,s)=>this.deepEqual(e,t[s])));if("object"==typeof e&&"object"==typeof t){const s=Object.keys(e),n=Object.keys(t);return s.length===n.length&&s.every((s=>this.deepEqual(e[s],t[s])))}return!1}scheduleFlush=Ts((()=>{this.flushUpdates()}),d.DEBOUNCE_MS);flushUpdates(){if(!this.isUpdating){this.isUpdating=!0;try{const e=new Set,t=this.subscriptionManager.getSubscriptionsForKey("*");if(t&&t.size>0&&this.updateQueue.size>0)for(const e of t){const t=this.subscriptionManager.getSubscription(e);if(!t)continue;if(t.element&&!document.contains(t.element)){this.subscriptionManager.removeSubscription(e);continue}const s=t.element??document.body;try{const e=Array.from(this.updateQueue)[0];t.callback(s,{key:e})}catch(e){console.error("Wildcard subscription callback failed:",e)}}for(const t of this.updateQueue){if(e.has(t))continue;e.add(t);const s=this.subscriptionManager.getSubscriptionsForKey(t);if(s)for(const e of s){const s=this.subscriptionManager.getSubscription(e);if(!s)continue;if(s.element&&!document.contains(s.element)){this.subscriptionManager.removeSubscription(e);continue}const n=s.element??document.body;try{s.callback(n,{key:t})}catch(e){console.error("Subscription callback failed:",e)}}}}finally{this.updateQueue.clear(),this.isUpdating=!1}}}getState(){return this.stateStore}setState(e,t){if(this.previousValues.set(e,this.stateStore[e]),this.stateStore[e]=t,this.previousValues.size>100){const e=this.previousValues.keys().next().value;"string"==typeof e&&this.previousValues.delete(e)}}hasState(e){return e in this.originalStateStore}addSubscription(e){this._subscriptionManager.addSubscription(e)}removeSubscription(e){this._subscriptionManager.removeSubscription(e)}onStateChange(e){return this.eventBus.on("stateChanged",e)}batch(e){const t=this.isUpdating;this.isUpdating=!0;try{return e()}finally{this.isUpdating=t,!this.isUpdating&&this.updateQueue.size&&this.flushUpdates()}}getSubscriptions(){return this.subscriptionManager.getAllSubscriptions()}getKeyIndex(){const e=new Map,t=this.subscriptionManager.getAllSubscriptions();for(const[s,n]of t)for(const t of n.dependencies)e.has(t)||e.set(t,new Set),e.get(t).add(s);return e}}class ce{expressionCache=new $(d.MAX_CACHE_SIZE);dependencyCache=new $(d.MAX_CACHE_SIZE);commonExpressionsCache=new $(100);dependencyParser=new Is;static CACHE_KEYS={EXPRESSION:(e,t)=>`expr:${e}:${t}`,DEPENDENCY:(e,t)=>`deps:${e}:${t}`,COMMON:e=>`common:${e}`};constructor(){this.precompileCommonExpressions()}normalizeExpression(e){return e.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}precompileCommonExpressions(){["true","false","null","undefined"].forEach((e=>{const t={fn:new Function("return "+e),contextMap:new Map,dependencies:[e],timestamp:Date.now(),hitCount:0},s=ce.CACHE_KEYS.COMMON(e);this.commonExpressionsCache.set(s,t)}))}extractDependencies(e,t,s){const n=this.normalizeExpression(e),i=ce.CACHE_KEYS.DEPENDENCY(t,n);let r=this.dependencyCache.get(i);return r||(r=this.dependencyParser.extract(n,t,s),this.dependencyCache.set(i,r),r)}evaluateExpression(e,t,s){const n=this.normalizeExpression(e),i=ce.CACHE_KEYS.COMMON(n);let r=this.commonExpressionsCache.get(i);if(r){r.hitCount++;try{return r.fn()}catch(e){return void console.error(`Common expression evaluation failed: "${n}"`,e)}}const a=ce.CACHE_KEYS.EXPRESSION(s,n);r=this.expressionCache.get(a),(!r||this.isStale(r))&&(r=this.compileExpression(n,t,s),this.expressionCache.set(a,r)),r.hitCount++;try{const e=this.buildArguments(r.contextMap,t);return r.fn(...e)}catch(e){return console.error(`Expression evaluation failed: "${n}"`,e),void console.error("Available context:",Object.keys(t))}}compileExpression(e,t,s){const n=this.prepareSafeContext(t),i=new Map,r=[];Object.keys(n).forEach(((e,t)=>{i.set(e,t),r.push(e)}));const a=this.dependencyParser.extract(e,s);return{fn:new Function(...r,`return (${e})`),contextMap:i,dependencies:a,timestamp:Date.now(),hitCount:0}}buildArguments(e,t){const s=new Array(e.size);for(const[n,i]of e)s[i]=t[n];return s}isStale(e){return Date.now()-e.timestamp>3e5}prepareSafeContext(e){const t={};for(const[s,n]of Object.entries(e))Te.has(s)||!this.isValidJavaScriptIdentifier(s)||(t[s]=n);return t}isValidJavaScriptIdentifier(e){return/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)&&!Te.has(e)}invalidateCache(e){switch(e){case"expressions":this.expressionCache.clear();break;case"dependencies":this.dependencyCache.clear();break;case"common":this.commonExpressionsCache.clear(),this.precompileCommonExpressions();break;case"parser":this.dependencyParser.clearCache();break;default:this.clearAllCaches()}}invalidateByComponent(e){this.expressionCache.deleteByPrefix(`expr:${e}:`),this.dependencyCache.deleteByPrefix(`deps:${e}:`)}clearAllCaches(){this.expressionCache.clear(),this.dependencyCache.clear(),this.commonExpressionsCache.clear(),this.dependencyParser.clearCache(),this.precompileCommonExpressions()}getCacheStats(){return{expressions:this.expressionCache.getStats(),dependencies:this.dependencyCache.getStats(),commonExpressions:this.commonExpressionsCache.getStats(),dependencyParser:this.getDependencyParserStats()}}getDependencyParserStats(){return this.dependencyParser.getCacheSize?{size:this.dependencyParser.getCacheSize(),maxSize:500,hitRate:0,hits:0,misses:0}:{size:0,maxSize:0,hitRate:0,hits:0,misses:0}}cleanupStaleExpressions(){let e=0;return this.expressionCache.keys().forEach((t=>{const s=this.expressionCache.get(t);s&&this.isStale(s)&&(this.expressionCache.delete(t),e++)})),e}}class Is{parseCache=new $(500);extract(e,t,s){const n=this.normalizeExpression(e),i=`${t}:${n}`;if(this.parseCache.has(i))return this.parseCache.get(i);const r=this.parseExpression(n,t,s);return this.parseCache.set(i,r),r}normalizeExpression(e){return e.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}parseExpression(e,t,s){const n=this.extractIdentifiers(e),i=[],r=s?.getState()||{};for(const e of n){if(Te.has(e))continue;const s=e.indexOf("."),n=-1===s?e:e.substring(0,s),a=Be.findExistingStateKey(n,t,r);if(a)i.push(a);else{const e="app"===t?[`app.${n}`]:[`${t}.${n}`,`app.${n}`];i.push(...e)}if(-1!==s){const e="app"===t?[`app.${n}`]:[`${t}.${n}`,`app.${n}`];i.push(...e)}}return Array.from(new Set(i))}extractIdentifiers(e){const t=[];let s=0;for(;s<e.length;){const n=e[s];if("'"!==n)if('"'!==n)if("`"!==n)if(this.isIdentifierStart(n)){const n=this.extractIdentifier(e,s);t.push(n.value),s=n.endIndex}else s++;else s=this.skipTemplateLiteral(e,s,t);else s=this.skipString(e,s,'"');else s=this.skipString(e,s,"'")}return t}skipString(e,t,s){let n=t+1;for(;n<e.length&&e[n]!==s;)"\\"===e[n]&&n++,n++;return n+1}skipTemplateLiteral(e,t,s){let n=t+1;for(;n<e.length&&"`"!==e[n];)if("$"===e[n]&&n+1<e.length&&"{"===e[n+1]){n+=2;let t=1;for(;n<e.length&&t>0;){const i=e[n];if('"'!==i&&"'"!==i){if("{"===i?t++:"}"===i&&t--,t>0&&this.isIdentifierStart(i)){const t=this.extractIdentifier(e,n);s.push(t.value),n=t.endIndex-1}n++}else n=this.skipString(e,n,i)}}else"\\"===e[n]&&n++,n++;return n+1}extractIdentifier(e,t){let s=t;for(;s<e.length&&(this.isIdentifierPart(e[s])||"."===e[s]);)s++;return{value:e.substring(t,s),endIndex:s}}isIdentifierStart(e){return/[a-zA-Z_$]/.test(e)}isIdentifierPart(e){return/[a-zA-Z0-9_$]/.test(e)}clearCache(){this.parseCache.clear()}getCacheSize(){return this.parseCache.cache.size}}class Ns{componentStack=["app"];elementProps=new WeakMap;contextCache=new $(100);contextIndex=new Map;contextInvalidated=new Set;stateManager;processedScripts=new WeakSet;componentFunctions=new Map;expressionEvaluator;domBindingManager;loopManager;templateRenderer;updateTimeouts;updateBatcher=new et;propDependencyCache=new Map;constructor(e){this.stateManager=e,this.updateBatcher=new et,this.stateManager.onStateChange((e=>this.invalidateContextCache(e)))}getPropDependencies(e,t){const s=this.findElementWithProps(t);if(!s)return[];const n=this.elementProps.get(s);if(!n||!n.has(e))return[];const i=n.get(e);return this.templateRenderer?.dependencies(i.expression,i.component,this.stateManager)||[]}buildRestrictedComponentContext(e,t=!1){const s={};window[e]&&Object.assign(s,window[e]);const n=this.componentFunctions.get(e);if(n)for(const[e,t]of n)s[e]=t;const i=this.stateManager.getState();for(const t of Object.keys(i))if(t.startsWith(e+".")){const n=t.substring(e.length+1);n in s||(s[n]=i[t])}if(t){if(window.app)for(const[e,t]of Object.entries(window.app))e in s||(s[e]=t);const e=this.componentFunctions.get("app");if(e)for(const[t,n]of e)t in s||(s[t]=n);for(const e of Object.keys(i))if(e.startsWith("app.")){const t=e.substring(4);t in s||(s[t]=i[e])}}return s}getComponentPropDependencies(e,t){if(this.propDependencyCache.has(e))return this.propDependencyCache.get(e);const s=[],n=this.elementProps.get(e);n&&this.templateRenderer&&n.forEach((e=>{const t=this.templateRenderer?.dependencies(e.expression,e.component,this.stateManager);s.push(...t??[])}));const i=Array.from(new Set(s));return this.propDependencyCache.set(e,i),i}setDOMBindingManager(e){this.domBindingManager=e,this.updateBatcher.setManagers(this,e)}hasStoredProps(e){return this.elementProps.has(e)&&this.elementProps.get(e).size>0}setExpressionEvaluator(e){this.expressionEvaluator=e,this.templateRenderer=new Ke(e),this.loopManager=new Ft(this.stateManager,e)}extractProps(e,t){const s=new Map,n=e.attributes,i=e.getAttribute(d.ATTR_PREFIXES.CONTEXT),r=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);let a=t;i&&(a="app"===i?"app":"parent"===i?v.getParentOfComponent(r||"app",e):i);for(let t=0;t<n.length;t++){const i=n[t];if(i.name!==d.ATTR_PREFIXES.COMPONENT&&i.name!==d.ATTR_PREFIXES.CONTEXT&&i.name!==d.ATTR_PREFIXES.SPREAD&&i.name!==d.ATTR_PREFIXES.LOOP&&!oe.isEventAttribute(i.name)&&i.value&&ws.containsMustacheExpression(i.value)){if(r&&this.mightReferenceSelfProps(i.value,e))continue;const t=this.attributeToPropName(i.name),n={name:t,expression:i.value,component:a,subscriptionIds:[]};s.set(t,n)}}return s}mightReferenceSelfProps(e,t){const s=this.elementProps.get(t);return!!s&&Array.from(s.keys()).some((t=>e.includes(t)&&"dataState"!==t))}attributeToPropName(e){return e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}setupProps(e,t){const s=this.extractProps(e,t);0!==s.size&&(this.elementProps.set(e,s),this.expressionEvaluator&&s.forEach(((t,s)=>{this.setupPropBinding(e,t)})))}setupPropBinding(e,t){if(!this.expressionEvaluator)return;const s=`prop_${Date.now()}_${Math.random()}`,n=this.templateRenderer?.dependencies(t.expression,t.component,this.stateManager)||[],i={id:s,selector:"",dependencies:new Set(n),callback:()=>{const t=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);t&&(this.updateBatcher.scheduleUpdate(t,e),this.refreshComponentBindings(e,t))},element:e,component:t.component};this.stateManager.addSubscription(i),t.subscriptionIds.push(s)}refreshComponentBindings(e,t){this.contextInvalidated.add(t),this.contextCache.delete(t),this.domBindingManager&&this.domBindingManager.refreshComponentElement(e,t)}evaluateProps(e){const t={},s=this.elementProps.get(e);if(!s||!this.expressionEvaluator)return t;const n=s.values().next().value;if(!n)return t;const i=this.buildComponentContext(n.component);return s.forEach(((e,s)=>{try{const n=this.templateRenderer?.render(e.expression,i,e.component);t[s]="function"==typeof n?(...e)=>n.apply(this,e):n}catch(e){console.error(`❌ Failed to evaluate prop "${s}":`,e),t[s]=void 0}})),t}cleanupProps(e){const t=this.elementProps.get(e);t&&(t.forEach((e=>{e.subscriptionIds.forEach((e=>{this.stateManager.removeSubscription(e)}))})),this.elementProps.delete(e))}buildComponentContextWithProps(e,t){const s=this.buildComponentContext(e);let n=this.findElementWithProps(e);if(t&&this.elementProps.has(t)&&(n=t),n)try{const i=this.evaluatePropsWithContext(n,e,t);Object.keys(i).length>0&&Object.keys(i).forEach((e=>{s[e]=i[e]}))}catch(t){console.error(`❌ Error evaluating props for ${e}:`,t)}return s}evaluatePropsWithContext(e,t,s){const n={},i=this.elementProps.get(e);if(!i||!this.expressionEvaluator)return n;const r=i.values().next().value;if(!r)return n;let a;const o=e.getAttribute(d.ATTR_PREFIXES.CONTEXT),c=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(o)if("app"===o)a=this.buildComponentContext("app");else if("parent"===o){const t=v.getParentOfComponent(c||"app",e);a=this.buildComponentContext(t)}else a=this.buildComponentContext(o);else a=this.buildComponentContext(r.component);const p=this.loopManager?.getLoopContextForElement(e);p&&(a={...a,...p});const h=new Map,l=new Map,u=Array.from(i.keys());i.forEach(((e,t)=>{u.some((s=>s!==t&&e.expression.includes(s)))?l.set(t,e):h.set(t,e)})),h.forEach(((e,t)=>{try{const s=this.templateRenderer?.render(e.expression,a,o||e.component);"function"==typeof s?this.isFunctionExplicitlyPassed(e.expression)?n[t]=(...e)=>s.apply(this,e):(console.warn(`⚠️ Function "${t}" not passed - not from shared namespace or explicitly passed`),n[t]=void 0):n[t]=s}catch(s){console.error(`❌ Failed to evaluate simple prop "${t}":`,s),console.error("Expression:",e.expression),console.error("Available context keys:",Object.keys(a)),n[t]=void 0}}));const m={...a,...n};return l.forEach(((e,t)=>{try{const s=this.templateRenderer?.render(e.expression,m,o||e.component);"function"==typeof s?this.isFunctionExplicitlyPassed(e.expression)?n[t]=(...e)=>s.apply(this,e):(console.warn(`⚠️ Function "${t}" not passed - not from shared namespace or explicitly passed`),n[t]=void 0):n[t]=s}catch(s){console.error(`❌ Failed to evaluate complex prop "${t}":`,s),console.error("Expression:",e.expression),console.error("Available context keys:",Object.keys(m)),n[t]=void 0}})),n}isFunctionExplicitlyPassed(e){const t=_.isSingleExpression(e);return!!t&&/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(t.trim())}findElementWithProps(e){const t=document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}="${e}"]`);for(const e of t){const t=this.elementProps.get(e);if(t&&t.size>0)return e}return null}pushComponent(e){this.componentStack.push(e)}popComponent(){return this.componentStack.pop()}getCurrentComponent(){return this.componentStack[this.componentStack.length-1]}buildComponentContext(e){if(!this.contextInvalidated.has(e)&&this.contextCache.has(e))return this.contextCache.get(e);const t=this.computeComponentContext(e);return this.contextCache.set(e,t),this.contextInvalidated.delete(e),t}computeComponentContext(e){const t={};"app"!==e&&window[e]&&Object.assign(t,window[e]),"app"===e&&window.app&&Object.assign(t,window.app);const s=this.componentFunctions.get(e);if(s)for(const[e,n]of s)t[e]=n;if("app"!==e){const e=this.componentFunctions.get("app");if(e)for(const[s,n]of e)s in t||(t[s]=n)}const n=this.stateManager.getState();for(const s of Object.keys(n))if(s.startsWith(e+".")){const i=s.substring(e.length+1);i in t||(t[i]=n[s])}if("app"!==e)for(const e of Object.keys(n))if(e.startsWith("app.")){const s=e.substring(4);s in t||(t[s]=n[e])}return t}invalidateContextCache(e){if(e.startsWith("app.")){this.contextCache.clear();for(const e of this.contextInvalidated.keys())this.contextInvalidated.add(e);return}const t=e.indexOf(".");if(-1!==t){const s=e.slice(0,t);this.invalidateComponent(s)}}invalidateComponent(e){this.contextInvalidated.add(e),this.contextIndex.delete(e)}executePhpScripts(e){const t=this.componentStack.length,s=e.getAttribute(d.ATTR_PREFIXES.COMPONENT),n=e===document.body;if(s||n){if(s){this.pushComponent(s);const t=this.getParentComponent(e);this.setupProps(e,t)}this.getRelevantScripts(e,n).forEach((e=>{const t=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);t&&t!==s?(this.pushComponent(t),this.executeScript(e),this.popComponent()):this.executeScript(e)}))}for(Array.from(e.children).forEach((e=>this.executePhpScripts(e)));this.componentStack.length>t;)this.popComponent()}getParentComponent(e){let t=e.parentElement;for(;t;){const e=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(e)return e;t=t.parentElement}return"app"}getRelevantScripts(e,t){return Array.from(e.querySelectorAll(`script[type="${d.SCRIPT_TYPE}"]`)).filter((s=>{if(this.processedScripts.has(s))return!1;if(t)return!!s.hasAttribute(d.ATTR_PREFIXES.COMPONENT)||!s.closest(`[${d.ATTR_PREFIXES.COMPONENT}]`);let n=s.parentElement;for(;n&&n!==e;){if(n.hasAttribute(d.ATTR_PREFIXES.COMPONENT))return!1;n=n.parentElement}return n===e||e.contains(s)}))}executeScript(e){if(this.processedScripts.has(e))return;this.processedScripts.add(e);const t=this.getCurrentComponent(),s=e.textContent||"",n=_.decodeEntities(s);try{const s=this.findComponentElementForScript(e,t);if(s===e){const t=this.getParentComponent(e);this.setupProps(e,t)}const i=this.buildComponentContextWithProps(t,s);window[t]||(window[t]={}),this.executeScriptFunctions(n,t,i)}catch(e){console.error(`Script execution failed in component ${t}:`,e),console.error("Script content:",n)}}findComponentElementForScript(e,t){if(e.getAttribute(d.ATTR_PREFIXES.COMPONENT)===t)return e;let s=e.parentElement;for(;s;){if(s.getAttribute(d.ATTR_PREFIXES.COMPONENT)===t)return s;s=s.parentElement}const n=document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}="${t}"]`);for(const e of n)if(this.elementProps.has(e))return e;return n[0]||void 0}executeScriptFunctions(e,t,s){const n=this.extractFunctionNames(e),i=this.findElementWithProps(t),r=this.extractVariableDeclarations(e);let a={...s};if(r.forEach((e=>{delete a[e];const t=`set${Vt(e)}`,s=`${e}Getter`;delete a[t],delete a[s]})),i){const e=this.evaluateProps(i);Object.assign(a,e)}a.getContext=()=>this.buildComponentContextWithProps(t),a.withContext=e=>{const s=this.buildComponentContextWithProps(t);return e.call(s,s)},a.__getProp=e=>{if(i)return this.evaluateProps(i)[e]};let o=z.getInstance().transformStateDeclarations(e);o=this.modifyScriptForReactiveProps(o,t,i||void 0);const c=`\n    ${o}\n\n    ${n.map((e=>`\n      if (typeof ${e} === 'function') {\n        this['${e}'] = ${e};\n      }\n    `)).join("\n")}\n  `,p=Object.keys(a),h=p.map((e=>a[e]));if(this.checkIfInLoopItem()){const e=this.extractLoopItemContext();this.domBindingManager.stateManager.currentLoopContext=e}try{new Function(...p,c).call(window[t],...h),window[t].getContext=a.getContext,window[t].withContext=a.withContext,window[t].__getProp=a.__getProp;for(const e of n){const s=window[t][e];"function"==typeof s&&this.storeFunctionForComponent(t,e,s)}this.invalidateComponent(t)}catch(s){console.error("Script execution failed:",s),console.error("Component:",t),console.error("Original script:",e),console.error("Processed script:",o),console.error("Execution context keys:",Object.keys(a))}finally{this.domBindingManager.stateManager.currentLoopContext=null}}checkIfInLoopItem(){return!1}extractLoopItemContext(){return{}}extractVariableDeclarations(e){const t=z.getInstance().extractStateDeclarations(e).map((e=>e.variableName)),s=[],n=/(?:const|let|var)\s*\[\s*([^,\]]+)(?:\s*,\s*([^,\]]+))?\s*\]/g;let i;for(;null!==(i=n.exec(e));)i[1]&&!t.includes(i[1].trim())&&s.push(i[1].trim()),i[2]&&!t.includes(i[2].trim())&&s.push(i[2].trim());const r=/(?:const|let|var)\s+([a-zA-Z_$][\w$]*)/g;for(;null!==(i=r.exec(e));)t.includes(i[1])||s.push(i[1]);return[...t,...s]}modifyScriptForReactiveProps(e,t,s){if(!s||!this.elementProps.has(s))return e;const n=this.elementProps.get(s),i=Array.from(n.keys());let r=e;return i.forEach((e=>{r=this.replacePropOutsideStrings(r,e)})),r}replacePropOutsideStrings(e,t){let s="",n=0;const i=e.length;for(;n<i;){const r=e[n];if("'"!==r)if('"'!==r)if("`"!==r){if("/"===r&&n+1<i){if("/"===e[n+1]){const t=e.indexOf("\n",n),r=-1===t?i:t;s+=e.slice(n,r),n=r;continue}if("*"===e[n+1]){const t=e.indexOf("*/",n+2),r=-1===t?i:t+2;s+=e.slice(n,r),n=r;continue}}this.matchesPropName(e,n,t)?(s+=`__getProp('${t}')`,n+=t.length):(s+=r,n++)}else{const t=this.findTemplateEnd(e,n);s+=e.slice(n,t+1),n=t+1}else{const t=this.findStringEnd(e,n,'"');s+=e.slice(n,t+1),n=t+1}else{const t=this.findStringEnd(e,n,"'");s+=e.slice(n,t+1),n=t+1}}return s}findStringEnd(e,t,s){let n=t+1;for(;n<e.length;){if(e[n]===s&&"\\"!==e[n-1])return n;"\\"===e[n]&&n++,n++}return e.length-1}findTemplateEnd(e,t){let s=t+1,n=0;for(;s<e.length;){const t=e[s];if("`"===t&&0===n)return s;"$"===t&&s+1<e.length&&"{"===e[s+1]?(n++,s++):"}"===t&&n>0?n--:"\\"===t&&s++,s++}return e.length-1}matchesPropName(e,t,s){if(t+s.length>e.length||e.substr(t,s.length)!==s)return!1;const n=t>0?e[t-1]:"",i=t+s.length<e.length?e[t+s.length]:"",r=0===t||!/[a-zA-Z0-9_$]/.test(n),a=t+s.length===e.length||!/[a-zA-Z0-9_$]/.test(i);if(!r||!a||"."===n||"."===i)return!1;const o=e.slice(t+s.length);if(/^\s*[=:]/.test(o))return!1;const c=e.slice(Math.max(0,t-20),t);return!/[a-zA-Z0-9_$]\s*\.\s*$/.test(c)}extractFunctionNames(e){return z.getInstance().extractFunctionNames(e)}storeFunctionForComponent(e,t,s){this.componentFunctions.has(e)||this.componentFunctions.set(e,new Map),this.componentFunctions.get(e).set(t,s),window[e]||(window[e]={}),window[e][t]=s}getComponentFunctions(e){return this.componentFunctions.get(e)}destroy(){if(this.updateTimeouts){for(const e of this.updateTimeouts.values())clearTimeout(e);this.updateTimeouts.clear()}}}class Ms{stateManager;componentManager;expressionEvaluator;textNodeManager;observer;listeners=new WeakMap;pendingBindings=[];pendingTextNodes=[];applyingUpdates=!1;elementCache=new WeakMap;batchedUpdates=new Set;processingRAF=null;updateQueue=new Map;eventDelegation=new se;processedElements=new WeakSet;loopManager;templateRenderer;BOOL_REFLECTED={checked:"checked",disabled:"disabled",hidden:"hidden",readonly:"readOnly",required:"required",multiple:"multiple",selected:"selected",autofocus:"autofocus",autoplay:"autoplay",controls:"controls",defer:"defer",loop:"loop",muted:"muted",open:"open",reversed:"reversed",async:"async",default:"default",formnovalidate:"formNoValidate",novalidate:"noValidate",allowfullscreen:"allowFullscreen",capture:"capture",itemscope:"itemScope"};lastValueCache=new WeakMap;stringValueCache=new $(500);constructor(e,t,s){this.stateManager=e,this.componentManager=t,this.expressionEvaluator=s,this.textNodeManager=new Ps(s,e),this.textNodeManager.componentManager=this.componentManager,this.componentManager.setDOMBindingManager(this),this.setupMutationObserver(),this.eventDelegation.setupEventDelegation(),this.loopManager=new Ft(e,s),this.loopManager.setDependencies(t,this),this.loopManager.eventDelegation=this.eventDelegation,this.eventDelegation.setDependencies(this.componentManager,this.expressionEvaluator,this.loopManager),this.templateRenderer=new Ke(s)}refreshComponentElement(e,t){this.elementCache.delete(e),this.processedElements.delete(e);const s=[...this.componentManager.componentStack];this.componentManager.componentStack=["app"],"app"!==t&&this.componentManager.componentStack.push(t);try{const s=this.componentManager.buildComponentContextWithProps(t,e);this.processElementInContext(e,s,t,!0),this.walkComponentChildren(e,t),this.refreshComponentTextNodes(e,t)}finally{this.componentManager.componentStack=s}}refreshComponentTextNodes(e,t){const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const s=e;return!s.textContent||!d.MUSTACHE_PATTERN.test(s.textContent)||v.isTextNodeInsideScript(s)||this.isTextNodeInsideLoopItem(s)||v.getComponentForNode(s)!==t?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let n;const i=[];for(;n=s.nextNode();)i.push(n);i.forEach((e=>{this.textNodeManager.cleanupTextNode(e),this.textNodeManager.cleanupTextNode(e),this.textNodeManager.processTextNode(e,t)}))}walkComponentChildren(e,t){const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const n=s;return v.getElementComponent(n)!==t?NodeFilter.FILTER_REJECT:n===e?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}});let n;const i=[];for(;n=s.nextNode();){const e=n;i.push(e)}i.forEach((s=>{this.elementCache.delete(s),this.processedElements.delete(s);const n=this.componentManager.buildComponentContextWithProps(t,e);this.processElementInContext(s,n,t,!0)}))}createSpreadDirectiveBinding(e,t,s){const n=`spread_${Date.now()}_${Math.random()}`,i=_.parseSpreadDirective(t);if(0===i.spreads.length&&0===i.objects.length)return void console.warn(`Invalid pp-spread directive: ${t}`);const r=new Set,a=()=>{if(document.contains(e))try{const t=this.componentManager.buildComponentContextWithProps(s,e);this.clearSpreadAttributes(e,r);for(const n of i.spreads){const i=this.expressionEvaluator.evaluateExpression(n,t,s);i&&"object"==typeof i&&this.applySpreadObject(e,i,r)}for(const n of i.objects)this.applyObjectProperties(e,n,t,s,r)}catch(e){console.error(`Spread directive evaluation error for "${t}":`,e)}else this.stateManager.removeSubscription(n)},o=new Set;for(const e of i.spreads)this.templateRenderer.dependencies(e,s,this.stateManager).forEach((e=>o.add(e)));for(const e of i.objects)for(const t of e)this.templateRenderer.dependencies(t.value,s,this.stateManager).forEach((e=>o.add(e)));const c={id:n,selector:"",dependencies:o,callback:a,element:e,component:s};this.stateManager.addSubscription(c),this.storeSpreadSubscription(e,n),a()}applyObjectProperties(e,t,s,n,i){for(const r of t)try{const t=this.expressionEvaluator.evaluateExpression(r.value,s,n);if(this.isEventProperty(r.key)){this.handleSpreadEventProperty(e,r.key,t);continue}const a=this.normalizeAttributeName(r.key);this.updateElementProperty(e,a,t),i.add(a)}catch(e){console.error(`Error evaluating object property "${r.key}: ${r.value}":`,e)}}applySpreadObject(e,t,s){for(const[n,i]of Object.entries(t))if(null!=i){if(this.isEventProperty(n)){this.handleSpreadEventProperty(e,n,i);continue}const t=this.normalizeAttributeName(n);(!e.hasAttribute(t)||s.has(t))&&(this.updateElementProperty(e,t,i),s.add(t))}}isEventProperty(e){return e.startsWith("on")&&e.length>2}handleSpreadEventProperty(e,t,s){const n=t.substring(2).toLowerCase();if("function"==typeof s){const t=t=>{try{const n=v.getContextComponent(e),i=this.componentManager?.buildComponentContextWithProps(n,e)||{};s.call(i,t)}catch(e){console.error("Spread event handler error:",e)}};return e.addEventListener(n,t),void this.storeDirectEventListener(e,n,t)}if("string"==typeof s){const t=v.getContextComponent(e);this.eventDelegation.registerEventHandler(e,n,s,t)}}storeDirectEventListener(e,t,s){e.__directEventListeners||(e.__directEventListeners=[]),e.__directEventListeners.push({eventType:t,listener:s})}clearSpreadAttributes(e,t){for(const s of t)e.hasAttribute(s)&&e.removeAttribute(s);t.clear()}normalizeAttributeName(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}storeSpreadSubscription(e,t){e.__spreadSubscriptions||(e.__spreadSubscriptions=[]),e.__spreadSubscriptions.push(t)}setupMutationObserver(){this.observer=new MutationObserver((e=>{const t=e.filter(this.isRelevantMutation);if(0===t.length)return;const s=L.getInstance();for(const e of t)if("childList"===e.type&&(e.removedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;s.invalidateElement(t);const n=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);n&&s.invalidateByComponent(n)}})),e.addedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);t&&s.invalidateByComponent(t)}}))),"attributes"===e.type&&e.target){const t=e.target;s.invalidateElement(t);const n=t.getAttribute(d.ATTR_PREFIXES.COMPONENT);n&&s.invalidateByComponent(n)}this.processMutationsBatch(t)})),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeFilter:[d.ATTR_PREFIXES.COMPONENT]})}isRelevantMutation=e=>{if(this.applyingUpdates&&"attributes"===e.type)return!1;if("childList"===e.type||"characterData"===e.type)return!0;if("attributes"===e.type){const t=e.attributeName;return t===d.ATTR_PREFIXES.COMPONENT||null!==t&&oe.isEventAttribute(t)}return!1};processElement(e,t=!0){if(e===document.body){const s=Array.from(document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}]`)).sort(((e,t)=>v.getElementDepth(e)-v.getElementDepth(t)));this.processElementsBatch([e],t),s.forEach((e=>{this.processElementsBatch([e],t)})),t&&this.loopManager.processPendingTemplates()}else this.processElementsBatch([e],t)}processElementsBatch(e,t=!0){for(const s of e)this.processSingleElement(s,t);t&&(e.forEach((e=>{this.componentManager.executePhpScripts(e)})),this.processPendingBindings())}processSingleElement(e,t){const s=v.getElementComponent(e),n=e.getAttribute(d.ATTR_PREFIXES.CONTEXT);let i;i=n?"app"===n?"app":"parent"===n?v.getParentOfComponent(s,e):n:v.getParentComponentForElement(e);const r=this.componentManager.componentStack.length;"app"!==s&&this.componentManager.pushComponent(s),this.componentManager.setupProps(e,i),t&&this.componentManager.executePhpScripts(e),this.processLoopTemplates(e,s);const a=t?this.componentManager.buildComponentContextWithProps(s,e):{};for(this.processElementInContext(e,a,s,t),this.walkDOM(e,a,s,t);this.componentManager.componentStack.length>r;)this.componentManager.popComponent()}processLoopTemplates(e,t){this.getDirectComponentTemplates(e,t).forEach((e=>{this.loopManager.queueTemplate(e,t)}))}getDirectComponentTemplates(e,t){const s=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{const s=t;return s!==e&&s.hasAttribute(d.ATTR_PREFIXES.COMPONENT)?NodeFilter.FILTER_REJECT:"TEMPLATE"===s.tagName&&s.hasAttribute("pp-for")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i;for(;i=n.nextNode();)s.push(i);return s}walkDOM(e,t,s,n){const i=ae.getInstance(),r=`walkDOM_${s}_${n}`,a=i.getCachedTraversal(e,r,(()=>{const t=i.traverseElementsAndText(e,(t=>{if(t===e||"script"===t.tagName.toLowerCase()||this.loopManager.isLoopItem(t))return!1;let n=t.parentElement;for(;n&&n!==e;){if(this.loopManager.isLoopItem(n))return!1;n=n.parentElement}return!(v.getElementComponent(t)!==s||this.processedElements.has(t))}),(e=>{if(!e.textContent||!d.MUSTACHE_PATTERN.test(e.textContent)||v.isTextNodeInsideScript(e)||this.isTextNodeInsideLoopItem(e))return!1;const t=e.parentElement;if(t){const n=v.getContextComponent(t),i=v.getComponentForNode(e);if(n!==s&&i!==s)return!1}else if(v.getComponentForNode(e)!==s)return!1;return!0}));return[...t.textNodes,...t.elements]})),o=[],c=[];a.forEach((e=>{e.nodeType===Node.TEXT_NODE?o.push(e):e.nodeType===Node.ELEMENT_NODE&&(c.push(e),this.processedElements.add(e))})),o.forEach((e=>{const t=e.parentElement,i=t?v.getContextComponent(t):s;n?this.textNodeManager.processTextNode(e,i):this.pendingTextNodes.push({textNode:e,component:i})})),c.forEach((e=>{this.processElementInContext(e,t,s,n)}))}isTextNodeInsideLoopItem(e){let t=e.parentElement;for(;t&&t!==document.body;){if(this.loopManager.isLoopItem(t))return!0;t=t.parentElement}return!1}processElementInContext(e,t,s,n){if(e.hasAttribute(d.ATTR_PREFIXES.SPREAD)){const t=e.getAttribute(d.ATTR_PREFIXES.SPREAD);n&&this.createSpreadDirectiveBinding(e,t,s),e.removeAttribute(d.ATTR_PREFIXES.SPREAD)}if(this.loopManager.isLoopItem(e)||this.isElementInLoopItem(e))return;const i=this.extractDomMustacheBindings(e),r=this.elementCache.get(e),a=this.getElementHash(e);if(r&&r.hash===a&&this.isCacheValid(r)&&n)return void this.applyBindingsFromCache(e,r,t);const o={bindings:i,component:s,listeners:[],lastProcessed:Date.now(),hash:a};n?this.applyBindings(e,i,t,s):i.forEach(((t,n)=>{this.pendingBindings.push({element:e,property:n,expression:t,component:s})})),this.setupEventBindings(e,s),this.elementCache.set(e,o)}isElementInLoopItem(e){let t=e;for(;t;){if(this.loopManager.isLoopItem(t))return!0;t=t.parentElement}return!1}extractDomMustacheBindings(e){const t=new Map,s=e.attributes,n=e.getAttribute(d.ATTR_PREFIXES.CONTEXT),i=e.getAttribute(d.ATTR_PREFIXES.COMPONENT),r=i&&this.componentManager?.hasStoredProps(e),a=n&&i&&n!==i;for(let n=0;n<s.length;n++){const i=s[n];if(i.name!==d.ATTR_PREFIXES.COMPONENT&&i.name!==d.ATTR_PREFIXES.CONTEXT&&!oe.isEventAttribute(i.name)&&i.value){const s=d.MUSTACHE_PATTERN.test(i.value),n=_.decodeEntities(i.value),o=d.MUSTACHE_PATTERN.test(n);(s||o)&&(r||a&&v.shouldBeDirectBinding(e,i.name)?t.set(i.name,i.value):a||t.set(i.name,i.value))}}return t}applyBindings(e,t,s,n){t.forEach(((t,s)=>{this.createMustacheBinding(e,s,t)})),this.setupEventBindings(e,n)}applyBindingsFromCache(e,t,s){t.bindings.forEach(((s,n)=>{try{const i=this.componentManager.buildComponentContextWithProps(t.component,e),r=this.templateRenderer.render(s,i,t.component);this.updateElementProperty(e,n,r)}catch(e){console.error(`Cached binding evaluation error for "${s}":`,e)}}))}createMustacheBinding(e,t,s){const n=`mustache_${Date.now()}_${Math.random()}`;let i;const r=e.getAttribute(d.ATTR_PREFIXES.COMPONENT);if(r&&this.componentManager?.hasStoredProps(e)){const t=this.componentManager.elementProps.get(e);i=(t?Array.from(t.keys()):[]).some((e=>s.includes(e)))?r:v.getContextComponent(e)}else i=v.getContextComponent(e);e.removeAttribute(t);const a=new Set;this.templateRenderer.dependencies(s,i,this.stateManager).forEach((e=>a.add(e)));const o=this.findComponentElementForMustacheBinding(e,i);o&&this.componentManager&&this.componentManager.getComponentPropDependencies(o,i).forEach((e=>a.add(e)));const c=()=>{if(document.contains(e))try{const n=i===r?e:o||void 0,a=this.componentManager.buildComponentContextWithProps(i,n),c=this.templateRenderer.render(s,a,i);this.scheduleElementUpdate(e,t,c)}catch(e){console.error(`Mustache binding evaluation error for "${s}":`,e)}else this.stateManager.removeSubscription(n)},p={id:n,selector:"",dependencies:a,callback:c,element:e,component:i};this.stateManager.addSubscription(p),c()}findComponentElementForMustacheBinding(e,t){if(e.getAttribute(d.ATTR_PREFIXES.COMPONENT)===t)return e;let s=e.parentElement;for(;s;){if(s.getAttribute(d.ATTR_PREFIXES.COMPONENT)===t)return s;s=s.parentElement}const n=document.querySelectorAll(`[${d.ATTR_PREFIXES.COMPONENT}="${t}"]`);for(const e of n)if(this.componentManager&&this.componentManager.hasStoredProps(e))return e;return n[0]||null}setupEventBindings(e,t){for(let t=0;t<e.attributes.length;t++){const s=e.attributes[t];if(oe.isEventAttribute(s.name)){const t=s.name.substring(2),n=v.getContextComponent(e);this.eventDelegation.registerEventHandler(e,t,s.value,n),e.removeAttribute(s.name)}}}scheduleElementUpdate(e,t,s){this.isCriticalProperty(t)?this.updateElementProperty(e,t,s):(this.updateQueue.has(e)||(this.updateQueue.set(e,new Set),this.batchedUpdates.add(e)),this.updateQueue.get(e).add(t),this.processingRAF||(this.processingRAF=requestAnimationFrame((()=>{this.processBatchedElementUpdates()}))),e[`__pending_${t}`]=s)}isCriticalProperty(e){return["textContent","innerHTML","value","checked","selected","disabled","class","className","style","hidden","display"].includes(e)}processBatchedElementUpdates(){this.applyingUpdates=!0;try{for(const e of this.batchedUpdates){const t=this.updateQueue.get(e);if(t)for(const s of t){const t=e[`__pending_${s}`];this.updateElementProperty(e,s,t),delete e[`__pending_${s}`]}}}finally{this.batchedUpdates.clear(),this.updateQueue.clear(),this.processingRAF=null,this.applyingUpdates=!1}}updateElementProperty(e,t,s){const n=this.lastValueCache.get(e);if(!n||!this.isSameValue(n.get(t),s))try{switch(t){case"textContent":const n=this.cachedValueToString(s);e.textContent!==n&&(e.textContent=n);break;case"innerHTML":const i=this.cachedValueToString(s);e.innerHTML!==i&&(e.innerHTML=i);break;case"value":const r=this.cachedValueToString(s);e instanceof HTMLOptionElement?e.value!==r&&(e.value=r,e.setAttribute("value",r)):(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&e.value!==r&&(e.value=r);break;case"selectedIndex":if(e instanceof HTMLSelectElement){const t=Number(s);e.selectedIndex!==t&&(e.selectedIndex=t)}break;case"checked":case"disabled":case"hidden":case"readonly":case"required":case"multiple":case"selected":case"autofocus":case"autoplay":case"controls":case"defer":case"loop":case"muted":case"open":case"reversed":case"async":case"default":case"formnovalidate":case"novalidate":case"allowfullscreen":case"capture":case"itemscope":this.setBooleanProperty(e,t,s);break;case"indeterminate":if(e instanceof HTMLInputElement&&"checkbox"===e.type){const t=!!s;e.indeterminate!==t&&(e.indeterminate=t)}break;case"class":case"className":const a=this.cachedValueToString(s);e.className!==a&&(e.className=a);break;case"htmlFor":case"for":if(e instanceof HTMLLabelElement){const t=this.cachedValueToString(s);e.htmlFor!==t&&(e.htmlFor=t)}break;case"style":if(e instanceof HTMLElement)if("object"==typeof s&&s&&!Array.isArray(s))this.updateStyleObject(e,s);else{const t=this.cachedValueToString(s);e.style.cssText!==t&&(e.style.cssText=t)}break;case"tabIndex":if(e instanceof HTMLElement){const t=null==s?-1:Number(s);e.tabIndex!==t&&(e.tabIndex=t)}break;case"contentEditable":if(e instanceof HTMLElement){const t=!0===s?"true":!1===s?"false":String(s);e.contentEditable!==t&&(e.contentEditable=t)}break;case"draggable":if(e instanceof HTMLElement){const t=!0===s,n=t?"true":"false";e.draggable!==t&&(e.draggable=t,e.setAttribute("draggable",n))}break;case"spellcheck":if(e instanceof HTMLElement){const t=!!s,n=t?"true":"false";e.spellcheck!==t&&(e.spellcheck=t,e.setAttribute("spellcheck",n))}break;case"src":case"href":case"action":case"alt":case"title":case"placeholder":case"id":case"name":case"type":case"method":case"target":case"rel":case"pattern":case"accept":case"autocomplete":case"enctype":case"wrap":case"download":case"ping":case"referrerpolicy":case"crossorigin":case"integrity":case"loading":case"decoding":case"srcset":case"sizes":case"dir":case"lang":case"translate":case"role":this.setStringAttribute(e,t,s);break;case"min":case"max":case"step":case"maxLength":case"minLength":case"size":case"rows":case"cols":case"rowSpan":case"colSpan":this.setNumericAttribute(e,t,s);break;default:t.startsWith("aria-")?this.setAriaAttribute(e,t,s):t.startsWith("data-")?this.setDataAttribute(e,t,s):this.setGenericAttribute(e,t,s)}this.updateValueCache(e,t,s)}catch(s){console.error(`Failed to update property "${t}" on element:`,e,s)}}cachedValueToString(e){if("string"==typeof e)return e;if("number"==typeof e)return String(e);if(null==e)return"";if("boolean"==typeof e)return e?"true":"false";if(this.stringValueCache.has(e))return this.stringValueCache.get(e);const t=ie(e);return this.stringValueCache.set(e,t),t}isSameValue(e,t){if(e===t)return!0;if("object"==typeof e&&"object"==typeof t){if(null===e||null===t)return e===t;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,s)=>e===t[s]));if(this.isStyleObject(e)&&this.isStyleObject(t)){const s=Object.keys(e),n=Object.keys(t);return s.length===n.length&&s.every((s=>e[s]===t[s]))}}return!1}isStyleObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}setBooleanProperty(e,t,s){const n=!!s;this.setBooleanProp(e,t,s)||(n&&!e.hasAttribute(t)?e.setAttribute(t,""):!n&&e.hasAttribute(t)&&e.removeAttribute(t))}updateStyleObject(e,t){const s=this.lastValueCache.get(e)?.get("style"),n=s&&"object"==typeof s?s:{};for(const[s,i]of Object.entries(t))n[s]!==i&&(e.style[s]=i)}setStringAttribute(e,t,s){const n=this.cachedValueToString(s);e.getAttribute(t)!==n&&(null==s?e.removeAttribute(t):e.setAttribute(t,n))}setNumericAttribute(e,t,s){const n=String(s);e.getAttribute(t)!==n&&(null==s?e.removeAttribute(t):e.setAttribute(t,n))}setAriaAttribute(e,t,s){const n=this.cachedValueToString(s);e.getAttribute(t)!==n&&(null==s||!1===s?e.removeAttribute(t):e.setAttribute(t,n))}setDataAttribute(e,t,s){const n=this.cachedValueToString(s);e.getAttribute(t)!==n&&(null==s?e.removeAttribute(t):e.setAttribute(t,n))}setGenericAttribute(e,t,s){const n=this.cachedValueToString(s);e.getAttribute(t)!==n&&(null==s||!1===s?e.removeAttribute(t):e.setAttribute(t,n))}updateValueCache(e,t,s){this.lastValueCache.has(e)||this.lastValueCache.set(e,new Map),this.lastValueCache.get(e).set(t,s)}setBooleanProp(e,t,s){const n=this.BOOL_REFLECTED[t];if(!n)return!1;const i=!!s;return e instanceof HTMLElement&&n in e?(e[n]!==i&&(e[n]=i),!0):(i?e.hasAttribute(t)||e.setAttribute(t,""):e.hasAttribute(t)&&e.removeAttribute(t),!0)}processPendingBindings(){const e=[...this.pendingBindings];this.pendingBindings=[];const t=new Map;for(const s of e)t.has(s.component)||t.set(s.component,[]),t.get(s.component).push(s);for(const[e,s]of t){const t=[...this.componentManager.componentStack];this.componentManager.componentStack="app"!==e?["app",e]:["app"];for(const t of s)try{if(!document.contains(t.element))continue;this.createMustacheBinding(t.element,t.property,t.expression)}catch(t){console.error(`❌ Failed to create binding for ${e}:`,t)}this.componentManager.componentStack=t}this.processTextNodesPending()}processTextNodesPending(){const e=new Map;for(const t of this.pendingTextNodes)e.has(t.component)||e.set(t.component,[]),e.get(t.component).push(t);this.pendingTextNodes=[];for(const[t,s]of e){const e=[...this.componentManager.componentStack];this.componentManager.componentStack="app"!==t?["app",t]:["app"];for(const{textNode:e,component:t}of s)if(document.contains(e))try{this.textNodeManager.processTextNode(e,t)}catch(e){console.error(`❌ Failed to process text node for ${t}:`,e)}this.componentManager.componentStack=e}}processMutationsBatch(e){const t=new Set,s=new Set,n=new Set,i=new Set;for(const r of e)if("childList"===r.type&&(r.addedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE)t.add(e);else if(e.nodeType===Node.TEXT_NODE){const t=e;t.textContent&&d.MUSTACHE_PATTERN.test(t.textContent)&&i.add(t)}})),r.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE?s.add(e):e.nodeType===Node.TEXT_NODE&&this.textNodeManager.cleanupTextNode(e)}))),"attributes"===r.type&&r.target&&n.add(r.target),"characterData"===r.type&&r.target){const e=r.target;e.textContent&&d.MUSTACHE_PATTERN.test(e.textContent)&&i.add(e)}s.size>0&&this.cleanupElementsBatch(Array.from(s)),t.size>0&&this.processElementsBatch(Array.from(t)),i.size>0&&this.processTextNodesBatch(Array.from(i)),n.size>0&&this.rebindChangedElements(Array.from(n))}processTextNodesBatch(e){const t=new Map;for(const s of e){const e=v.getComponentForNode(s);t.has(e)||t.set(e,[]),t.get(e).push(s)}for(const[e,s]of t)s.forEach((t=>{this.textNodeManager.processTextNode(t,e)}))}rebindChangedElements(e){e.forEach((e=>{this.processElementBindings(e,!0)}))}processElementBindings(e,t=!0){const s=this.extractDomMustacheBindings(e),n=v.getElementComponent(e);s.forEach(((s,i)=>{t?this.createMustacheBinding(e,i,s):this.pendingBindings.push({element:e,property:i,expression:s,component:n})})),t&&this.setupEventBindings(e,n)}cleanupElementsBatch(e){e.forEach((e=>this.cleanupElement(e)))}cleanupElement(e){this.stateManager.subscriptionManager?.cleanupElement(e);const t=this.listeners.get(e)||[];for(const{type:s,fn:n}of t)e.removeEventListener(s,n);this.listeners.delete(e),this.elementCache.delete(e),this.processedElements.delete(e),this.componentManager.cleanupProps(e);const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let n;for(;n=s.nextNode();)this.textNodeManager.cleanupTextNode(n);"TEMPLATE"===e.tagName&&e.hasAttribute("pp-for")&&this.loopManager.cleanupTemplate(e),e.querySelectorAll("template[pp-for]").forEach((e=>{this.loopManager.cleanupTemplate(e)}));const i=e.__directEventListeners;i&&(i.forEach((({eventType:t,listener:s})=>{e.removeEventListener(t,s)})),delete e.__directEventListeners);const r=e.__spreadEventHandlers;r&&(r.forEach((e=>{window.__spreadHandlers&&window.__spreadHandlers.delete(e)})),delete e.__spreadEventHandlers);const a=e.__spreadSubscriptions;a&&(a.forEach((e=>{this.stateManager.removeSubscription(e)})),delete e.__spreadSubscriptions),this.lastValueCache.delete(e),this.stringValueCache.size()>1500&&this.stringValueCache.clear()}getElementHash(e){const t=[];for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s];(n.name===d.ATTR_PREFIXES.COMPONENT||oe.isEventAttribute(n.name)||n.value&&d.MUSTACHE_PATTERN.test(n.value))&&t.push(`${n.name}=${n.value}`)}return t.sort().join("|")}isCacheValid(e){return Date.now()-e.lastProcessed<3e4}refreshAllBindings(){this.elementCache=new WeakMap,this.processedElements=new WeakSet,this.processElement(document.body,!0)}destroy(){this.observer&&this.observer.disconnect(),this.eventDelegation.cleanup(),this.batchedUpdates.clear(),this.updateQueue.clear(),this.processingRAF&&cancelAnimationFrame(this.processingRAF),this.elementCache=new WeakMap,this.listeners=new WeakMap,this.processedElements=new WeakSet,this.loopManager.destroy()}}class se{static eventCache=null;delegatedEvents=new Map;elementHandlers=new WeakMap;handlerCache=new $(200);componentManager;expressionEvaluator;loopManager;setupEvents=new Set;static getAllAvailableEvents(){if(se.eventCache)return se.eventCache;const e=new Set,t=["click","input","change","submit","focus","blur","keydown","keyup","mousedown","mouseup","mouseover","mouseout"];try{Object.getOwnPropertyNames(HTMLElement.prototype).filter((e=>e.startsWith("on")&&e.length>2)).map((e=>e.substring(2).toLowerCase())).forEach((t=>e.add(t)))}catch(s){console.warn("Could not get HTMLElement events:",s),t.forEach((t=>e.add(t)))}try{Object.getOwnPropertyNames(Document.prototype).filter((e=>e.startsWith("on")&&e.length>2)).map((e=>e.substring(2).toLowerCase())).forEach((t=>e.add(t)))}catch(e){console.warn("Could not get Document events:",e)}try{Object.getOwnPropertyNames(Window.prototype).filter((e=>e.startsWith("on")&&e.length>2)).map((e=>e.substring(2).toLowerCase())).forEach((t=>e.add(t)))}catch(e){console.warn("Could not get Window events:",e)}try{Object.getOwnPropertyNames(Element.prototype).filter((e=>e.startsWith("on")&&e.length>2)).map((e=>e.substring(2).toLowerCase())).forEach((t=>e.add(t)))}catch(e){console.warn("Could not get Element events:",e)}return new Set(["beforeunload","unload","pagehide","pageshow","popstate","hashchange","storage","message","messageerror","offline","online","languagechange","rejectionhandled","unhandledrejection","afterprint","beforeprint","devicemotion","deviceorientation","deviceorientationabsolute"]).forEach((t=>e.delete(t))),se.eventCache=e,e}setupEventDelegation(){const e=["click","input","change","submit","focus","blur"];for(const t of e)this.ensureEventSetup(t)}getEventOptions(e){const t={capture:!0,passive:!1};return["wheel","touchstart","touchmove","touchend","scroll","mousewheel"].includes(e)&&(t.passive=!0),("focusin"===e||"focusout"===e)&&(t.capture=!1),t}isEventSupported(e){return se.getAllAvailableEvents().has(e.toLowerCase())}getAllSupportedEvents(){return Array.from(se.getAllAvailableEvents()).sort()}getDelegatedEvents(){return Array.from(this.delegatedEvents.keys()).sort()}setDependencies(e,t,s){this.componentManager=e,this.expressionEvaluator=t,this.loopManager=s}createDelegatedListener(e){return t=>{const s=t.target;if(!s)return;const n=this.findHandler(s,e);n&&this.executeHandler(n.handler,n.element,t)}}registerEventHandler(e,t,s,n){const i=t.toLowerCase();if(this.ensureEventSetup(i),!this.isEventSupported(i))return void console.warn(`⚠️ Event type "${t}" is not supported`);const r=v.getContextComponent(e);this.elementHandlers.has(e)||this.elementHandlers.set(e,new Map);const a={code:s,component:r};this.elementHandlers.get(e).set(i,a);const o=this.delegatedEvents.get(i);o?o.elements.add(e):(console.warn(`⚠️ No delegated listener for ${i}, attaching directly`),this.attachDirectListener(e,i,a))}ensureEventSetup(e){if(!this.setupEvents.has(e)){if(!this.isEventSupported(e))return void console.warn(`⚠️ Attempting to setup unsupported event: ${e}`);try{const t=this.createDelegatedListener(e),s=this.getEventOptions(e);document.addEventListener(e,t,s),this.setupEvents.add(e),this.delegatedEvents.set(e,{listener:t,elements:new WeakSet})}catch(t){console.error(`Failed to setup event delegation for ${e}:`,t),this.setupEvents.delete(e)}}}findHandler(e,t){let s=e;for(;s;){const e=this.elementHandlers.get(s);if(e?.has(t))return{handler:e.get(t),element:s};s=s.parentElement}return null}compileHandler(e,t){const s=`${t}:${e}`;if(this.handlerCache.has(s))return this.handlerCache.get(s);let n=e;e.includes("this")&&(n=n.replace(/\bthis\b/g,"thisElement")),e.includes("event")&&(n=n.replace(/\bevent\b/g,"eventObject"));const i=new Function("eventObject","thisElement","context",`\n      try {\n        with(context) {\n          ${n}\n        }\n      } catch(error) {\n        console.error('Event handler execution error:', error);\n        console.error('Handler code:', ${JSON.stringify(e)});\n        console.error('Component:', '${t}');\n        console.error('Available context keys:', Object.keys(context));\n      }\n    `);return this.handlerCache.set(s,i),i}executeHandler(e,t,s){if(this.componentManager&&this.expressionEvaluator)try{let n=e.component,i=t;for(;i;){const e=i.__uniqueComponentName;if(e){n=e;break}i=i.parentElement}const r=t.getAttribute(d.ATTR_PREFIXES.CONTEXT),a="app"===r||"parent"===r,o="app"===v.getElementComponent(t),c=v.findElementForComponent(t,n);let p;if(a||o)p=this.componentManager.buildComponentContextWithProps("app"===n||"app"===r?"app":n,c||void 0);else if(p=this.componentManager.buildRestrictedComponentContext(n,!1),c){const e=this.componentManager.evaluateProps(c);Object.assign(p,e)}const h=this.loopManager?.getLoopContextForElement(t);if(h){const e={};for(const[t,s]of Object.entries(h))"function"!=typeof s&&(e[t]=s);p={...e,...p}}e.compiledFn||(e.compiledFn=this.compileHandler(e.code,n)),e.compiledFn&&e.compiledFn(s,t,p)}catch(t){console.error("💥 Event handler execution failed:",t),console.error("Handler code:",e.code),console.error("Handler component:",e.component)}else console.warn("EventDelegationManager dependencies not set")}attachDirectListener(e,t,s){const n=t=>{this.executeHandler(s,e,t)};e.addEventListener(t,n),e[`__${t}_listener`]=n}removeEventHandler(e,t){const s=this.elementHandlers.get(e);s&&(s.delete(t),0===s.size&&this.elementHandlers.delete(e));const n=this.delegatedEvents.get(t);n&&n.elements.delete?.(e);const i=e[`__${t}_listener`];i&&(e.removeEventListener(t,i),delete e[`__${t}_listener`])}cleanup(){for(const[e,t]of this.delegatedEvents)document.removeEventListener(e,t.listener,!0);this.delegatedEvents.clear(),this.handlerCache.clear(),this.setupEvents.clear()}}class Rs{stateManager=new ks;expressionEvaluator=new ce;componentManager=new Ns(this.stateManager);domBindingManager=new Ms(this.stateManager,this.componentManager,this.expressionEvaluator);initialized=!1;hydrationDone=!1;hydrationResolve;hydrationPromise;hydrationCallbacks=new Set;constructor(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.initialize())):setTimeout((()=>this.initialize()),0),this.hydrationPromise=new Promise((e=>this.hydrationResolve=e))}initialize(){this.initialized||(this.initialized=!0,this.markHydrationStart(),this.componentManager.setExpressionEvaluator(this.expressionEvaluator),this.componentManager.executePhpScripts(document.body),this.domBindingManager.processElement(document.body,!0),this.domBindingManager.processPendingBindings(),Promise.resolve().then((()=>{requestAnimationFrame((()=>{this.markHydrated()}))})))}hydrated(){return this.hydrationPromise}onHydrated(e){this.hydrationDone?queueMicrotask(e):this.hydrationCallbacks.add(e)}get isHydrated(){return this.hydrationDone}markHydrationStart(){document.dispatchEvent(new CustomEvent("pp:hydrationstart"))}markHydrated(){if(!this.hydrationDone){this.hydrationDone=!0,this.hydrationResolve();for(const e of this.hydrationCallbacks)try{e()}catch{}this.hydrationCallbacks.clear(),document.dispatchEvent(new CustomEvent("pp:hydrated",{detail:{at:performance.now()}}))}}state(e,t){const s=this.componentManager.getCurrentComponent();let n,i,r;"string"==typeof e&&2===arguments.length?(n=e,i=t):"string"==typeof e&&1===arguments.length?this.looksLikeVariableName(e)?(n=e,i=void 0):(console.warn("pp.state() called with string that doesn't look like variable name:",e),n="unknownState",i=e):(console.warn("pp.state() called without explicit key - this should be handled by AST transformation"),n="unknownState",i=e);const a=this.getLoopExecutionContext();if(a){const e=this.generateLoopInstanceId(a);r=`${s}.${e}.${n}`}else r=`${s}.${n}`;this.stateManager.hasState(r)||this.stateManager.setInitialState(r,i);const o=()=>this.stateManager.getState()[r],c=new Proxy(o,{get(e,t,s){if("__pphp_key"===t||"__pphp_fullKey"===t||"__pphp_component"===t||"value"===t||"valueOf"===t||"toString"===t)return Reflect.get(e,t,s);const n=e();if(null!=n){if(t in Object(n)){const e=n[t];return"function"==typeof e?e.bind(n):e}return Reflect.get(e,t,s)}},has(e,t){if("__pphp_key"===t||"__pphp_fullKey"===t||"__pphp_component"===t||"value"===t||"valueOf"===t||"toString"===t)return Reflect.has(e,t);const s=e();return null!=s&&t in Object(s)||Reflect.has(e,t)},apply:(e,t,s)=>Reflect.apply(e,t,s)});Object.defineProperty(c,"__pphp_key",{value:n,enumerable:!1,writable:!1}),Object.defineProperty(c,"__pphp_fullKey",{value:r,enumerable:!1,writable:!1}),Object.defineProperty(c,"__pphp_component",{value:s,enumerable:!1,writable:!1}),Object.defineProperty(c,"value",{get:()=>this.stateManager.getState()[r],enumerable:!0,configurable:!0}),o.valueOf=()=>this.stateManager.getState()[r],o.toString=()=>ie(this.stateManager.getState()[r]);const p=e=>{const t=this.stateManager.getState()[r],s="function"==typeof e?e(t):e;this.stateManager.setState(r,s)};return this.createComponentScopedGlobals(s,n,c,p),[c,p]}currentLoopContext=null;getLoopExecutionContext(){return this.currentLoopContext}generateLoopInstanceId(e){const t=Object.keys(e).sort().map((t=>{const s=e[t];return s&&"object"==typeof s&&"id"in s?`${t}:${s.id}`:`${t}:${JSON.stringify(s)}`}));return`loop_${btoa(t.join("|")).replace(/[^a-zA-Z0-9]/g,"").substring(0,8)}`}looksLikeVariableName(e){return/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)&&e.length<=50&&!e.includes(" ")&&!Te.has(e)}effect(e,t){const s=`effect_${Date.now()}_${Math.random()}`,n=this.componentManager.getCurrentComponent();let i,r,a,o=!1;if(1===arguments.length)r="always",a={immediate:!0,detectDeps:!0};else if(Array.isArray(t)){const e=this.extractDependencyNames(t,n);0===e.length?(r="once",a={deps:e,immediate:!0}):(r="deps",a={deps:e,immediate:!0})}else{const e={immediate:!0,...t||{}};if(e.deps&&0!==e.deps.length){r="deps",a={deps:this.extractDependencyNames(e.deps,n),immediate:e.immediate,detectDeps:e.detectDeps}}else r="always",a={immediate:e.immediate,detectDeps:!0}}const c=()=>{if(!o){if(i&&"function"==typeof i)try{i()}catch(e){console.error("Effect cleanup error:",e)}try{i=e()}catch(e){console.error("Effect callback error:",e)}}};switch(r){case"always":const e={id:s,selector:"",dependencies:new Set(["*"]),callback:c,component:n};this.stateManager.addSubscription(e);break;case"once":break;case"deps":const t=this.resolveDependencies(a.deps,n);if(t.length){const e={id:s,selector:"",dependencies:new Set(t),callback:c,component:n};this.stateManager.addSubscription(e)}}return!1!==a.immediate&&c(),()=>{if(o=!0,i&&"function"==typeof i)try{i()}catch(e){console.error("Effect cleanup error:",e)}this.stateManager.removeSubscription(s)}}extractDependencyNames(e,t){const s=[];for(const t of e)"string"==typeof t?s.push(t):"function"==typeof t&&t.__pphp_key?s.push(t.__pphp_key):console.warn("Invalid dependency in effect:",t);return s.filter(Boolean)}resolveDependencies(e,t){const s=[],n=this.stateManager.getState();for(const i of e)if(i.includes(".")){const e=i.split("."),r=e[0],a=e.slice(1).join("."),o=this.componentManager.getPropDependencies(r,t);if(o.length>0)s.push(...o);else{const e=Be.findExistingStateKey(r,t,n);e?s.push(`${e}.${a}`):s.push(`${t}.${i}`)}}else{const e=this.componentManager.getPropDependencies(i,t);if(e.length>0)s.push(...e);else{const e=Be.findExistingStateKey(i,t,n);e?s.push(e):s.push(`${t}.${i}`)}}return Array.from(new Set(s))}createComponentScopedGlobals(e,t,s,n){window[e]||(window[e]={});const i=`set${Vt(t)}`;Object.defineProperty(window[e],t,{get:()=>s.valueOf(),configurable:!0,enumerable:!0}),window[e][i]=n,window[e][`${t}Getter`]=s}}export{Rs as PPHP};