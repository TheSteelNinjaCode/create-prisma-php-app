<?php
// Require necessary files and initiate any PHP logic before outputting HTML.
require_once "../../bootstrap.php";

// Define the function at the top.
function determineContentToInclude()
{
    $subject = $_SERVER["SCRIPT_NAME"];
    preg_match("/^(.*)\/src\/app\//", $subject, $matches);

    // Normalize the request URI by removing the query string.
    $requestUri = explode('?', $_SERVER['REQUEST_URI'], 2)[0];
    $requestUri = rtrim($requestUri, '/'); // Remove trailing slash if any.
    // Replace the base part of the URI.
    $requestUri = str_replace($matches[1], '', $requestUri);
    $uri = trim($requestUri, '/');
    $baseDir = __DIR__;
    $includePath = ''; // Initialize with empty string.

    if ($uri) {
        $path = $baseDir . '/' . $uri . '.php'; // Attempt to resolve to a specific PHP file.
        if (file_exists($path)) {
            $includePath = $path;
        } else {
            $path = $baseDir . '/' . $uri . '/index.php'; // Fallback to index.php in the directory.
            if (file_exists($path)) {
                $includePath = $path;
            }
        }
    } else {
        // Default route handling, e.g., when the URI is empty.
        $includePath = $baseDir . '/index.php';
    }
    return $includePath;
}

// Dynamically calculate the base URL
$protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off' || $_SERVER['SERVER_PORT'] == 443) ? "https://" : "http://";
$domainName = $_SERVER['HTTP_HOST'];
$scriptPath = dirname($_SERVER['SCRIPT_NAME']);
$baseUrl = $protocol . $domainName . rtrim($scriptPath, '/') . '/';

// Determine which content to include based on the current URI.
$contentToInclude = determineContentToInclude();
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Generated by create Prisma PHP App">
    <title>Create Prisma PHP App</title>
    <link rel="shortcut icon" href="<?php echo $baseUrl; ?>favicon.ico" type="image/x-icon">
</head>

<body>
    <?php
    // Include the determined content within the body.
    if (!empty($contentToInclude)) {
        require_once $contentToInclude;
    } else {
        // If no content is determined, show a 404 message or redirect.
        require_once "not-found.php";
    }
    ?>
    <!-- Additional HTML content can go here. -->
</body>

</html>